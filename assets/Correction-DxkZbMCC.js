import{d as N,m as Q,l as I,c as _,e as a,r as f,w as o,j as C,a as n,f as r,N as G,g as c,O as J,D as $,o as d,E as m,_ as T,b,u as K,n as X,C as Y,P as z,A as Z,Q as tt,F as et,R as st}from"./index-Ce45WVGD.js";import{u as at}from"./essay-BXN7BXGR.js";import{e as ot,u as nt}from"./essay-DD6aH8xv.js";const lt={class:"essay-editor"},rt={key:1,class:"essay-file-list"},it={class:"essay-file-item"},ut={class:"essay-file-name"},dt=N({__name:"EssayEditor",emits:["update:content","update:file"],setup(w,{expose:k,emit:i}){const p=i,e=Q({title:"",prompt:"",content_text:""}),l=I([]);async function x(E){if(E.raw){if(E.raw.size>1024*1024){m.error("文件大小不能超过1MB"),l.value=[];return}try{const u=await ot(E.raw);e.content_text=u,p("update:content",u),p("update:file",E.raw)}catch{m.error("Word 解析失败，请确认文件格式"),l.value=[]}}}function V(){l.value=[],e.content_text="",p("update:file",null)}return k({form:e,clear:()=>{e.title="",e.prompt="",e.content_text="",l.value=[]}}),(E,u)=>{const D=f("el-input"),h=f("el-form-item"),g=f("el-option"),R=f("el-select"),M=f("el-icon"),A=f("el-upload"),F=f("el-button"),B=f("el-form");return d(),_("div",lt,[a(B,{model:e,"label-width":"80px"},{default:o(()=>[a(h,{label:"题目"},{default:o(()=>[a(D,{modelValue:e.title,"onUpdate:modelValue":u[0]||(u[0]=s=>e.title=s),placeholder:"请输入作文题目（可选）"},null,8,["modelValue"])]),_:1}),a(h,{label:"类型"},{default:o(()=>[a(R,{modelValue:e.prompt,"onUpdate:modelValue":u[1]||(u[1]=s=>e.prompt=s),filterable:"","allow-create":"",clearable:"","default-first-option":"",placeholder:"请选择或输入作文类型（可选）",style:{width:"100%"}},{default:o(()=>[a(g,{label:"议论文",value:"议论文"}),a(g,{label:"记叙文",value:"记叙文"}),a(g,{label:"应用文",value:"应用文"}),a(g,{label:"说明文",value:"说明文"}),a(g,{label:"散文",value:"散文"}),a(g,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),a(h,{label:"内容"},{default:o(()=>[l.value.length?(d(),_("div",rt,[n("div",it,[a(M,null,{default:o(()=>[a(r(J))]),_:1}),n("span",ut,$(l.value[0]?.name),1),a(F,{type:"primary",link:"",onClick:V},{default:o(()=>[...u[6]||(u[6]=[c("删除",-1)])]),_:1})])])):(d(),C(A,{key:0,class:"essay-upload","file-list":l.value,"onUpdate:fileList":u[2]||(u[2]=s=>l.value=s),"auto-upload":!1,limit:1,"show-file-list":!1,"on-change":x,accept:".docx,.doc",drag:""},{tip:o(()=>[...u[4]||(u[4]=[n("div",{class:"el-upload__tip"},"支持Word文档，文件大小不超过1MB",-1)])]),default:o(()=>[a(M,{class:"el-icon--upload"},{default:o(()=>[a(r(G))]),_:1}),u[5]||(u[5]=n("div",{class:"el-upload__text"},[c("将Word文件拖到此处，或"),n("em",null,"点击上传")],-1))]),_:1},8,["file-list"])),a(D,{modelValue:e.content_text,"onUpdate:modelValue":u[3]||(u[3]=s=>e.content_text=s),type:"textarea",rows:15,placeholder:"或直接在此输入作文内容...",style:{"margin-top":"var(--spacing-md)"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])}}}),ct=T(dt,[["__scopeId","data-v-2007616e"]]),ft={class:"correction-result"},pt={class:"stats-grid"},mt={class:"stat-item"},_t={class:"stat-value"},yt={class:"stat-item"},vt={class:"stat-value"},gt={class:"stat-item"},wt={class:"stat-value"},bt={key:0,class:"stat-item"},Et={class:"stat-value"},kt={class:"summary-text"},xt=["innerHTML"],ht=N({__name:"CorrectionResult",props:{correction:{}},setup(w){return(k,i)=>{const p=f("el-card");return d(),_("div",ft,[a(p,{shadow:"never",class:"stats-card"},{header:o(()=>[...i[0]||(i[0]=[n("h3",{class:"header-font"},"语言学统计",-1)])]),default:o(()=>[n("div",pt,[n("div",mt,[n("div",_t,$(w.correction.stats.word_count),1),i[1]||(i[1]=n("div",{class:"stat-label"},"字数",-1))]),n("div",yt,[n("div",vt,$(w.correction.stats.paragraph_count),1),i[2]||(i[2]=n("div",{class:"stat-label"},"段落数",-1))]),n("div",gt,[n("div",wt,$(w.correction.stats.typo_count),1),i[3]||(i[3]=n("div",{class:"stat-label"},"错别字",-1))]),w.correction.stats.sentence_count?(d(),_("div",bt,[n("div",Et,$(w.correction.stats.sentence_count),1),i[4]||(i[4]=n("div",{class:"stat-label"},"句子数",-1))])):b("",!0)])]),_:1}),a(p,{shadow:"never",class:"summary-card"},{header:o(()=>[...i[5]||(i[5]=[n("h3",{class:"header-font"},"评语与建议",-1)])]),default:o(()=>[n("p",kt,$(w.correction.summary),1)]),_:1}),a(p,{shadow:"never",class:"diff-card"},{header:o(()=>[...i[6]||(i[6]=[n("h3",{class:"header-font"},"修改痕迹",-1)])]),default:o(()=>[n("div",{class:"diff-content",innerHTML:w.correction.diff_html},null,8,xt)]),_:1})])}}}),Ct=T(ht,[["__scopeId","data-v-7faa380d"]]),$t={class:"correction-page"},Vt={class:"container"},It={class:"page-header"},Dt={key:0,class:"header-actions"},Mt={key:0},Rt={class:"submit-section"},At={key:2,class:"submit-actions"},Ft={key:1},Bt={key:2},St={class:"result-header"},Lt={class:"draft-op-row"},Nt={key:0,class:"drafts-empty-state"},Tt=N({__name:"Correction",setup(w){const k=Y(),i=Z(),p=K(),e=at(),l=I(),x=I(!1),V=I(null);async function E(){const s=k.params.id;s?await e.fetchEssay(Number(s)):e.clearCurrent()}X(async()=>{await E(),p.isAuthenticated&&await e.fetchDrafts();const s=k.query.draftId;s&&z(()=>{const t=e.drafts.find(y=>y.id===Number(s));t&&l.value&&(l.value.form.title=t.title??"",l.value.form.content_text=t.content_text??""),i.replace({path:k.path,query:{}})})}),tt(()=>k.params.id,async()=>{await E()});async function u(){if(!l.value)return;const{form:s}=l.value;if(!s.content_text.trim()){m.warning("请输入作文内容");return}try{await e.submitEssay({title:s.title,prompt:s.prompt,content_text:s.content_text,source_type:"text"});const t=window.setInterval(async()=>{e.currentEssay&&(await e.fetchEssay(e.currentEssay.id),(e.currentEssay.status==="done"||e.currentEssay.status==="failed")&&window.clearInterval(t))},2e3);window.setTimeout(()=>window.clearInterval(t),1e4)}catch(t){m.error(t.message||"提交失败")}}function D(){e.currentEssay&&(V.value={title:e.currentEssay.title??"",prompt:e.currentEssay.prompt??"",content_text:e.currentEssay.content_text??""}),e.clearCurrent(),i.push("/essay/correction").then(()=>{z(()=>{if(l.value&&V.value){const s=V.value;l.value.form.title=s.title,l.value.form.prompt=s.prompt,l.value.form.content_text=s.content_text,V.value=null}})})}const h=I(!1),g=I(!1);async function R(){if(e.currentEssay){h.value=!0;try{await e.favoriteEssay(e.currentEssay.id),e.setCurrentEssayFavorited(!0),m.success("收藏成功"),e.fetchEssay(e.currentEssay.id).catch(()=>{})}catch(s){m.error(s.message||"收藏失败")}finally{h.value=!1}}}async function M(){if(e.currentEssay){g.value=!0;try{await nt(e.currentEssay.id),e.setCurrentEssayFavorited(!1),m.success("已取消收藏"),e.fetchEssay(e.currentEssay.id).catch(()=>{})}catch(s){m.error(s.message||"取消收藏失败")}finally{g.value=!1}}}async function A(){if(!l.value)return;const{form:s}=l.value;if(!s.content_text.trim()){m.warning("请输入作文内容");return}if(!p.isAuthenticated){m.warning("请先登录"),i.push("/login");return}try{await e.createDraft({title:s.title,content_text:s.content_text}),m.success("草稿已保存")}catch(t){m.error(t.message||"保存失败")}}function F(s){l.value&&(l.value.form.title=s.title||"",l.value.form.content_text=s.content_text),x.value=!1}async function B(s){try{await st.confirm("确定要删除这个草稿吗？","提示",{type:"warning"}),await e.deleteDraft(s),m.success("删除成功")}catch(t){t!=="cancel"&&m.error(t.message||"删除失败")}}return(s,t)=>{const y=f("el-button"),S=f("el-link"),U=f("el-alert"),W=f("el-result"),q=f("el-card"),L=f("el-table-column"),H=f("el-table"),j=f("el-empty"),O=f("el-dialog");return d(),_("div",$t,[n("div",Vt,[a(q,{shadow:"never"},{header:o(()=>[n("div",It,[t[7]||(t[7]=n("h2",{class:"header-font"},"作文批改",-1)),!r(e).currentEssay||r(e).currentEssay.status!=="done"&&r(e).currentEssay.status!=="processing"?(d(),_("div",Dt,[r(p).isMember?(d(),C(y,{key:0,onClick:t[0]||(t[0]=v=>x.value=!0)},{default:o(()=>[...t[6]||(t[6]=[c(" 草稿列表 ",-1)])]),_:1})):b("",!0)])):b("",!0)])]),default:o(()=>[!r(e).currentEssay||r(e).currentEssay.status!=="done"&&r(e).currentEssay.status!=="processing"?(d(),_("div",Mt,[a(ct,{ref_key:"editorRef",ref:l},null,512),n("div",Rt,[r(p).isAuthenticated?r(p).isMember?b("",!0):(d(),C(U,{key:1,class:"tip-alert draft-tip",title:"提示",type:"warning",closable:!1,"show-icon":""},{default:o(()=>[a(S,{type:"primary",onClick:t[2]||(t[2]=v=>s.$router.push("/profile"))},{default:o(()=>[...t[10]||(t[10]=[c("开通会员",-1)])]),_:1}),t[12]||(t[12]=c(" 可保存草稿，可前往 ",-1)),a(S,{type:"primary",onClick:t[3]||(t[3]=v=>s.$router.push("/essay/history"))},{default:o(()=>[...t[11]||(t[11]=[c("历史记录",-1)])]),_:1}),t[13]||(t[13]=c(" 查看草稿。 ",-1))]),_:1})):(d(),C(U,{key:0,class:"tip-alert",title:"提示",type:"warning",closable:!1,"show-icon":""},{default:o(()=>[t[9]||(t[9]=c(" 未登录用户无法批改作文，",-1)),a(S,{type:"primary",onClick:t[1]||(t[1]=v=>s.$router.push("/login"))},{default:o(()=>[...t[8]||(t[8]=[c(" 立即登录 ",-1)])]),_:1})]),_:1})),r(p).isAuthenticated?(d(),_("div",At,[a(y,{type:"primary",size:"large",loading:r(e).loading,onClick:u},{default:o(()=>[...t[14]||(t[14]=[c(" 提交批改 ",-1)])]),_:1},8,["loading"]),r(p).isAuthenticated?(d(),C(y,{key:0,size:"large",disabled:!r(p).isMember,onClick:A},{default:o(()=>[...t[15]||(t[15]=[c(" 保存草稿 ",-1)])]),_:1},8,["disabled"])):b("",!0)])):b("",!0)])])):r(e).currentEssay&&r(e).currentEssay.status==="processing"?(d(),_("div",Ft,[a(W,{icon:"loading",title:"正在批改中..."},{"sub-title":o(()=>[...t[16]||(t[16]=[n("p",null,"AI正在分析您的作文，请稍候",-1)])]),_:1})])):r(e).currentCorrection?(d(),_("div",Bt,[n("div",St,[a(y,{onClick:D},{default:o(()=>[...t[17]||(t[17]=[c("重新批改",-1)])]),_:1}),r(p).isAuthenticated?(d(),_(et,{key:0},[r(e).currentEssay?.is_favorited?(d(),C(y,{key:1,loading:g.value,onClick:M},{default:o(()=>[...t[19]||(t[19]=[c(" 取消收藏 ",-1)])]),_:1},8,["loading"])):(d(),C(y,{key:0,type:"primary",loading:h.value,onClick:R},{default:o(()=>[...t[18]||(t[18]=[c(" 收藏 ",-1)])]),_:1},8,["loading"]))],64)):b("",!0)]),a(Ct,{correction:r(e).currentCorrection},null,8,["correction"])])):b("",!0)]),_:1})]),a(O,{modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=v=>x.value=v),title:"草稿列表",width:"600px"},{default:o(()=>[a(H,{data:r(e).drafts,class:"drafts-table",style:{width:"100%"}},{default:o(()=>[a(L,{prop:"title",label:"标题"}),a(L,{prop:"updated_at",label:"更新时间",width:"180"},{default:o(({row:v})=>[c($(new Date(v.updated_at).toLocaleString()),1)]),_:1}),a(L,{label:"操作",width:"140",align:"right"},{default:o(({row:v})=>[n("div",Lt,[a(y,{type:"primary",text:"",onClick:P=>F(v)},{default:o(()=>[...t[20]||(t[20]=[c("加载",-1)])]),_:1},8,["onClick"]),a(y,{type:"danger",text:"",onClick:P=>B(v.id)},{default:o(()=>[...t[21]||(t[21]=[c("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),r(e).drafts.length===0?(d(),_("div",Nt,[a(j,{description:"暂无草稿"},{default:o(()=>[a(y,{type:"primary",onClick:t[4]||(t[4]=v=>x.value=!1)},{default:o(()=>[...t[22]||(t[22]=[c("开始编辑",-1)])]),_:1})]),_:1})])):b("",!0)]),_:1},8,["modelValue"])])}}}),qt=T(Tt,[["__scopeId","data-v-3aca2068"]]);export{qt as default};
//# sourceMappingURL=Correction-DxkZbMCC.js.map
