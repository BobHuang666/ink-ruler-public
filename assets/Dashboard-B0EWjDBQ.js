import{V,d as ve,l as i,n as _e,K as fe,E as f,c as ge,a as s,e,w as a,r as u,f as S,a6 as be,t as we,a7 as ye,s as y,v as L,D as v,g as p,y as he,a8 as ke,j as I,S as xe,b as Ve,o as U,_ as Ce}from"./index-Ddg1ipA6.js";async function Ue(){return(await V.get("/admin/metrics")).data}async function De(r){const n=r.page??1,_=r.size??10,c=await V.get("/admin/users",{params:{q:r.q,role:r.role,status:r.status,page:n,size:_}});return{items:(c.data.list??[]).map(m=>({id:m.id,email:m.email,phone:m.phone,nickname:m.nickname??"",avatar:m.avatar,role:m.role,status:m.status,created_at:m.created_at??"",updated_at:m.updated_at??""})),total:c.data.total??0,page:n,size:_}}async function ee(r,n){await V.patch(`/admin/users/${r}`,n)}async function ze(r){const n=r?.page??1,_=r?.size??20,c=await V.get("/admin/logs",{params:{page:n,size:_}});return{items:c.data.list??[],total:c.data.total??0,page:n,size:_}}async function Se(r){const n=r?.page??1,_=r?.size??10,c=await V.get("/admin/flags",{params:{page:n,size:_}});return{items:c.data.list??[],total:c.data.total??0,page:n,size:_}}async function Le(r,n){await V.patch(`/admin/flags/${r}`,{status:n})}const Ie={class:"admin-page"},Ee={class:"admin-container"},Fe={class:"dashboard-content"},Me={class:"metric-item"},Te={class:"metric-value"},$e={class:"metric-item"},Be={class:"metric-value"},Ne={class:"metric-item"},Pe={class:"metric-value"},qe={class:"metric-item"},Ke={class:"metric-value"},Re={class:"users-content"},je={class:"search-bar"},Ae={class:"table-scroll-wrap"},Qe={class:"content-content"},We={class:"table-scroll-wrap"},Ge={class:"logs-content"},He={class:"table-scroll-wrap"},Je=ve({__name:"Dashboard",setup(r){const n=i("dashboard"),_=i(3),c=i({user_count:0,active_user_count:0,essay_count:0,token_usage:{total:0,today:0,this_month:0}}),E=i([]),m=i(!1),F=i(""),M=i(""),T=i(""),$=i(1),B=i(10),G=i(0),H=i([]),N=i(!1),J=i([]),P=i(!1),C=i(!1),w=i({role:"",status:""}),q=i(null);function K(){_.value=window.innerWidth>=768?3:1}_e(async()=>{K(),window.addEventListener("resize",K),await te(),await h(),await O(),await ae()}),fe(()=>{window.removeEventListener("resize",K)});async function te(){try{c.value=await Ue()}catch(o){f.error(o.message||"获取数据失败")}}async function h(){m.value=!0;try{const o=await De({q:F.value,role:M.value,status:T.value,page:$.value,size:B.value});E.value=o.items,G.value=o.total}catch(o){f.error(o.message||"获取用户列表失败")}finally{m.value=!1}}async function O(){N.value=!0;try{const o=await Se({});H.value=o.items}catch(o){f.error(o.message||"获取内容标记失败")}finally{N.value=!1}}async function ae(){P.value=!0;try{const o=await ze({});J.value=o.items}catch(o){f.error(o.message||"获取日志失败")}finally{P.value=!1}}function le(o){o!==n.value&&(n.value=o)}function se(o){q.value=o.id,w.value={role:o.role,status:o.status},C.value=!0}async function oe(){if(q.value)try{await ee(q.value,w.value),f.success("更新成功"),C.value=!1,await h()}catch(o){f.error(o.message||"更新失败")}}async function ne(o){try{await ee(o.id,{status:o.status==="active"?"disabled":"active"}),f.success("操作成功"),await h()}catch(t){f.error(t.message||"操作失败")}}async function ue(o){try{await Le(o.id,"resolved"),f.success("标记已处理"),await O()}catch(t){f.error(t.message||"操作失败")}}return(o,t)=>{const D=u("el-icon"),R=u("el-menu-item"),de=u("el-menu"),k=u("el-col"),g=u("el-card"),X=u("el-row"),j=u("el-descriptions-item"),ie=u("el-descriptions"),re=u("el-input"),b=u("el-option"),z=u("el-select"),x=u("el-button"),d=u("el-table-column"),A=u("el-tag"),Q=u("el-table"),ce=u("el-pagination"),Y=u("el-form-item"),me=u("el-form"),pe=u("el-dialog"),W=xe("loading");return U(),ge("div",Ie,[s("div",Ee,[e(X,{gutter:20},{default:a(()=>[e(k,{xs:24,sm:24,md:4,lg:4},{default:a(()=>[e(de,{"default-active":n.value,class:"admin-menu",onSelect:le},{default:a(()=>[e(R,{index:"dashboard"},{default:a(()=>[e(D,null,{default:a(()=>[e(S(be))]),_:1}),t[9]||(t[9]=s("span",null,"数据看板",-1))]),_:1}),e(R,{index:"users"},{default:a(()=>[e(D,null,{default:a(()=>[e(S(we))]),_:1}),t[10]||(t[10]=s("span",null,"用户管理",-1))]),_:1}),e(R,{index:"logs"},{default:a(()=>[e(D,null,{default:a(()=>[e(S(ye))]),_:1}),t[11]||(t[11]=s("span",null,"操作日志",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(k,{xs:24,sm:24,md:20,lg:20},{default:a(()=>[y(s("div",Fe,[t[17]||(t[17]=s("h2",{class:"header-font"},"数据看板",-1)),e(X,{gutter:20,class:"metrics-row"},{default:a(()=>[e(k,{xs:12,sm:12,md:6,lg:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[s("div",Me,[s("div",Te,v(c.value.user_count),1),t[12]||(t[12]=s("div",{class:"metric-label"},"总用户数",-1))])]),_:1})]),_:1}),e(k,{xs:12,sm:12,md:6,lg:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[s("div",$e,[s("div",Be,v(c.value.active_user_count),1),t[13]||(t[13]=s("div",{class:"metric-label"},"活跃用户",-1))])]),_:1})]),_:1}),e(k,{xs:12,sm:12,md:6,lg:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[s("div",Ne,[s("div",Pe,v(c.value.essay_count),1),t[14]||(t[14]=s("div",{class:"metric-label"},"作文提交量",-1))])]),_:1})]),_:1}),e(k,{xs:12,sm:12,md:6,lg:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[s("div",qe,[s("div",Ke,v(c.value.token_usage.total),1),t[15]||(t[15]=s("div",{class:"metric-label"},"Token使用总量",-1))])]),_:1})]),_:1})]),_:1}),e(g,{shadow:"never",class:"token-card"},{default:a(()=>[t[16]||(t[16]=s("h3",{class:"header-font"},"Token使用情况",-1)),e(ie,{column:_.value,border:""},{default:a(()=>[e(j,{label:"今日使用"},{default:a(()=>[p(v(c.value.token_usage.today),1)]),_:1}),e(j,{label:"本月使用"},{default:a(()=>[p(v(c.value.token_usage.this_month),1)]),_:1}),e(j,{label:"总使用量"},{default:a(()=>[p(v(c.value.token_usage.total),1)]),_:1})]),_:1},8,["column"])]),_:1}),t[18]||(t[18]=s("p",{class:"dashboard-note"},"活跃用户：统计最近 7 天内有过登录的用户。",-1))],512),[[L,n.value==="dashboard"]]),y(s("div",Re,[t[21]||(t[21]=s("h2",{class:"header-font"},"用户管理",-1)),e(g,{shadow:"never"},{default:a(()=>[s("div",je,[e(re,{modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=l=>F.value=l),placeholder:"搜索用户...",class:"search-input",clearable:"",onKeyup:he(h,["enter"])},{prefix:a(()=>[e(D,null,{default:a(()=>[e(S(ke))]),_:1})]),_:1},8,["modelValue"]),e(z,{modelValue:M.value,"onUpdate:modelValue":t[1]||(t[1]=l=>M.value=l),placeholder:"角色",class:"search-select",clearable:""},{default:a(()=>[e(b,{label:"学生",value:"student"}),e(b,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"]),e(z,{modelValue:T.value,"onUpdate:modelValue":t[2]||(t[2]=l=>T.value=l),placeholder:"状态",class:"search-select",clearable:""},{default:a(()=>[e(b,{label:"正常",value:"active"}),e(b,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"]),e(x,{type:"primary",onClick:h},{default:a(()=>[...t[19]||(t[19]=[p("搜索",-1)])]),_:1})]),s("div",Ae,[y((U(),I(Q,{data:E.value,style:{width:"100%","margin-top":"20px"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"nickname",label:"昵称"}),e(d,{prop:"email",label:"邮箱"}),e(d,{prop:"role",label:"角色",width:"100"},{default:a(({row:l})=>[e(A,{type:l.role==="admin"?"danger":"primary"},{default:a(()=>[p(v(l.role==="admin"?"管理员":"学生"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(A,{type:l.status==="active"?"success":"info"},{default:a(()=>[p(v(l.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"操作",width:"200"},{default:a(({row:l})=>[e(x,{type:"primary",text:"",onClick:Z=>se(l)},{default:a(()=>[...t[20]||(t[20]=[p("编辑",-1)])]),_:1},8,["onClick"]),e(x,{type:l.status==="active"?"warning":"success",text:"",onClick:Z=>ne(l)},{default:a(()=>[p(v(l.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[W,m.value]])]),e(ce,{"current-page":$.value,"onUpdate:currentPage":t[3]||(t[3]=l=>$.value=l),"page-size":B.value,"onUpdate:pageSize":t[4]||(t[4]=l=>B.value=l),total:G.value,layout:"total, prev, pager, next",style:{"margin-top":"20px"},onCurrentChange:h},null,8,["current-page","page-size","total"])]),_:1})],512),[[L,n.value==="users"]]),y(s("div",Qe,[t[23]||(t[23]=s("h2",{class:"header-font"},"内容管理",-1)),e(g,{shadow:"never"},{default:a(()=>[s("div",We,[y((U(),I(Q,{data:H.value,class:"admin-table",style:{width:"100%"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"target_type",label:"类型",width:"120"}),e(d,{prop:"target_id",label:"目标ID",width:"100"}),e(d,{prop:"reason",label:"原因"}),e(d,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(A,{type:l.status==="resolved"?"success":"warning"},{default:a(()=>[p(v(l.status==="resolved"?"已处理":"待处理"),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"操作",width:"150"},{default:a(({row:l})=>[l.status==="open"?(U(),I(x,{key:0,type:"success",text:"",onClick:Z=>ue(l)},{default:a(()=>[...t[22]||(t[22]=[p(" 标记已处理 ",-1)])]),_:1},8,["onClick"])):Ve("",!0)]),_:1})]),_:1},8,["data"])),[[W,N.value]])])]),_:1})],512),[[L,n.value==="content"]]),y(s("div",Ge,[t[24]||(t[24]=s("h2",{class:"header-font"},"操作日志",-1)),e(g,{shadow:"never"},{default:a(()=>[s("div",He,[y((U(),I(Q,{data:J.value,class:"admin-table",style:{width:"100%"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"action",label:"操作"}),e(d,{prop:"target_type",label:"目标类型",width:"120"}),e(d,{prop:"target_id",label:"目标ID",width:"100"}),e(d,{prop:"ip",label:"IP",width:"150"}),e(d,{prop:"created_at",label:"时间",width:"180"},{default:a(({row:l})=>[p(v(new Date(l.created_at).toLocaleString()),1)]),_:1})]),_:1},8,["data"])),[[W,P.value]])])]),_:1})],512),[[L,n.value==="logs"]])]),_:1})]),_:1})]),e(pe,{modelValue:C.value,"onUpdate:modelValue":t[8]||(t[8]=l=>C.value=l),title:"编辑用户",width:"500px",class:"edit-user-dialog"},{footer:a(()=>[e(x,{onClick:t[7]||(t[7]=l=>C.value=!1)},{default:a(()=>[...t[25]||(t[25]=[p("取消",-1)])]),_:1}),e(x,{type:"primary",onClick:oe},{default:a(()=>[...t[26]||(t[26]=[p("保存",-1)])]),_:1})]),default:a(()=>[e(me,{model:w.value,"label-width":"100px"},{default:a(()=>[e(Y,{label:"角色"},{default:a(()=>[e(z,{modelValue:w.value.role,"onUpdate:modelValue":t[5]||(t[5]=l=>w.value.role=l)},{default:a(()=>[e(b,{label:"学生",value:"student"}),e(b,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),e(Y,{label:"状态"},{default:a(()=>[e(z,{modelValue:w.value.status,"onUpdate:modelValue":t[6]||(t[6]=l=>w.value.status=l)},{default:a(()=>[e(b,{label:"正常",value:"active"}),e(b,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Xe=Ce(Je,[["__scopeId","data-v-ad188d54"]]);export{Xe as default};
//# sourceMappingURL=Dashboard-B0EWjDBQ.js.map
