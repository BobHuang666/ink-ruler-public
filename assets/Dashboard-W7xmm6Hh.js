import{G as x,d as _e,l as c,B as ve,E as f,c as D,a as o,e,w as a,r as u,f as z,I as me,p as fe,J as ge,K as ye,b as S,A as v,g as _,D as G,q as be,L as we,F as he,j as M,o as g,_ as ke}from"./index-DcL45HtP.js";async function Ve(){return(await x.get("/admin/metrics")).data}async function xe(d){const n=d.page??1,r=d.size??10,m=await x.get("/admin/users",{params:{q:d.q,role:d.role,status:d.status,page:n,size:r}});return{items:(m.data.list??[]).map(p=>({id:p.id,email:p.email,phone:p.phone,nickname:p.nickname??"",avatar:p.avatar,role:p.role,status:p.status,created_at:p.created_at??"",updated_at:p.updated_at??""})),total:m.data.total??0,page:n,size:r}}async function Z(d,n){await x.patch(`/admin/users/${d}`,n)}async function Ce(d){const n=d?.page??1,r=d?.size??20,m=await x.get("/admin/logs",{params:{page:n,size:r}});return{items:m.data.list??[],total:m.data.total??0,page:n,size:r}}async function Ue(d){const n=d?.page??1,r=d?.size??10,m=await x.get("/admin/flags",{params:{page:n,size:r}});return{items:m.data.list??[],total:m.data.total??0,page:n,size:r}}async function De(d,n){await x.patch(`/admin/flags/${d}`,{status:n})}const ze={class:"admin-page"},Se={class:"admin-container"},Ie={key:0,class:"dashboard-content"},Fe={class:"metric-item"},Le={class:"metric-value"},Me={class:"metric-item"},$e={class:"metric-value"},Be={class:"metric-item"},Ee={class:"metric-value"},Te={class:"metric-item"},qe={class:"metric-value"},Ne={key:1,class:"users-content"},Pe={class:"search-bar"},Ke={key:2,class:"content-content"},Ae={key:3,class:"logs-content"},Re=_e({__name:"Dashboard",setup(d){const n=c("dashboard"),r=c({user_count:0,active_users:0,essay_count:0,token_usage:{total:0,today:0,this_month:0}}),m=c([]),I=c(!1),p=c(""),$=c(""),B=c(""),E=c(1),T=c(10),J=c(0),Q=c([]),q=c(!1),H=c([]),N=c(!1),C=c(!1),w=c({role:"",status:""}),P=c(null);ve(async()=>{await ee(),await h(),await O(),await te()});async function ee(){try{r.value=await Ve()}catch(s){f.error(s.message||"获取数据失败")}}async function h(){I.value=!0;try{const s=await xe({q:p.value,role:$.value,status:B.value,page:E.value,size:T.value});m.value=s.items,J.value=s.total}catch(s){f.error(s.message||"获取用户列表失败")}finally{I.value=!1}}async function O(){q.value=!0;try{const s=await Ue({});Q.value=s.items}catch(s){f.error(s.message||"获取内容标记失败")}finally{q.value=!1}}async function te(){N.value=!0;try{const s=await Ce({});H.value=s.items}catch(s){f.error(s.message||"获取日志失败")}finally{N.value=!1}}function ae(s){n.value=s}function le(s){P.value=s.id,w.value={role:s.role,status:s.status},C.value=!0}async function se(){if(P.value)try{await Z(P.value,w.value),f.success("更新成功"),C.value=!1,await h()}catch(s){f.error(s.message||"更新失败")}}async function oe(s){try{await Z(s.id,{status:s.status==="active"?"disabled":"active"}),f.success("操作成功"),await h()}catch(t){f.error(t.message||"操作失败")}}async function ne(s){try{await De(s.id,"resolved"),f.success("标记已处理"),await O()}catch(t){f.error(t.message||"操作失败")}}return(s,t)=>{const U=u("el-icon"),F=u("el-menu-item"),ue=u("el-menu"),k=u("el-col"),y=u("el-card"),W=u("el-row"),K=u("el-descriptions-item"),ie=u("el-descriptions"),de=u("el-input"),b=u("el-option"),L=u("el-select"),V=u("el-button"),i=u("el-table-column"),A=u("el-tag"),R=u("el-table"),re=u("el-pagination"),X=u("el-form-item"),ce=u("el-form"),pe=u("el-dialog"),j=he("loading");return g(),D("div",ze,[o("div",Se,[e(W,{gutter:20},{default:a(()=>[e(k,{span:4},{default:a(()=>[e(ue,{"default-active":n.value,class:"admin-menu",onSelect:ae},{default:a(()=>[e(F,{index:"dashboard"},{default:a(()=>[e(U,null,{default:a(()=>[e(z(me))]),_:1}),t[9]||(t[9]=o("span",null,"数据看板",-1))]),_:1}),e(F,{index:"users"},{default:a(()=>[e(U,null,{default:a(()=>[e(z(fe))]),_:1}),t[10]||(t[10]=o("span",null,"用户管理",-1))]),_:1}),e(F,{index:"content"},{default:a(()=>[e(U,null,{default:a(()=>[e(z(ge))]),_:1}),t[11]||(t[11]=o("span",null,"内容管理",-1))]),_:1}),e(F,{index:"logs"},{default:a(()=>[e(U,null,{default:a(()=>[e(z(ye))]),_:1}),t[12]||(t[12]=o("span",null,"操作日志",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(k,{span:20},{default:a(()=>[n.value==="dashboard"?(g(),D("div",Ie,[t[18]||(t[18]=o("h2",null,"数据看板",-1)),e(W,{gutter:20,class:"metrics-row"},{default:a(()=>[e(k,{span:6},{default:a(()=>[e(y,{shadow:"hover"},{default:a(()=>[o("div",Fe,[o("div",Le,v(r.value.user_count),1),t[13]||(t[13]=o("div",{class:"metric-label"},"总用户数",-1))])]),_:1})]),_:1}),e(k,{span:6},{default:a(()=>[e(y,{shadow:"hover"},{default:a(()=>[o("div",Me,[o("div",$e,v(r.value.active_users),1),t[14]||(t[14]=o("div",{class:"metric-label"},"活跃用户",-1))])]),_:1})]),_:1}),e(k,{span:6},{default:a(()=>[e(y,{shadow:"hover"},{default:a(()=>[o("div",Be,[o("div",Ee,v(r.value.essay_count),1),t[15]||(t[15]=o("div",{class:"metric-label"},"作文提交量",-1))])]),_:1})]),_:1}),e(k,{span:6},{default:a(()=>[e(y,{shadow:"hover"},{default:a(()=>[o("div",Te,[o("div",qe,v(r.value.token_usage.total),1),t[16]||(t[16]=o("div",{class:"metric-label"},"Token使用总量",-1))])]),_:1})]),_:1})]),_:1}),e(y,{shadow:"never",class:"token-card"},{default:a(()=>[t[17]||(t[17]=o("h3",null,"Token使用情况",-1)),e(ie,{column:3,border:""},{default:a(()=>[e(K,{label:"今日使用"},{default:a(()=>[_(v(r.value.token_usage.today),1)]),_:1}),e(K,{label:"本月使用"},{default:a(()=>[_(v(r.value.token_usage.this_month),1)]),_:1}),e(K,{label:"总使用量"},{default:a(()=>[_(v(r.value.token_usage.total),1)]),_:1})]),_:1})]),_:1})])):S("",!0),n.value==="users"?(g(),D("div",Ne,[t[21]||(t[21]=o("h2",null,"用户管理",-1)),e(y,{shadow:"never"},{default:a(()=>[o("div",Pe,[e(de,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=l=>p.value=l),placeholder:"搜索用户...",style:{width:"300px"},clearable:"",onKeyup:be(h,["enter"])},{prefix:a(()=>[e(U,null,{default:a(()=>[e(z(we))]),_:1})]),_:1},8,["modelValue"]),e(L,{modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=l=>$.value=l),placeholder:"角色",style:{width:"120px"},clearable:""},{default:a(()=>[e(b,{label:"学生",value:"student"}),e(b,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"]),e(L,{modelValue:B.value,"onUpdate:modelValue":t[2]||(t[2]=l=>B.value=l),placeholder:"状态",style:{width:"120px"},clearable:""},{default:a(()=>[e(b,{label:"活跃",value:"active"}),e(b,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"]),e(V,{type:"primary",onClick:h},{default:a(()=>[...t[19]||(t[19]=[_("搜索",-1)])]),_:1})]),G((g(),M(R,{data:m.value,style:{width:"100%","margin-top":"20px"}},{default:a(()=>[e(i,{prop:"id",label:"ID",width:"80"}),e(i,{prop:"nickname",label:"昵称"}),e(i,{prop:"email",label:"邮箱"}),e(i,{prop:"role",label:"角色",width:"100"},{default:a(({row:l})=>[e(A,{type:l.role==="admin"?"danger":"primary"},{default:a(()=>[_(v(l.role==="admin"?"管理员":"学生"),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(A,{type:l.status==="active"?"success":"info"},{default:a(()=>[_(v(l.status==="active"?"活跃":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"操作",width:"200"},{default:a(({row:l})=>[e(V,{type:"primary",text:"",onClick:Y=>le(l)},{default:a(()=>[...t[20]||(t[20]=[_("编辑",-1)])]),_:1},8,["onClick"]),e(V,{type:l.status==="active"?"warning":"success",text:"",onClick:Y=>oe(l)},{default:a(()=>[_(v(l.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[j,I.value]]),e(re,{"current-page":E.value,"onUpdate:currentPage":t[3]||(t[3]=l=>E.value=l),"page-size":T.value,"onUpdate:pageSize":t[4]||(t[4]=l=>T.value=l),total:J.value,layout:"total, prev, pager, next",style:{"margin-top":"20px"},onCurrentChange:h},null,8,["current-page","page-size","total"])]),_:1})])):S("",!0),n.value==="content"?(g(),D("div",Ke,[t[23]||(t[23]=o("h2",null,"内容管理",-1)),e(y,{shadow:"never"},{default:a(()=>[G((g(),M(R,{data:Q.value,style:{width:"100%"}},{default:a(()=>[e(i,{prop:"id",label:"ID",width:"80"}),e(i,{prop:"target_type",label:"类型",width:"120"}),e(i,{prop:"target_id",label:"目标ID",width:"100"}),e(i,{prop:"reason",label:"原因"}),e(i,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(A,{type:l.status==="resolved"?"success":"warning"},{default:a(()=>[_(v(l.status==="resolved"?"已处理":"待处理"),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"操作",width:"150"},{default:a(({row:l})=>[l.status==="open"?(g(),M(V,{key:0,type:"success",text:"",onClick:Y=>ne(l)},{default:a(()=>[...t[22]||(t[22]=[_(" 标记已处理 ",-1)])]),_:1},8,["onClick"])):S("",!0)]),_:1})]),_:1},8,["data"])),[[j,q.value]])]),_:1})])):S("",!0),n.value==="logs"?(g(),D("div",Ae,[t[24]||(t[24]=o("h2",null,"操作日志",-1)),e(y,{shadow:"never"},{default:a(()=>[G((g(),M(R,{data:H.value,style:{width:"100%"}},{default:a(()=>[e(i,{prop:"id",label:"ID",width:"80"}),e(i,{prop:"action",label:"操作"}),e(i,{prop:"target_type",label:"目标类型",width:"120"}),e(i,{prop:"target_id",label:"目标ID",width:"100"}),e(i,{prop:"ip",label:"IP",width:"150"}),e(i,{prop:"created_at",label:"时间",width:"180"},{default:a(({row:l})=>[_(v(new Date(l.created_at).toLocaleString()),1)]),_:1})]),_:1},8,["data"])),[[j,N.value]])]),_:1})])):S("",!0)]),_:1})]),_:1})]),e(pe,{modelValue:C.value,"onUpdate:modelValue":t[8]||(t[8]=l=>C.value=l),title:"编辑用户",width:"500px"},{footer:a(()=>[e(V,{onClick:t[7]||(t[7]=l=>C.value=!1)},{default:a(()=>[...t[25]||(t[25]=[_("取消",-1)])]),_:1}),e(V,{type:"primary",onClick:se},{default:a(()=>[...t[26]||(t[26]=[_("保存",-1)])]),_:1})]),default:a(()=>[e(ce,{model:w.value,"label-width":"100px"},{default:a(()=>[e(X,{label:"角色"},{default:a(()=>[e(L,{modelValue:w.value.role,"onUpdate:modelValue":t[5]||(t[5]=l=>w.value.role=l)},{default:a(()=>[e(b,{label:"学生",value:"student"}),e(b,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),e(X,{label:"状态"},{default:a(()=>[e(L,{modelValue:w.value.status,"onUpdate:modelValue":t[6]||(t[6]=l=>w.value.status=l)},{default:a(()=>[e(b,{label:"活跃",value:"active"}),e(b,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ge=ke(Re,[["__scopeId","data-v-8718751f"]]);export{Ge as default};
//# sourceMappingURL=Dashboard-W7xmm6Hh.js.map
