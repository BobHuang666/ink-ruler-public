{"version":3,"file":"Login-C_QFsPwm.js","sources":["../../src/views/auth/Login.vue"],"sourcesContent":["<template>\n  <div class=\"login-page\">\n    <div class=\"login-container\">\n      <el-card class=\"login-card\" shadow=\"always\">\n        <template #header>\n          <div class=\"card-header\">\n            <h2 class=\"header-font\">登录</h2>\n            <p class=\"subtitle content-font\">欢迎回来</p>\n          </div>\n        </template>\n\n        <el-form\n          ref=\"formRef\"\n          :model=\"form\"\n          :rules=\"rules\"\n          label-width=\"0\"\n          @submit.prevent=\"handleLogin\"\n        >\n          <el-form-item prop=\"emailOrPhone\">\n            <div\n              class=\"account-input-wrap\"\n              @mouseenter=\"showAccountDropdown = true\"\n              @mouseleave=\"scheduleCloseAccountDropdown\"\n            >\n              <el-input\n                v-model=\"form.emailOrPhone\"\n                placeholder=\"邮箱或手机号\"\n                size=\"large\"\n                :prefix-icon=\"User\"\n              />\n              <div\n                v-show=\"showAccountDropdown && rememberedList.length\"\n                class=\"remembered-dropdown\"\n              >\n                <div class=\"remembered-dropdown-label\">已保存的账号</div>\n                <div\n                  v-for=\"item in rememberedList\"\n                  :key=\"item.emailOrPhone\"\n                  class=\"remembered-dropdown-item\"\n                  @click=\"selectAccount(item)\"\n                >\n                  <span>{{ item.emailOrPhone }}</span>\n                  <el-button\n                    type=\"danger\"\n                    link\n                    size=\"small\"\n                    class=\"remembered-dropdown-delete\"\n                    @click.stop=\"deleteRemembered(item)\"\n                  >\n                    删除\n                  </el-button>\n                </div>\n              </div>\n            </div>\n          </el-form-item>\n\n          <el-form-item prop=\"password\">\n            <el-input\n              v-model=\"form.password\"\n              type=\"password\"\n              placeholder=\"密码\"\n              size=\"large\"\n              :prefix-icon=\"Lock\"\n              show-password\n              @keyup.enter=\"handleLogin\"\n            />\n          </el-form-item>\n\n          <el-form-item>\n            <div class=\"form-actions\">\n              <el-checkbox v-model=\"rememberMe\">记住我</el-checkbox>\n              <el-link type=\"primary\" :underline=\"false\" @click=\"router.push('/forgot-password')\"\n                >忘记密码？</el-link\n              >\n            </div>\n          </el-form-item>\n\n          <el-form-item>\n            <el-button\n              type=\"primary\"\n              size=\"large\"\n              :loading=\"loading\"\n              class=\"login-button\"\n              @click=\"handleLogin\"\n            >\n              登录\n            </el-button>\n          </el-form-item>\n\n          <el-divider>或</el-divider>\n\n          <el-form-item>\n            <el-button size=\"large\" class=\"register-button\" @click=\"router.push('/register')\">\n              注册账号\n            </el-button>\n          </el-form-item>\n        </el-form>\n\n        <div class=\"demo-tip\">\n          <el-alert class=\"tip-alert\" title=\"演示账号\" type=\"warning\" :closable=\"false\" show-icon>\n            <p>管理员：admin@ink.com / 666666</p>\n            <p>学生：student@ink.com / 666666</p>\n          </el-alert>\n        </div>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive, onMounted } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport { useAuthStore } from '@/stores/auth'\nimport {\n  getRememberedAccounts,\n  addRememberedAccount,\n  removeRememberedAccount,\n  type RememberedAccount,\n} from '@/utils/auth'\nimport { User, Lock } from '@element-plus/icons-vue'\nimport { ElMessage, type FormInstance, type FormRules } from 'element-plus'\n\nconst router = useRouter()\nconst route = useRoute()\nconst authStore = useAuthStore()\n\nconst formRef = ref<FormInstance>()\nconst loading = ref(false)\nconst rememberMe = ref(false)\nconst rememberedList = ref<RememberedAccount[]>([])\nconst showAccountDropdown = ref(false)\nlet accountDropdownCloseTimer: ReturnType<typeof setTimeout> | null = null\n\nconst form = reactive({\n  emailOrPhone: '',\n  password: '',\n})\n\nasync function loadRememberedList() {\n  rememberedList.value = await getRememberedAccounts()\n}\n\nfunction scheduleCloseAccountDropdown() {\n  if (accountDropdownCloseTimer) clearTimeout(accountDropdownCloseTimer)\n  accountDropdownCloseTimer = setTimeout(() => {\n    showAccountDropdown.value = false\n    accountDropdownCloseTimer = null\n  }, 200)\n}\n\nfunction fillFromAccount(item: RememberedAccount) {\n  form.emailOrPhone = item.emailOrPhone\n  form.password = item.password\n}\n\nfunction selectAccount(item: RememberedAccount) {\n  fillFromAccount(item)\n  showAccountDropdown.value = false\n  if (accountDropdownCloseTimer) {\n    clearTimeout(accountDropdownCloseTimer)\n    accountDropdownCloseTimer = null\n  }\n}\n\nfunction deleteRemembered(item: RememberedAccount) {\n  removeRememberedAccount(item.emailOrPhone)\n  loadRememberedList()\n}\n\nonMounted(() => loadRememberedList())\n\nconst rules: FormRules = {\n  emailOrPhone: [{ required: true, message: '请输入邮箱或手机号', trigger: 'blur' }],\n  password: [\n    { required: true, message: '请输入密码', trigger: 'blur' },\n    { min: 6, message: '密码长度不能少于6位', trigger: 'blur' },\n  ],\n}\n\nasync function handleLogin() {\n  if (!formRef.value) return\n\n  await formRef.value.validate(async (valid) => {\n    if (valid) {\n      loading.value = true\n      try {\n        await authStore.login(form.emailOrPhone, form.password)\n        if (rememberMe.value) {\n          await addRememberedAccount(form.emailOrPhone, form.password)\n          await loadRememberedList()\n        }\n        ElMessage.success('登录成功')\n\n        const rawRedirect = (route.query.redirect as string) || '/'\n        const redirect =\n          rawRedirect.startsWith('/') && !rawRedirect.startsWith('//') ? rawRedirect : '/'\n        router.replace(redirect)\n      } catch (error: unknown) {\n        ElMessage.error((error as Error).message || '登录失败')\n      } finally {\n        loading.value = false\n      }\n    }\n  })\n}\n</script>\n\n<style scoped>\n.login-page {\n  min-height: calc(100vh - var(--header-height) - 80px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: var(--spacing-lg);\n  background: transparent;\n}\n\n.login-container {\n  width: 100%;\n  max-width: 420px;\n}\n\n.login-card {\n  border-radius: var(--border-radius-large);\n  box-shadow: var(--card-shadow);\n  border-color: var(--border-color-lighter);\n}\n\n.card-header {\n  text-align: center;\n}\n\n.card-header h2 {\n  font-size: var(--font-size-xxl);\n  font-weight: 600;\n  margin-bottom: var(--spacing-xs);\n  color: var(--color-text-primary);\n}\n\n.subtitle {\n  color: var(--color-text-secondary);\n  font-size: var(--font-size-sm);\n}\n\n.form-actions {\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.login-button {\n  width: 100%;\n}\n\n.register-button {\n  width: 100%;\n}\n\n.demo-tip {\n  margin-top: var(--spacing-md);\n}\n\n.demo-tip p {\n  margin: var(--spacing-xs) 0;\n  font-size: var(--font-size-xs);\n}\n\n.account-input-wrap {\n  position: relative;\n  width: 100%;\n}\n\n.remembered-dropdown {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  margin-top: 4px;\n  padding: var(--spacing-xs);\n  background: var(--el-bg-color-overlay);\n  border: 1px solid var(--el-border-color-light);\n  border-radius: var(--border-radius-base);\n  box-shadow: var(--el-box-shadow-light);\n  z-index: 10;\n  max-height: 240px;\n  overflow-y: auto;\n}\n\n.remembered-dropdown-label {\n  font-size: var(--font-size-xs);\n  color: var(--color-text-secondary);\n  padding: var(--spacing-xs) var(--spacing-sm);\n  margin-bottom: var(--spacing-xs);\n}\n\n.remembered-dropdown-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: var(--spacing-xs) var(--spacing-sm);\n  border-radius: var(--border-radius-small);\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.remembered-dropdown-item:hover {\n  background: var(--el-fill-color-light);\n}\n\n.remembered-dropdown-delete {\n  opacity: 0.7;\n}\n\n.remembered-dropdown-delete:hover {\n  opacity: 1;\n}\n</style>\n"],"names":["router","useRouter","route","useRoute","authStore","useAuthStore","formRef","ref","loading","rememberMe","rememberedList","showAccountDropdown","accountDropdownCloseTimer","form","reactive","loadRememberedList","getRememberedAccounts","scheduleCloseAccountDropdown","fillFromAccount","item","selectAccount","deleteRemembered","removeRememberedAccount","onMounted","rules","handleLogin","valid","addRememberedAccount","ElMessage","rawRedirect","redirect","error","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_card","_cache","_component_el_form","_component_el_form_item","_component_el_input","$event","_unref","User","_withDirectives","_hoisted_3","_Fragment","_renderList","_toDisplayString","_component_el_button","_withModifiers","Lock","_hoisted_5","_component_el_checkbox","_component_el_link","_component_el_divider","_hoisted_6","_component_el_alert"],"mappings":"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"}