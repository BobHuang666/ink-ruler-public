import{d as j,u as P,l as c,O as R,C as T,M as q,n as z,c as t,a as o,e as d,w as r,r as x,F as S,b as n,D as l,j as v,f,x as O,Y as X,g as C,X as B,Z as Y,A as Z,o as a,E as L,_ as $}from"./index-BbY8ega0.js";import{c as G,d as H,e as J,u as K,f as Q}from"./classic-BQJPRF9i.js";const U={class:"classic-detail-page"},W={class:"detail-inner"},ee={key:0,class:"loading-wrap"},ae={class:"main-card"},te={class:"original content-font"},se={key:0,class:"translation"},le={class:"meta"},oe={key:0},ne={key:1},ie={key:2},ue={key:3},re={key:4},ce={class:"actions"},de={key:0,class:"similar-section"},_e={class:"similar-grid"},ve={class:"original content-font"},fe={key:0,class:"translation"},ge={class:"meta"},ye={key:0},me={key:1},pe={key:2,class:"empty"},he=j({__name:"ItemDetail",setup(ke){const N=T(),D=Z(),A=P(),e=c(null),g=c([]),k=c(!0),y=c(!1),m=c(!1),_=c(!1),w=c(!1),p=R(()=>{const u=N.params.id,s=parseInt(String(u),10);return Number.isNaN(s)?0:s});async function I(){if(p.value){k.value=!0;try{const[u,s]=await Promise.all([G(p.value),H(p.value)]);e.value=u,g.value=s??[]}catch{e.value=null,g.value=[]}finally{k.value=!1}}}async function F(){if(!e.value||y.value)return;const u=w.value?"decrement":"increment";y.value=!0;try{const s=await J(e.value.id,{action:u});e.value&&(e.value.likes=s.likes),w.value=!w.value}finally{y.value=!1}}async function V(){if(!(!e.value||m.value||!A.isAuthenticated)){m.value=!0;try{_.value?(await K(e.value.id),_.value=!1,L.success("已取消收藏")):(await Q(e.value.id),_.value=!0,L.success("已收藏"))}catch(u){L.error(u.message)}finally{m.value=!1}}}function E(){D.push({path:"/login",query:{redirect:N.fullPath}})}return q(p,I),z(I),(u,s)=>{const h=x("el-icon"),b=x("el-button"),M=x("router-link");return a(),t("div",U,[s[2]||(s[2]=o("div",{class:"page-bg"},[o("div",{class:"page-bg-image"}),o("div",{class:"page-bg-gradient"})],-1)),o("div",W,[k.value?(a(),t("div",ee,[d(h,{class:"is-loading",size:32},{default:r(()=>[d(f(X))]),_:1})])):e.value?(a(),t(S,{key:1},[o("div",ae,[o("p",te,l(e.value.original_text),1),e.value.translation?(a(),t("p",se,l(e.value.translation),1)):n("",!0),o("div",le,[e.value.source?(a(),t("span",oe,"出处："+l(e.value.source),1)):n("",!0),e.value.author?(a(),t("span",ne,l(e.value.author),1)):n("",!0),e.value.dynasty?(a(),t("span",ie,l(e.value.dynasty),1)):n("",!0),e.value.genre?(a(),t("span",ue,l(e.value.genre),1)):n("",!0),e.value.categories?(a(),t("span",re,"分类："+l(Array.isArray(e.value.categories)?e.value.categories.join("、"):e.value.categories),1)):n("",!0)]),o("div",ce,[d(b,{loading:y.value,onClick:F},{default:r(()=>[d(h,null,{default:r(()=>[d(f(B))]),_:1}),C(" "+l(e.value.likes)+" 点赞 ",1)]),_:1},8,["loading"]),f(A).isAuthenticated?(a(),v(b,{key:0,loading:m.value,onClick:V},{default:r(()=>[_.value?(a(),v(h,{key:0},{default:r(()=>[d(f(Y))]),_:1})):(a(),v(h,{key:1},{default:r(()=>[d(f(B))]),_:1})),C(" "+l(_.value?"已收藏":"收藏"),1)]),_:1},8,["loading"])):(a(),v(b,{key:1,onClick:E},{default:r(()=>[...s[0]||(s[0]=[C("登录后收藏",-1)])]),_:1}))])]),g.value.length?(a(),t("section",de,[s[1]||(s[1]=o("h2",{class:"section-title"},"相似推荐",-1)),o("div",_e,[(a(!0),t(S,null,O(g.value,i=>(a(),v(M,{key:i.id,to:`/classic/item/${i.id}`,class:"similar-card"},{default:r(()=>[o("p",ve,l(i.original_text),1),i.translation?(a(),t("p",fe,l(i.translation),1)):n("",!0),o("div",ge,[i.author?(a(),t("span",ye,l(i.author),1)):n("",!0),i.dynasty?(a(),t("span",me,l(i.dynasty),1)):n("",!0)])]),_:2},1032,["to"]))),128))])])):n("",!0)],64)):(a(),t("div",pe,"条目不存在"))])])}}}),xe=$(he,[["__scopeId","data-v-6ce331bc"]]);export{xe as default};
//# sourceMappingURL=ItemDetail-BWaSmo-0.js.map
