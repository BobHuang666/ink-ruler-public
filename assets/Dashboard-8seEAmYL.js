import{R as V,d as _e,l as i,n as ve,a0 as fe,E as f,c as ge,a as s,e,w as a,r as u,f as D,a1 as be,t as we,K as ye,a2 as he,s as y,v as I,D as _,g as p,y as ke,a3 as xe,j as E,P as Ve,b as Ce,o as z,_ as Ue}from"./index-DuIC7plb.js";async function De(){return(await V.get("/admin/metrics")).data}async function ze(r){const n=r.page??1,v=r.size??10,c=await V.get("/admin/users",{params:{q:r.q,role:r.role,status:r.status,page:n,size:v}});return{items:(c.data.list??[]).map(m=>({id:m.id,email:m.email,phone:m.phone,nickname:m.nickname??"",avatar:m.avatar,role:m.role,status:m.status,created_at:m.created_at??"",updated_at:m.updated_at??""})),total:c.data.total??0,page:n,size:v}}async function ee(r,n){await V.patch(`/admin/users/${r}`,n)}async function Se(r){const n=r?.page??1,v=r?.size??20,c=await V.get("/admin/logs",{params:{page:n,size:v}});return{items:c.data.list??[],total:c.data.total??0,page:n,size:v}}async function Le(r){const n=r?.page??1,v=r?.size??10,c=await V.get("/admin/flags",{params:{page:n,size:v}});return{items:c.data.list??[],total:c.data.total??0,page:n,size:v}}async function Ie(r,n){await V.patch(`/admin/flags/${r}`,{status:n})}const Ee={class:"admin-page"},Fe={class:"admin-container"},Me={class:"dashboard-content"},Te={class:"metric-item"},$e={class:"metric-value"},Pe={class:"metric-item"},Be={class:"metric-value"},Ne={class:"metric-item"},qe={class:"metric-value"},Ke={class:"metric-item"},Re={class:"metric-value"},je={class:"users-content"},Ae={class:"search-bar"},Qe={class:"table-scroll-wrap"},We={class:"content-content"},Ge={class:"table-scroll-wrap"},He={class:"logs-content"},Je={class:"table-scroll-wrap"},Oe=_e({__name:"Dashboard",setup(r){const n=i("dashboard"),v=i(3),c=i({user_count:0,active_user_count:0,essay_count:0,token_usage:{total:0,today:0,this_month:0}}),F=i([]),m=i(!1),M=i(""),T=i(""),$=i(""),P=i(1),B=i(10),G=i(0),H=i([]),N=i(!1),J=i([]),q=i(!1),C=i(!1),w=i({role:"",status:""}),K=i(null);function R(){v.value=window.innerWidth>=768?3:1}ve(async()=>{R(),window.addEventListener("resize",R),await te(),await h(),await O(),await ae()}),fe(()=>{window.removeEventListener("resize",R)});async function te(){try{c.value=await De()}catch(o){f.error(o.message||"获取数据失败")}}async function h(){m.value=!0;try{const o=await ze({q:M.value,role:T.value,status:$.value,page:P.value,size:B.value});F.value=o.items,G.value=o.total}catch(o){f.error(o.message||"获取用户列表失败")}finally{m.value=!1}}async function O(){N.value=!0;try{const o=await Le({});H.value=o.items}catch(o){f.error(o.message||"获取内容标记失败")}finally{N.value=!1}}async function ae(){q.value=!0;try{const o=await Se({});J.value=o.items}catch(o){f.error(o.message||"获取日志失败")}finally{q.value=!1}}function le(o){o!==n.value&&(n.value=o)}function se(o){K.value=o.id,w.value={role:o.role,status:o.status},C.value=!0}async function oe(){if(K.value)try{await ee(K.value,w.value),f.success("更新成功"),C.value=!1,await h()}catch(o){f.error(o.message||"更新失败")}}async function ne(o){try{await ee(o.id,{status:o.status==="active"?"disabled":"active"}),f.success("操作成功"),await h()}catch(t){f.error(t.message||"操作失败")}}async function ue(o){try{await Ie(o.id,"resolved"),f.success("标记已处理"),await O()}catch(t){f.error(t.message||"操作失败")}}return(o,t)=>{const U=u("el-icon"),S=u("el-menu-item"),de=u("el-menu"),k=u("el-col"),g=u("el-card"),X=u("el-row"),j=u("el-descriptions-item"),ie=u("el-descriptions"),re=u("el-input"),b=u("el-option"),L=u("el-select"),x=u("el-button"),d=u("el-table-column"),A=u("el-tag"),Q=u("el-table"),ce=u("el-pagination"),Y=u("el-form-item"),me=u("el-form"),pe=u("el-dialog"),W=Ve("loading");return z(),ge("div",Ee,[s("div",Fe,[e(X,{gutter:20},{default:a(()=>[e(k,{xs:24,sm:24,md:4,lg:4},{default:a(()=>[e(de,{"default-active":n.value,class:"admin-menu",onSelect:le},{default:a(()=>[e(S,{index:"dashboard"},{default:a(()=>[e(U,null,{default:a(()=>[e(D(be))]),_:1}),t[9]||(t[9]=s("span",null,"数据看板",-1))]),_:1}),e(S,{index:"users"},{default:a(()=>[e(U,null,{default:a(()=>[e(D(we))]),_:1}),t[10]||(t[10]=s("span",null,"用户管理",-1))]),_:1}),e(S,{index:"content"},{default:a(()=>[e(U,null,{default:a(()=>[e(D(ye))]),_:1}),t[11]||(t[11]=s("span",null,"内容管理",-1))]),_:1}),e(S,{index:"logs"},{default:a(()=>[e(U,null,{default:a(()=>[e(D(he))]),_:1}),t[12]||(t[12]=s("span",null,"操作日志",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(k,{xs:24,sm:24,md:20,lg:20},{default:a(()=>[y(s("div",Me,[t[18]||(t[18]=s("h2",{class:"header-font"},"数据看板",-1)),e(X,{gutter:20,class:"metrics-row"},{default:a(()=>[e(k,{xs:12,sm:12,md:6,lg:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[s("div",Te,[s("div",$e,_(c.value.user_count),1),t[13]||(t[13]=s("div",{class:"metric-label"},"总用户数",-1))])]),_:1})]),_:1}),e(k,{xs:12,sm:12,md:6,lg:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[s("div",Pe,[s("div",Be,_(c.value.active_user_count),1),t[14]||(t[14]=s("div",{class:"metric-label"},"活跃用户",-1))])]),_:1})]),_:1}),e(k,{xs:12,sm:12,md:6,lg:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[s("div",Ne,[s("div",qe,_(c.value.essay_count),1),t[15]||(t[15]=s("div",{class:"metric-label"},"作文提交量",-1))])]),_:1})]),_:1}),e(k,{xs:12,sm:12,md:6,lg:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[s("div",Ke,[s("div",Re,_(c.value.token_usage.total),1),t[16]||(t[16]=s("div",{class:"metric-label"},"Token使用总量",-1))])]),_:1})]),_:1})]),_:1}),e(g,{shadow:"never",class:"token-card"},{default:a(()=>[t[17]||(t[17]=s("h3",{class:"header-font"},"Token使用情况",-1)),e(ie,{column:v.value,border:""},{default:a(()=>[e(j,{label:"今日使用"},{default:a(()=>[p(_(c.value.token_usage.today),1)]),_:1}),e(j,{label:"本月使用"},{default:a(()=>[p(_(c.value.token_usage.this_month),1)]),_:1}),e(j,{label:"总使用量"},{default:a(()=>[p(_(c.value.token_usage.total),1)]),_:1})]),_:1},8,["column"])]),_:1}),t[19]||(t[19]=s("p",{class:"dashboard-note"},"活跃用户：统计最近 7 天内有过登录的用户。",-1))],512),[[I,n.value==="dashboard"]]),y(s("div",je,[t[22]||(t[22]=s("h2",{class:"header-font"},"用户管理",-1)),e(g,{shadow:"never"},{default:a(()=>[s("div",Ae,[e(re,{modelValue:M.value,"onUpdate:modelValue":t[0]||(t[0]=l=>M.value=l),placeholder:"搜索用户...",class:"search-input",clearable:"",onKeyup:ke(h,["enter"])},{prefix:a(()=>[e(U,null,{default:a(()=>[e(D(xe))]),_:1})]),_:1},8,["modelValue"]),e(L,{modelValue:T.value,"onUpdate:modelValue":t[1]||(t[1]=l=>T.value=l),placeholder:"角色",class:"search-select",clearable:""},{default:a(()=>[e(b,{label:"学生",value:"student"}),e(b,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"]),e(L,{modelValue:$.value,"onUpdate:modelValue":t[2]||(t[2]=l=>$.value=l),placeholder:"状态",class:"search-select",clearable:""},{default:a(()=>[e(b,{label:"正常",value:"active"}),e(b,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"]),e(x,{type:"primary",onClick:h},{default:a(()=>[...t[20]||(t[20]=[p("搜索",-1)])]),_:1})]),s("div",Qe,[y((z(),E(Q,{data:F.value,style:{width:"100%","margin-top":"20px"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"nickname",label:"昵称"}),e(d,{prop:"email",label:"邮箱"}),e(d,{prop:"role",label:"角色",width:"100"},{default:a(({row:l})=>[e(A,{type:l.role==="admin"?"danger":"primary"},{default:a(()=>[p(_(l.role==="admin"?"管理员":"学生"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(A,{type:l.status==="active"?"success":"info"},{default:a(()=>[p(_(l.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"操作",width:"200"},{default:a(({row:l})=>[e(x,{type:"primary",text:"",onClick:Z=>se(l)},{default:a(()=>[...t[21]||(t[21]=[p("编辑",-1)])]),_:1},8,["onClick"]),e(x,{type:l.status==="active"?"warning":"success",text:"",onClick:Z=>ne(l)},{default:a(()=>[p(_(l.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[W,m.value]])]),e(ce,{"current-page":P.value,"onUpdate:currentPage":t[3]||(t[3]=l=>P.value=l),"page-size":B.value,"onUpdate:pageSize":t[4]||(t[4]=l=>B.value=l),total:G.value,layout:"total, prev, pager, next",style:{"margin-top":"20px"},onCurrentChange:h},null,8,["current-page","page-size","total"])]),_:1})],512),[[I,n.value==="users"]]),y(s("div",We,[t[24]||(t[24]=s("h2",{class:"header-font"},"内容管理",-1)),e(g,{shadow:"never"},{default:a(()=>[s("div",Ge,[y((z(),E(Q,{data:H.value,class:"admin-table",style:{width:"100%"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"target_type",label:"类型",width:"120"}),e(d,{prop:"target_id",label:"目标ID",width:"100"}),e(d,{prop:"reason",label:"原因"}),e(d,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(A,{type:l.status==="resolved"?"success":"warning"},{default:a(()=>[p(_(l.status==="resolved"?"已处理":"待处理"),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"操作",width:"150"},{default:a(({row:l})=>[l.status==="open"?(z(),E(x,{key:0,type:"success",text:"",onClick:Z=>ue(l)},{default:a(()=>[...t[23]||(t[23]=[p(" 标记已处理 ",-1)])]),_:1},8,["onClick"])):Ce("",!0)]),_:1})]),_:1},8,["data"])),[[W,N.value]])])]),_:1})],512),[[I,n.value==="content"]]),y(s("div",He,[t[25]||(t[25]=s("h2",{class:"header-font"},"操作日志",-1)),e(g,{shadow:"never"},{default:a(()=>[s("div",Je,[y((z(),E(Q,{data:J.value,class:"admin-table",style:{width:"100%"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"action",label:"操作"}),e(d,{prop:"target_type",label:"目标类型",width:"120"}),e(d,{prop:"target_id",label:"目标ID",width:"100"}),e(d,{prop:"ip",label:"IP",width:"150"}),e(d,{prop:"created_at",label:"时间",width:"180"},{default:a(({row:l})=>[p(_(new Date(l.created_at).toLocaleString()),1)]),_:1})]),_:1},8,["data"])),[[W,q.value]])])]),_:1})],512),[[I,n.value==="logs"]])]),_:1})]),_:1})]),e(pe,{modelValue:C.value,"onUpdate:modelValue":t[8]||(t[8]=l=>C.value=l),title:"编辑用户",width:"500px",class:"edit-user-dialog"},{footer:a(()=>[e(x,{onClick:t[7]||(t[7]=l=>C.value=!1)},{default:a(()=>[...t[26]||(t[26]=[p("取消",-1)])]),_:1}),e(x,{type:"primary",onClick:oe},{default:a(()=>[...t[27]||(t[27]=[p("保存",-1)])]),_:1})]),default:a(()=>[e(me,{model:w.value,"label-width":"100px"},{default:a(()=>[e(Y,{label:"角色"},{default:a(()=>[e(L,{modelValue:w.value.role,"onUpdate:modelValue":t[5]||(t[5]=l=>w.value.role=l)},{default:a(()=>[e(b,{label:"学生",value:"student"}),e(b,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),e(Y,{label:"状态"},{default:a(()=>[e(L,{modelValue:w.value.status,"onUpdate:modelValue":t[6]||(t[6]=l=>w.value.status=l)},{default:a(()=>[e(b,{label:"正常",value:"active"}),e(b,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ye=Ue(Oe,[["__scopeId","data-v-e02a794c"]]);export{Ye as default};
//# sourceMappingURL=Dashboard-8seEAmYL.js.map
