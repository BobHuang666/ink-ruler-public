import{d as j,u as G,k as v,I as H,C as J,m as K,c as l,a,e as g,w as d,r as L,F as i,b as u,t as o,g as c,x as A,N as m,f as p,a9 as O,a2 as S,ab as Q,a7 as V,A as U,o as t,E as B,_ as W}from"./index-Bn_Xs3lU.js";import{c as X,d as Y,e as Z,u as ee,f as ae}from"./classic-CnXJWy7s.js";const te={class:"classic-detail-page"},se={class:"detail-inner"},le={key:0,class:"loading-wrap"},ne={class:"main-card"},oe={class:"original content-font"},ie={key:0,class:"translation-wrap"},re={class:"translation"},ue={class:"meta"},ce={class:"meta-categories"},de={class:"actions"},ve={key:0,class:"similar-section"},ge={class:"similar-grid grid-wrap"},_e={class:"card-inner"},ye={class:"card-original"},fe={class:"card-footer"},me={class:"card-meta"},pe={key:4,class:"card-genre"},ke={class:"card-right"},he={class:"card-likes"},Ce={key:2,class:"empty"},we=j({name:"ClassicItemDetail",__name:"ItemDetail",setup(be){const D=J(),z=U(),F=G(),s=v(null),k=v([]),b=v(!0),h=v(!1),C=v(!1),_=v(!1),w=v(!1),x=H(()=>{const r=D.params.id,e=parseInt(String(r),10);return Number.isNaN(e)?0:e}),E={格物修身:"cat-purple",济世情怀:"cat-indigo",道德情操:"cat-sky",人与自然:"cat-cyan",哲理思辨:"cat-emerald",文化传承:"cat-lime",理想信念:"cat-amber",成长成才:"cat-orange",家国情怀:"cat-red"};function N(r){const e=r.categories;return e?(Array.isArray(e)?e:String(e).split(",").map(f=>f.trim())).slice(0,2):[]}function T(r){return E[r.trim()]??"cat-gray"}async function M(){if(x.value){b.value=!0;try{const[r,e]=await Promise.all([X(x.value),Y(x.value)]);s.value=r,k.value=e??[]}catch{s.value=null,k.value=[]}finally{b.value=!1}}}async function P(){if(!s.value||h.value)return;const r=w.value?"decrement":"increment";h.value=!0;try{const e=await Z(s.value.id,{action:r});s.value&&(s.value.likes=e.likes),w.value=!w.value}finally{h.value=!1}}async function R(){if(!(!s.value||C.value||!F.isAuthenticated)){C.value=!0;try{_.value?(await ee(s.value.id),_.value=!1,B.success("已取消收藏")):(await ae(s.value.id),_.value=!0,B.success("已收藏"))}catch(r){B.error(r.message)}finally{C.value=!1}}}function q(){z.push({path:"/login",query:{redirect:D.fullPath}})}return K(M),(r,e)=>{const y=L("el-icon"),f=L("el-button"),$=L("router-link");return t(),l("div",te,[e[7]||(e[7]=a("div",{class:"page-bg"},[a("div",{class:"page-bg-gradient"})],-1)),a("div",se,[b.value?(t(),l("div",le,[g(y,{class:"is-loading",size:32},{default:d(()=>[g(p(O))]),_:1})])):s.value?(t(),l(i,{key:1},[a("div",ne,[a("p",oe,o(s.value.original_text),1),s.value.translation?(t(),l("div",ie,[e[0]||(e[0]=a("span",{class:"translation-label"},"翻译",-1)),a("p",re,o(s.value.translation),1)])):u("",!0),a("dl",ue,[s.value.source?(t(),l(i,{key:0},[e[1]||(e[1]=a("dt",null,"出处",-1)),a("dd",null,o(s.value.source),1)],64)):u("",!0),s.value.author||s.value.dynasty?(t(),l(i,{key:1},[e[2]||(e[2]=a("dt",null,"作者",-1)),a("dd",null,[s.value.dynasty?(t(),l(i,{key:0},[c("［"+o(s.value.dynasty)+"］",1)],64)):u("",!0),c(" "+o(s.value.author),1)])],64)):u("",!0),s.value.genre?(t(),l(i,{key:2},[e[3]||(e[3]=a("dt",null,"体裁",-1)),a("dd",null,o(s.value.genre),1)],64)):u("",!0),N(s.value).length?(t(),l(i,{key:3},[e[4]||(e[4]=a("dt",null,"分类",-1)),a("dd",ce,[(t(!0),l(i,null,A(N(s.value),n=>(t(),l("span",{key:n,class:S(["category-tag",T(n)])},o(n),3))),128))])],64)):u("",!0)]),a("div",de,[g(f,{loading:h.value,onClick:P},{default:d(()=>[w.value?(t(),m(y,{key:0},{default:d(()=>[g(p(Q))]),_:1})):(t(),m(y,{key:1},{default:d(()=>[g(p(V))]),_:1})),c(" "+o(s.value.likes)+" 点赞 ",1)]),_:1},8,["loading"]),p(F).isAuthenticated?(t(),m(f,{key:0,loading:C.value,onClick:R},{default:d(()=>[a("span",{class:S(["action-icon-heart",{"is-filled":_.value}])},null,2),c(" "+o(_.value?"已收藏":"收藏"),1)]),_:1},8,["loading"])):(t(),m(f,{key:1,onClick:q},{default:d(()=>[...e[5]||(e[5]=[c("登录后收藏",-1)])]),_:1}))])]),k.value.length?(t(),l("section",ve,[e[6]||(e[6]=a("h2",{class:"section-title"},"相似推荐",-1)),a("div",ge,[(t(!0),l(i,null,A(k.value,n=>(t(),m($,{key:n.id,to:`/classic/item/${n.id}`,class:"item-card"},{default:d(()=>[a("div",_e,[a("h3",ye,o(n.original_text),1),a("div",fe,[a("span",me,[n.dynasty?(t(),l(i,{key:0},[c("［"+o(n.dynasty)+"］",1)],64)):u("",!0),n.author?(t(),l(i,{key:1},[c(o(n.author),1)],64)):u("",!0),n.author&&n.source?(t(),l(i,{key:2},[c(" · ")],64)):u("",!0),n.source?(t(),l(i,{key:3},[c(o(n.source),1)],64)):u("",!0),n.genre?(t(),l("span",pe,o(n.genre),1)):u("",!0)]),a("div",ke,[a("span",he,[g(y,{size:14},{default:d(()=>[g(p(V))]),_:1}),c(" "+o(n.likes??0),1)]),(t(!0),l(i,null,A(N(n),I=>(t(),l("span",{key:I,class:S(["category-tag",T(I)])},o(I),3))),128))])])])]),_:2},1032,["to"]))),128))])])):u("",!0)],64)):(t(),l("div",Ce,"条目不存在"))])])}}}),Ie=W(we,[["__scopeId","data-v-864144c5"]]);export{Ie as default};
//# sourceMappingURL=ItemDetail-y1mFK54b.js.map
