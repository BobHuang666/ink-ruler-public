import{d as A,m as z,l as R,c as E,e as n,r as c,w as s,a as o,f as u,z as H,g as f,E as p,o as m,_ as B,b as h,A as k,u as W,B as j,t as q,j as $,v as G,C as J}from"./index-DcL45HtP.js";import{u as K}from"./essay-Fb9edn05.js";const O={class:"essay-editor"},P=A({__name:"EssayEditor",emits:["update:content","update:file"],setup(v,{expose:C,emit:l}){const _=l,t=z({title:"",prompt:"",content_text:""}),i=R([]);function b(y){if(y.raw){if(y.raw.size>1024*1024){p.error("文件大小不能超过1MB"),i.value=[];return}const r=new FileReader;r.onload=x=>{const w=x.target?.result;t.content_text=w,_("update:content",w),y.raw&&_("update:file",y.raw)},y.raw&&r.readAsText(y.raw)}}function V(){t.content_text="",_("update:file",null)}return C({form:t,clear:()=>{t.title="",t.prompt="",t.content_text="",i.value=[]}}),(y,r)=>{const x=c("el-input"),w=c("el-form-item"),D=c("el-icon"),a=c("el-upload"),e=c("el-form");return m(),E("div",O,[n(e,{model:t,"label-width":"80px"},{default:s(()=>[n(w,{label:"题目"},{default:s(()=>[n(x,{modelValue:t.title,"onUpdate:modelValue":r[0]||(r[0]=d=>t.title=d),placeholder:"请输入作文题目（可选）"},null,8,["modelValue"])]),_:1}),n(w,{label:"类型"},{default:s(()=>[n(x,{modelValue:t.prompt,"onUpdate:modelValue":r[1]||(r[1]=d=>t.prompt=d),placeholder:"请输入作文类型或提示（可选）"},null,8,["modelValue"])]),_:1}),n(w,{label:"内容"},{default:s(()=>[n(a,{"file-list":i.value,"onUpdate:fileList":r[2]||(r[2]=d=>i.value=d),"auto-upload":!1,limit:1,"on-change":b,"on-remove":V,accept:".docx,.doc",drag:""},{tip:s(()=>[...r[4]||(r[4]=[o("div",{class:"el-upload__tip"},"支持Word文档，文件大小不超过1MB",-1)])]),default:s(()=>[n(D,{class:"el-icon--upload"},{default:s(()=>[n(u(H))]),_:1}),r[5]||(r[5]=o("div",{class:"el-upload__text"},[f("将Word文件拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1},8,["file-list"]),n(x,{modelValue:t.content_text,"onUpdate:modelValue":r[3]||(r[3]=d=>t.content_text=d),type:"textarea",rows:15,placeholder:"或直接在此输入作文内容...",style:{"margin-top":"var(--spacing-md)"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])}}}),Q=B(P,[["__scopeId","data-v-44e235b6"]]),X={class:"correction-result"},Y={class:"stats-grid"},Z={class:"stat-item"},tt={class:"stat-value"},et={class:"stat-item"},st={class:"stat-value"},ot={class:"stat-item"},nt={class:"stat-value"},at={key:0,class:"stat-item"},lt={class:"stat-value"},rt={class:"summary-text"},it=["innerHTML"],dt=A({__name:"CorrectionResult",props:{correction:{}},setup(v){return(C,l)=>{const _=c("el-card");return m(),E("div",X,[n(_,{shadow:"never",class:"stats-card"},{header:s(()=>[...l[0]||(l[0]=[o("h3",null,"语言学统计",-1)])]),default:s(()=>[o("div",Y,[o("div",Z,[o("div",tt,k(v.correction.stats.word_count),1),l[1]||(l[1]=o("div",{class:"stat-label"},"字数",-1))]),o("div",et,[o("div",st,k(v.correction.stats.paragraph_count),1),l[2]||(l[2]=o("div",{class:"stat-label"},"段落数",-1))]),o("div",ot,[o("div",nt,k(v.correction.stats.typo_count),1),l[3]||(l[3]=o("div",{class:"stat-label"},"错别字",-1))]),v.correction.stats.sentence_count?(m(),E("div",at,[o("div",lt,k(v.correction.stats.sentence_count),1),l[4]||(l[4]=o("div",{class:"stat-label"},"句子数",-1))])):h("",!0)])]),_:1}),n(_,{shadow:"never",class:"summary-card"},{header:s(()=>[...l[5]||(l[5]=[o("h3",null,"评语与建议",-1)])]),default:s(()=>[o("p",rt,k(v.correction.summary),1)]),_:1}),n(_,{shadow:"never",class:"diff-card"},{header:s(()=>[...l[6]||(l[6]=[o("h3",null,"修改痕迹",-1)])]),default:s(()=>[o("div",{class:"diff-content",innerHTML:v.correction.diff_html},null,8,it)]),_:1})])}}}),ut=B(dt,[["__scopeId","data-v-9f8331de"]]),ct={class:"correction-page"},_t={class:"container"},ft={class:"page-header"},mt={class:"header-actions"},pt={key:0},vt={class:"submit-section"},yt={key:1},wt={key:2},gt={class:"result-header"},xt=A({__name:"Correction",setup(v){const C=q(),l=G(),_=W(),t=K(),i=R(),b=R(!1);j(async()=>{const a=C.params.id;a?await t.fetchEssay(Number(a)):t.clearCurrent(),_.isAuthenticated&&await t.fetchDrafts()});async function V(){if(!i.value)return;const{form:a}=i.value;if(!a.content_text.trim()){p.warning("请输入作文内容");return}try{await t.submitEssay({title:a.title,prompt:a.prompt,content_text:a.content_text,source_type:"text"});const e=window.setInterval(async()=>{t.currentEssay&&(await t.fetchEssay(t.currentEssay.id),(t.currentEssay.status==="done"||t.currentEssay.status==="failed")&&(window.clearInterval(e),t.currentEssay.status==="done"&&t.currentEssay.correction&&(t.currentCorrection=t.currentEssay.correction)))},2e3);window.setTimeout(()=>window.clearInterval(e),1e4)}catch(e){p.error(e.message||"提交失败")}}function y(){t.clearCurrent(),i.value&&i.value.clear(),l.push("/essay/correction")}async function r(){if(t.currentEssay)try{await t.favoriteEssay(t.currentEssay.id),p.success("收藏成功")}catch(a){p.error(a.message||"收藏失败")}}async function x(){if(!i.value)return;const{form:a}=i.value;if(!a.content_text.trim()){p.warning("请输入作文内容");return}if(!_.isAuthenticated){p.warning("请先登录"),l.push("/login");return}try{await t.createDraft({title:a.title,content_text:a.content_text}),p.success("草稿已保存")}catch(e){p.error(e.message||"保存失败")}}function w(a){i.value&&(i.value.form.title=a.title||"",i.value.form.content_text=a.content_text),b.value=!1}async function D(a){try{await J.confirm("确定要删除这个草稿吗？","提示",{type:"warning"}),await t.fetchDrafts(),p.success("删除成功")}catch{}}return(a,e)=>{const d=c("el-button"),S=c("el-link"),M=c("el-alert"),L=c("el-result"),N=c("el-card"),I=c("el-table-column"),T=c("el-table"),U=c("el-dialog");return m(),E("div",ct,[o("div",_t,[n(N,{shadow:"never"},{header:s(()=>[o("div",ft,[e[5]||(e[5]=o("h2",null,"作文批改",-1)),o("div",mt,[u(t).currentEssay?(m(),$(d,{key:0,onClick:x},{default:s(()=>[...e[3]||(e[3]=[f("保存草稿",-1)])]),_:1})):h("",!0),u(t).drafts.length>0?(m(),$(d,{key:1,onClick:e[0]||(e[0]=g=>b.value=!0)},{default:s(()=>[...e[4]||(e[4]=[f(" 草稿列表 ",-1)])]),_:1})):h("",!0)])])]),default:s(()=>[!u(t).currentEssay||u(t).currentEssay.status!=="done"&&u(t).currentEssay.status!=="processing"?(m(),E("div",pt,[n(Q,{ref_key:"editorRef",ref:i},null,512),o("div",vt,[u(_).isAuthenticated?h("",!0):(m(),$(M,{key:0,title:"提示",type:"warning",closable:!1,"show-icon":""},{default:s(()=>[e[7]||(e[7]=f(" 未登录用户无法保存批改记录，",-1)),n(S,{type:"primary",onClick:e[1]||(e[1]=g=>a.$router.push("/login"))},{default:s(()=>[...e[6]||(e[6]=[f(" 立即登录 ",-1)])]),_:1})]),_:1})),n(d,{type:"primary",size:"large",loading:u(t).loading,onClick:V},{default:s(()=>[...e[8]||(e[8]=[f(" 提交批改 ",-1)])]),_:1},8,["loading"])])])):u(t).currentEssay&&u(t).currentEssay.status==="processing"?(m(),E("div",yt,[n(L,{icon:"loading",title:"正在批改中..."},{"sub-title":s(()=>[...e[9]||(e[9]=[o("p",null,"AI正在分析您的作文，请稍候",-1)])]),_:1})])):u(t).currentCorrection?(m(),E("div",wt,[o("div",gt,[n(d,{onClick:y},{default:s(()=>[...e[10]||(e[10]=[f("重新批改",-1)])]),_:1}),u(_).isAuthenticated?(m(),$(d,{key:0,type:"primary",onClick:r},{default:s(()=>[...e[11]||(e[11]=[f(" 收藏 ",-1)])]),_:1})):h("",!0)]),n(ut,{correction:u(t).currentCorrection},null,8,["correction"])])):h("",!0)]),_:1})]),n(U,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=g=>b.value=g),title:"草稿列表",width:"600px"},{default:s(()=>[n(T,{data:u(t).drafts,style:{width:"100%"}},{default:s(()=>[n(I,{prop:"title",label:"标题"}),n(I,{prop:"updated_at",label:"更新时间",width:"180"},{default:s(({row:g})=>[f(k(new Date(g.updated_at).toLocaleString()),1)]),_:1}),n(I,{label:"操作",width:"150"},{default:s(({row:g})=>[n(d,{type:"primary",text:"",onClick:F=>w(g)},{default:s(()=>[...e[12]||(e[12]=[f("加载",-1)])]),_:1},8,["onClick"]),n(d,{type:"danger",text:"",onClick:F=>D(g.id)},{default:s(()=>[...e[13]||(e[13]=[f("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}}),ht=B(xt,[["__scopeId","data-v-b2196b6f"]]);export{ht as default};
//# sourceMappingURL=Correction-RooauFes.js.map
