import{d as q,u as J,l as d,J as G,C as H,n as K,c as s,a as n,e as _,w as c,r as L,F as v,b as i,D as o,j as g,f,x as D,a1 as O,g as u,a5 as B,$ as F,a2 as Q,A as U,o as e,E as N,_ as W}from"./index-qlAaUHAc.js";import{c as X,d as Y,e as Z,u as ee,f as ae}from"./classic-5DaiGLHE.js";const te={class:"classic-detail-page"},se={class:"detail-inner"},ne={key:0,class:"loading-wrap"},le={class:"main-card"},oe={class:"original content-font"},ie={key:0,class:"translation"},re={class:"meta"},ce={key:0},ue={key:1},de={key:2},_e={key:3},ve={key:4},ge={class:"actions"},ye={key:0,class:"similar-section"},fe={class:"similar-grid"},me={class:"card-inner"},pe={class:"card-original"},ke={key:0,class:"card-trans-wrap"},he={class:"card-trans"},Ce={class:"card-footer"},we={class:"card-meta"},be={key:4,class:"card-genre"},xe={class:"card-right"},Ae={class:"card-likes"},Le={key:2,class:"empty"},Ne=q({name:"ClassicItemDetail",__name:"ItemDetail",setup(Ie){const I=H(),T=U(),S=J(),a=d(null),k=d([]),b=d(!0),h=d(!1),C=d(!1),m=d(!1),w=d(!1),x=G(()=>{const r=I.params.id,t=parseInt(String(r),10);return Number.isNaN(t)?0:t}),V={格物修身:"cat-purple",济世情怀:"cat-indigo",道德情操:"cat-sky",人与自然:"cat-cyan",哲理思辨:"cat-emerald",文化传承:"cat-lime",理想信念:"cat-amber",成长成才:"cat-orange",家国情怀:"cat-red"};function E(r){const t=r.categories;return t?(Array.isArray(t)?t:String(t).split(",").map(p=>p.trim())).slice(0,2):[]}function M(r){return V[r.trim()]??"cat-gray"}async function j(){if(x.value){b.value=!0;try{const[r,t]=await Promise.all([X(x.value),Y(x.value)]);a.value=r,k.value=t??[]}catch{a.value=null,k.value=[]}finally{b.value=!1}}}async function z(){if(!a.value||h.value)return;const r=w.value?"decrement":"increment";h.value=!0;try{const t=await Z(a.value.id,{action:r});a.value&&(a.value.likes=t.likes),w.value=!w.value}finally{h.value=!1}}async function P(){if(!(!a.value||C.value||!S.isAuthenticated)){C.value=!0;try{m.value?(await ee(a.value.id),m.value=!1,N.success("已取消收藏")):(await ae(a.value.id),m.value=!0,N.success("已收藏"))}catch(r){N.error(r.message)}finally{C.value=!1}}}function R(){T.push({path:"/login",query:{redirect:I.fullPath}})}return K(j),(r,t)=>{const y=L("el-icon"),p=L("el-button"),$=L("router-link");return e(),s("div",te,[t[4]||(t[4]=n("div",{class:"page-bg"},[n("div",{class:"page-bg-gradient"})],-1)),n("div",se,[b.value?(e(),s("div",ne,[_(y,{class:"is-loading",size:32},{default:c(()=>[_(f(O))]),_:1})])):a.value?(e(),s(v,{key:1},[n("div",le,[n("p",oe,o(a.value.original_text),1),a.value.translation?(e(),s("p",ie,o(a.value.translation),1)):i("",!0),n("div",re,[a.value.source?(e(),s("span",ce,"出处："+o(a.value.source),1)):i("",!0),a.value.author?(e(),s("span",ue,o(a.value.author),1)):i("",!0),a.value.dynasty?(e(),s("span",de,o(a.value.dynasty),1)):i("",!0),a.value.genre?(e(),s("span",_e,o(a.value.genre),1)):i("",!0),a.value.categories?(e(),s("span",ve,"分类："+o(Array.isArray(a.value.categories)?a.value.categories.join("、"):a.value.categories),1)):i("",!0)]),n("div",ge,[_(p,{loading:h.value,onClick:z},{default:c(()=>[w.value?(e(),g(y,{key:0},{default:c(()=>[_(f(B))]),_:1})):(e(),g(y,{key:1},{default:c(()=>[_(f(F))]),_:1})),u(" "+o(a.value.likes)+" 点赞 ",1)]),_:1},8,["loading"]),f(S).isAuthenticated?(e(),g(p,{key:0,loading:C.value,onClick:P},{default:c(()=>[m.value?(e(),g(y,{key:0},{default:c(()=>[_(f(B))]),_:1})):(e(),g(y,{key:1},{default:c(()=>[_(f(F))]),_:1})),u(" "+o(m.value?"已收藏":"收藏"),1)]),_:1},8,["loading"])):(e(),g(p,{key:1,onClick:R},{default:c(()=>[...t[0]||(t[0]=[u("登录后收藏",-1)])]),_:1}))])]),k.value.length?(e(),s("section",ye,[t[3]||(t[3]=n("h2",{class:"section-title"},"相似推荐",-1)),n("div",fe,[(e(!0),s(v,null,D(k.value,l=>(e(),g($,{key:l.id,to:`/classic/item/${l.id}`,class:"similar-card"},{default:c(()=>[n("div",me,[n("h3",pe,o(l.original_text),1),l.translation?(e(),s("div",ke,[n("p",he,[t[1]||(t[1]=n("b",null,"翻译：",-1)),u(o(l.translation),1)])])):i("",!0),n("div",Ce,[n("span",we,[l.dynasty?(e(),s(v,{key:0},[u("［"+o(l.dynasty)+"］",1)],64)):i("",!0),l.author?(e(),s(v,{key:1},[u(o(l.author),1)],64)):i("",!0),l.author&&l.source?(e(),s(v,{key:2},[u(" · ")],64)):i("",!0),l.source?(e(),s(v,{key:3},[u(o(l.source),1)],64)):i("",!0),l.genre?(e(),s("span",be,o(l.genre),1)):i("",!0)]),n("div",xe,[n("span",Ae,[t[2]||(t[2]=n("span",{class:"icon-heart"},null,-1)),u(" "+o(l.likes??0),1)]),(e(!0),s(v,null,D(E(l),A=>(e(),s("span",{key:A,class:Q(["category-tag",M(A)])},o(A),3))),128))])])])]),_:2},1032,["to"]))),128))])])):i("",!0)],64)):(e(),s("div",Le,"条目不存在"))])])}}}),Be=W(Ne,[["__scopeId","data-v-850612c9"]]);export{Be as default};
//# sourceMappingURL=ItemDetail-B0fD2BRm.js.map
