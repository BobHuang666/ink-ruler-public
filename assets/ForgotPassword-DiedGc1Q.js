import{d as P,l as c,m as S,J as B,K,c as h,a as d,e as s,w as l,r as u,q as M,b as D,f,H as F,D as C,g as y,z as k,y as T,A,E as m,L as H,M as J,o as z,_ as L}from"./index-qlAaUHAc.js";import{m as E}from"./format-CCCypCfS.js";const j={class:"forgot-page"},G={class:"forgot-container"},O={key:0,class:"email-hint"},Q={class:"email-code-row"},W=P({__name:"ForgotPassword",setup(X){const V=A(),g=c(),_=c(!1),w=c(!1),r=c(0);let n=null;const a=S({email:"",email_code:"",new_password:"",confirm_password:""}),R=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,x=B(()=>a.email&&R.test(a.email)?E(a.email):"");function $(p,e,t){e!==a.new_password?t(new Error("两次输入的密码不一致")):t()}const q={email:[{required:!0,message:"请输入注册邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],email_code:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"},{len:4,message:"验证码为 4 位数字",trigger:"blur"},{pattern:/^\d{4}$/,message:"验证码为 4 位数字",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少 6 位",trigger:"blur"}],confirm_password:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:$,trigger:"blur"}]};async function U(){if(!a.email||r.value>0)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)){m.warning("请先输入正确邮箱");return}w.value=!0;try{await H(a.email),m.success(`验证码已发送至 ${E(a.email)}，请查收`),r.value=60,n=setInterval(()=>{r.value--,r.value<=0&&n&&(clearInterval(n),n=null)},1e3)}catch(e){m.error(e.message||"发送失败")}finally{w.value=!1}}K(()=>{n&&clearInterval(n)});async function v(){g.value&&await g.value.validate(async p=>{if(p){_.value=!0;try{await J({email:a.email,email_code:a.email_code,new_password:a.new_password}),m.success("密码已重置，请登录"),V.push("/login")}catch(e){m.error(e.message||"重置失败")}finally{_.value=!1}}})}return(p,e)=>{const t=u("el-input"),i=u("el-form-item"),b=u("el-button"),I=u("el-form"),N=u("el-card");return z(),h("div",j,[d("div",G,[s(N,{class:"forgot-card",shadow:"always"},{header:l(()=>[...e[5]||(e[5]=[d("div",{class:"card-header"},[d("h2",{class:"header-font"},"忘记密码"),d("p",{class:"subtitle content-font"},"通过邮箱验证码重置密码")],-1)])]),default:l(()=>[s(I,{ref_key:"formRef",ref:g,model:a,rules:q,"label-width":"0",onSubmit:M(v,["prevent"])},{default:l(()=>[s(i,{prop:"email"},{default:l(()=>[s(t,{modelValue:a.email,"onUpdate:modelValue":e[0]||(e[0]=o=>a.email=o),placeholder:"注册邮箱",size:"large","prefix-icon":f(F)},null,8,["modelValue","prefix-icon"])]),_:1}),x.value?(z(),h("p",O,"验证码将发送至 "+C(x.value),1)):D("",!0),s(i,{prop:"email_code"},{default:l(()=>[d("div",Q,[s(t,{modelValue:a.email_code,"onUpdate:modelValue":e[1]||(e[1]=o=>a.email_code=o),placeholder:"邮箱验证码（4位）",size:"large",maxlength:"4",class:"email-code-input"},null,8,["modelValue"]),s(b,{type:"primary",size:"large",disabled:r.value>0||!a.email,loading:w.value,class:"send-code-btn",onClick:U},{default:l(()=>[y(C(r.value>0?`${r.value}s 后重试`:"获取验证码"),1)]),_:1},8,["disabled","loading"])])]),_:1}),s(i,{prop:"new_password"},{default:l(()=>[s(t,{modelValue:a.new_password,"onUpdate:modelValue":e[2]||(e[2]=o=>a.new_password=o),type:"password",placeholder:"新密码（至少6位）",size:"large","prefix-icon":f(k),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),s(i,{prop:"confirm_password"},{default:l(()=>[s(t,{modelValue:a.confirm_password,"onUpdate:modelValue":e[3]||(e[3]=o=>a.confirm_password=o),type:"password",placeholder:"确认新密码",size:"large","prefix-icon":f(k),"show-password":"",onKeyup:T(v,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),s(i,null,{default:l(()=>[s(b,{type:"primary",size:"large",loading:_.value,class:"submit-button",onClick:v},{default:l(()=>[...e[6]||(e[6]=[y(" 重置密码 ",-1)])]),_:1},8,["loading"])]),_:1}),s(i,null,{default:l(()=>[s(b,{size:"large",class:"back-button",onClick:e[4]||(e[4]=o=>f(V).push("/login"))},{default:l(()=>[...e[7]||(e[7]=[y(" 返回登录 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}}),ee=L(W,[["__scopeId","data-v-a08fa408"]]);export{ee as default};
//# sourceMappingURL=ForgotPassword-DiedGc1Q.js.map
