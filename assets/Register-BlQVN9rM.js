import{d as q,u as $,l as c,m as I,H as S,c as A,a as p,e as r,w as a,r as n,q as B,f,I as K,g as i,D as N,J as D,t as M,z as x,y as T,E as g,K as H,A as J,o as j,_ as F}from"./index-BbGoYfMB.js";const G={class:"register-page"},L={class:"register-container"},O={class:"email-code-row"},Q=q({__name:"Register",setup(W){const k=J(),h=$(),_=c(),v=c(!1),w=c(!1),d=c(0);let m=null;const l=I({email:"",email_code:"",phone:"",nickname:"",password:"",confirmPassword:"",agreement:!1});async function C(){if(!l.email||d.value>0)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)){g.warning("请先输入正确邮箱");return}w.value=!0;try{await H(l.email),g.success("验证码已发送，请查收邮箱"),d.value=60,m=setInterval(()=>{d.value--,d.value<=0&&m&&(clearInterval(m),m=null)},1e3)}catch(e){g.error(e.message||"发送失败")}finally{w.value=!1}}S(()=>{m&&clearInterval(m)});const z={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],email_code:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"},{len:4,message:"验证码为 4 位数字",trigger:"blur"},{pattern:/^\d{4}$/,message:"验证码为 4 位数字",trigger:"blur"}],phone:[{validator:(u,e,o)=>{if(!e||!e.trim()){o();return}/^1[3-9]\d{9}$/.test(e.trim())?o():o(new Error("请输入正确的手机号格式"))},trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"昵称长度在2到20个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(u,e,o)=>{e!==l.password?o(new Error("两次输入的密码不一致")):o()},trigger:"blur"}],agreement:[{validator:(u,e,o)=>{e?o():o(new Error("请先同意服务条款"))},trigger:"change"}]};async function y(){_.value&&await _.value.validate(async u=>{if(u){v.value=!0;try{await h.register({email:l.email,email_code:l.email_code,phone:l.phone||void 0,password:l.password,nickname:l.nickname}),g.success("注册成功，请登录"),k.push("/login")}catch(e){g.error(e.message||"注册失败")}finally{v.value=!1}}})}return(u,e)=>{const o=n("el-input"),t=n("el-form-item"),V=n("el-button"),b=n("el-link"),P=n("el-checkbox"),R=n("el-divider"),U=n("el-form"),E=n("el-card");return j(),A("div",G,[p("div",L,[r(E,{class:"register-card",shadow:"always"},{header:a(()=>[...e[8]||(e[8]=[p("div",{class:"card-header"},[p("h2",{class:"header-font"},"注册"),p("p",{class:"subtitle content-font"},"创建你的账号")],-1)])]),default:a(()=>[r(U,{ref_key:"formRef",ref:_,model:l,rules:z,"label-width":"0",onSubmit:B(y,["prevent"])},{default:a(()=>[r(t,{prop:"email"},{default:a(()=>[r(o,{modelValue:l.email,"onUpdate:modelValue":e[0]||(e[0]=s=>l.email=s),placeholder:"邮箱",size:"large","prefix-icon":f(K)},null,8,["modelValue","prefix-icon"])]),_:1}),r(t,{prop:"email_code"},{default:a(()=>[p("div",O,[r(o,{modelValue:l.email_code,"onUpdate:modelValue":e[1]||(e[1]=s=>l.email_code=s),placeholder:"邮箱验证码（4位）",size:"large",maxlength:"4",class:"email-code-input"},null,8,["modelValue"]),r(V,{type:"primary",size:"large",disabled:d.value>0||!l.email,loading:w.value,class:"send-code-btn",onClick:C},{default:a(()=>[i(N(d.value>0?`${d.value}s 后重试`:"获取验证码"),1)]),_:1},8,["disabled","loading"])])]),_:1}),r(t,{prop:"phone"},{default:a(()=>[r(o,{modelValue:l.phone,"onUpdate:modelValue":e[2]||(e[2]=s=>l.phone=s),placeholder:"手机号（可选）",size:"large","prefix-icon":f(D)},null,8,["modelValue","prefix-icon"])]),_:1}),r(t,{prop:"nickname"},{default:a(()=>[r(o,{modelValue:l.nickname,"onUpdate:modelValue":e[3]||(e[3]=s=>l.nickname=s),placeholder:"昵称",size:"large","prefix-icon":f(M)},null,8,["modelValue","prefix-icon"])]),_:1}),r(t,{prop:"password"},{default:a(()=>[r(o,{modelValue:l.password,"onUpdate:modelValue":e[4]||(e[4]=s=>l.password=s),type:"password",placeholder:"密码（至少6位）",size:"large","prefix-icon":f(x),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),r(t,{prop:"confirmPassword"},{default:a(()=>[r(o,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=s=>l.confirmPassword=s),type:"password",placeholder:"确认密码",size:"large","prefix-icon":f(x),"show-password":"",onKeyup:T(y,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),r(t,{prop:"agreement",class:"agreement-item"},{default:a(()=>[r(P,{modelValue:l.agreement,"onUpdate:modelValue":e[6]||(e[6]=s=>l.agreement=s)},{default:a(()=>[e[11]||(e[11]=i(" 我已阅读并同意 ",-1)),r(b,{type:"primary",underline:!1},{default:a(()=>[...e[9]||(e[9]=[i("《服务条款》",-1)])]),_:1}),e[12]||(e[12]=i(" 和 ",-1)),r(b,{type:"primary",underline:!1},{default:a(()=>[...e[10]||(e[10]=[i("《隐私政策》",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(t,null,{default:a(()=>[r(V,{type:"primary",size:"large",loading:v.value,class:"register-button",onClick:y},{default:a(()=>[...e[13]||(e[13]=[i(" 注册 ",-1)])]),_:1},8,["loading"])]),_:1}),r(R,null,{default:a(()=>[...e[14]||(e[14]=[i("或",-1)])]),_:1}),r(t,null,{default:a(()=>[r(V,{size:"large",class:"login-button",onClick:e[7]||(e[7]=s=>u.$router.push("/login"))},{default:a(()=>[...e[15]||(e[15]=[i(" 已有账号？登录 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}}),le=F(Q,[["__scopeId","data-v-49e1bcf3"]]);export{le as default};
//# sourceMappingURL=Register-BlQVN9rM.js.map
