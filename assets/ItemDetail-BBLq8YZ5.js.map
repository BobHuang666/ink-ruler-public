{"version":3,"file":"ItemDetail-BBLq8YZ5.js","sources":["../../src/views/classic/ItemDetail.vue"],"sourcesContent":["<template>\n  <div class=\"classic-detail-page\">\n    <div class=\"page-bg\">\n      <div class=\"page-bg-gradient\" />\n    </div>\n    <div class=\"detail-inner\">\n      <div v-if=\"loading\" class=\"loading-wrap\">\n        <el-icon class=\"is-loading\" :size=\"32\"><Loading /></el-icon>\n      </div>\n      <template v-else-if=\"item\">\n        <div class=\"main-card\">\n          <p class=\"original content-font\">{{ item.original_text }}</p>\n          <p v-if=\"item.translation\" class=\"translation\">{{ item.translation }}</p>\n          <div class=\"meta\">\n            <span v-if=\"item.source\">出处：{{ item.source }}</span>\n            <span v-if=\"item.author\">{{ item.author }}</span>\n            <span v-if=\"item.dynasty\">{{ item.dynasty }}</span>\n            <span v-if=\"item.genre\">{{ item.genre }}</span>\n            <span v-if=\"item.categories\"\n              >分类：{{\n                Array.isArray(item.categories) ? item.categories.join('、') : item.categories\n              }}</span\n            >\n          </div>\n          <div class=\"actions\">\n            <el-button :loading=\"likeLoading\" @click=\"toggleLike\">\n              <el-icon v-if=\"likedThisSession\"><StarFilled /></el-icon>\n              <el-icon v-else><Star /></el-icon>\n              {{ item.likes }} 点赞\n            </el-button>\n            <el-button\n              v-if=\"authStore.isAuthenticated\"\n              :loading=\"favLoading\"\n              @click=\"toggleFavorite\"\n            >\n              <el-icon v-if=\"isFavorited\"><StarFilled /></el-icon>\n              <el-icon v-else><Star /></el-icon>\n              {{ isFavorited ? '已收藏' : '收藏' }}\n            </el-button>\n            <el-button v-else @click=\"goLogin\">登录后收藏</el-button>\n          </div>\n        </div>\n        <section v-if=\"similarList.length\" class=\"similar-section\">\n          <h2 class=\"section-title\">相似推荐</h2>\n          <div class=\"similar-grid\">\n            <router-link\n              v-for=\"s in similarList\"\n              :key=\"s.id\"\n              :to=\"`/classic/item/${s.id}`\"\n              class=\"similar-card\"\n            >\n              <p class=\"original content-font\">{{ s.original_text }}</p>\n              <p v-if=\"s.translation\" class=\"translation\">{{ s.translation }}</p>\n              <div class=\"meta\">\n                <span v-if=\"s.author\">{{ s.author }}</span>\n                <span v-if=\"s.dynasty\">{{ s.dynasty }}</span>\n              </div>\n            </router-link>\n          </div>\n        </section>\n      </template>\n      <div v-else class=\"empty\">条目不存在</div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { Loading, Star, StarFilled } from '@element-plus/icons-vue'\nimport { useAuthStore } from '@/stores/auth'\nimport { getItem, similar, updateLike, favorite, unfavorite } from '@/api/classic'\nimport type { ClassicItem } from '@/types/classic'\nimport { ElMessage } from 'element-plus'\n\ndefineOptions({ name: 'ClassicItemDetail' })\n\nconst route = useRoute()\nconst router = useRouter()\nconst authStore = useAuthStore()\n\nconst item = ref<ClassicItem | null>(null)\nconst similarList = ref<ClassicItem[]>([])\nconst loading = ref(true)\nconst likeLoading = ref(false)\nconst favLoading = ref(false)\nconst isFavorited = ref(false)\nconst likedThisSession = ref(false)\n\nconst id = computed(() => {\n  const raw = route.params.id\n  const n = parseInt(String(raw), 10)\n  return Number.isNaN(n) ? 0 : n\n})\n\nasync function load() {\n  if (!id.value) return\n  loading.value = true\n  try {\n    const [detail, sim] = await Promise.all([getItem(id.value), similar(id.value)])\n    item.value = detail\n    similarList.value = sim ?? []\n  } catch {\n    item.value = null\n    similarList.value = []\n  } finally {\n    loading.value = false\n  }\n}\n\nasync function toggleLike() {\n  if (!item.value || likeLoading.value) return\n  const action = likedThisSession.value ? 'decrement' : 'increment'\n  likeLoading.value = true\n  try {\n    const res = await updateLike(item.value.id, { action })\n    if (item.value) item.value.likes = res.likes\n    likedThisSession.value = !likedThisSession.value\n  } finally {\n    likeLoading.value = false\n  }\n}\n\nasync function toggleFavorite() {\n  if (!item.value || favLoading.value || !authStore.isAuthenticated) return\n  favLoading.value = true\n  try {\n    if (isFavorited.value) {\n      await unfavorite(item.value.id)\n      isFavorited.value = false\n      ElMessage.success('已取消收藏')\n    } else {\n      await favorite(item.value.id)\n      isFavorited.value = true\n      ElMessage.success('已收藏')\n    }\n  } catch (e) {\n    ElMessage.error((e as Error).message)\n  } finally {\n    favLoading.value = false\n  }\n}\n\nfunction goLogin() {\n  router.push({ path: '/login', query: { redirect: route.fullPath } })\n}\n\n// 只在首次挂载时加载，因为每个详情页都有独立的缓存实例（通过 route.fullPath 作为 key）\nonMounted(load)\n</script>\n\n<style scoped>\n.classic-detail-page {\n  position: relative;\n  min-height: calc(100vh - var(--header-height) - 80px);\n}\n.page-bg {\n  position: absolute;\n  inset: 0;\n  z-index: -1;\n}\n.page-bg-gradient {\n  position: absolute;\n  inset: 0;\n  background: var(--page-bg-gradient);\n}\n.detail-inner {\n  max-width: 52rem;\n  margin: 0 auto;\n  padding: 32px 16px 48px;\n}\n@media (min-width: 640px) {\n  .detail-inner {\n    padding-left: 24px;\n    padding-right: 24px;\n  }\n}\n.loading-wrap,\n.empty {\n  text-align: center;\n  padding: 48px;\n  color: var(--color-text-secondary);\n}\n.main-card {\n  padding: var(--spacing-xl) 28px;\n  background: var(--card-gradient);\n  backdrop-filter: blur(4px);\n  border-radius: var(--border-radius-large);\n  border: 1px solid rgba(214, 211, 209, 0.6);\n  box-shadow: var(--box-shadow-base);\n  margin-bottom: 40px;\n}\n.main-card .original {\n  font-size: var(--font-size-xl);\n  line-height: 1.75;\n  margin-bottom: var(--spacing-md);\n  color: var(--color-text-primary);\n}\n.main-card .translation {\n  font-size: var(--font-size-base);\n  color: var(--color-text-regular);\n  line-height: 1.65;\n  margin-bottom: var(--spacing-lg);\n  padding-left: 0;\n}\n.main-card .meta {\n  font-size: var(--font-size-sm);\n  color: var(--color-text-secondary);\n  margin-bottom: var(--spacing-lg);\n  line-height: 1.6;\n}\n.main-card .meta span + span::before {\n  content: ' · ';\n}\n.actions {\n  display: flex;\n  flex-wrap: wrap;\n  gap: var(--spacing-sm);\n}\n.actions :deep(.el-button) {\n  border-radius: var(--border-radius-small);\n}\n.similar-section {\n  margin-top: 40px;\n}\n.section-title {\n  font-size: var(--font-size-xl);\n  font-weight: 600;\n  margin-bottom: 20px;\n  color: var(--color-text-primary);\n}\n.similar-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n  gap: var(--spacing-md);\n}\n.similar-card {\n  display: block;\n  padding: var(--spacing-lg);\n  background: var(--card-gradient);\n  backdrop-filter: blur(2px);\n  border-radius: var(--border-radius-base);\n  border: 1px solid rgba(214, 211, 209, 0.7);\n  text-decoration: none;\n  color: inherit;\n  transition:\n    box-shadow 0.2s,\n    background 0.2s,\n    transform 0.2s;\n}\n.similar-card:hover {\n  box-shadow: var(--box-shadow-dark);\n  background: var(--card-gradient-hover);\n  transform: translateY(-2px);\n}\n.similar-card .original {\n  font-size: var(--font-size-base);\n  line-height: 1.6;\n  margin-bottom: var(--spacing-xs);\n  color: var(--color-text-primary);\n}\n.similar-card .translation {\n  font-size: var(--font-size-sm);\n  color: var(--color-text-regular);\n  line-height: 1.5;\n  margin-bottom: var(--spacing-xs);\n}\n.similar-card .meta {\n  font-size: var(--font-size-xs);\n  color: var(--color-text-secondary);\n}\n.similar-card .meta span + span::before {\n  content: ' · ';\n}\n</style>\n"],"names":["route","useRoute","router","useRouter","authStore","useAuthStore","item","ref","similarList","loading","likeLoading","favLoading","isFavorited","likedThisSession","id","computed","raw","n","load","detail","sim","getItem","similar","toggleLike","action","res","updateLike","toggleFavorite","unfavorite","ElMessage","favorite","e","goLogin","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_el_icon","_unref","Loading","_Fragment","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_13","_component_el_button","_createBlock","StarFilled","Star","_createTextVNode","_cache","_hoisted_14","_hoisted_15","_renderList","s","_component_router_link","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21"],"mappings":"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"}