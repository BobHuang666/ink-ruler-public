import{R as x,d as pe,l as c,n as _e,E as f,c as ve,a as o,e,w as a,r as u,f as D,a0 as me,t as fe,K as ge,a1 as be,s as w,v as L,D as v,g as _,y as ye,a2 as we,j as M,P as he,b as ke,o as z,_ as Ve}from"./index-BbY8ega0.js";async function xe(){return(await x.get("/admin/metrics")).data}async function Ce(i){const n=i.page??1,r=i.size??10,m=await x.get("/admin/users",{params:{q:i.q,role:i.role,status:i.status,page:n,size:r}});return{items:(m.data.list??[]).map(p=>({id:p.id,email:p.email,phone:p.phone,nickname:p.nickname??"",avatar:p.avatar,role:p.role,status:p.status,created_at:p.created_at??"",updated_at:p.updated_at??""})),total:m.data.total??0,page:n,size:r}}async function Y(i,n){await x.patch(`/admin/users/${i}`,n)}async function Ue(i){const n=i?.page??1,r=i?.size??20,m=await x.get("/admin/logs",{params:{page:n,size:r}});return{items:m.data.list??[],total:m.data.total??0,page:n,size:r}}async function De(i){const n=i?.page??1,r=i?.size??10,m=await x.get("/admin/flags",{params:{page:n,size:r}});return{items:m.data.list??[],total:m.data.total??0,page:n,size:r}}async function ze(i,n){await x.patch(`/admin/flags/${i}`,{status:n})}const Se={class:"admin-page"},Ie={class:"admin-container"},Fe={class:"dashboard-content"},Le={class:"metric-item"},Me={class:"metric-value"},$e={class:"metric-item"},Ee={class:"metric-value"},Pe={class:"metric-item"},Te={class:"metric-value"},Be={class:"metric-item"},Ne={class:"metric-value"},qe={class:"users-content"},Ke={class:"search-bar"},Re={class:"content-content"},je={class:"logs-content"},Ae=pe({__name:"Dashboard",setup(i){const n=c("dashboard"),r=c({user_count:0,active_user_count:0,essay_count:0,token_usage:{total:0,today:0,this_month:0}}),m=c([]),S=c(!1),p=c(""),$=c(""),E=c(""),P=c(1),T=c(10),Q=c(0),G=c([]),B=c(!1),H=c([]),N=c(!1),C=c(!1),y=c({role:"",status:""}),q=c(null);_e(async()=>{await Z(),await h(),await J(),await ee()});async function Z(){try{r.value=await xe()}catch(s){f.error(s.message||"获取数据失败")}}async function h(){S.value=!0;try{const s=await Ce({q:p.value,role:$.value,status:E.value,page:P.value,size:T.value});m.value=s.items,Q.value=s.total}catch(s){f.error(s.message||"获取用户列表失败")}finally{S.value=!1}}async function J(){B.value=!0;try{const s=await De({});G.value=s.items}catch(s){f.error(s.message||"获取内容标记失败")}finally{B.value=!1}}async function ee(){N.value=!0;try{const s=await Ue({});H.value=s.items}catch(s){f.error(s.message||"获取日志失败")}finally{N.value=!1}}function te(s){s!==n.value&&(n.value=s)}function ae(s){q.value=s.id,y.value={role:s.role,status:s.status},C.value=!0}async function le(){if(q.value)try{await Y(q.value,y.value),f.success("更新成功"),C.value=!1,await h()}catch(s){f.error(s.message||"更新失败")}}async function se(s){try{await Y(s.id,{status:s.status==="active"?"disabled":"active"}),f.success("操作成功"),await h()}catch(t){f.error(t.message||"操作失败")}}async function oe(s){try{await ze(s.id,"resolved"),f.success("标记已处理"),await J()}catch(t){f.error(t.message||"操作失败")}}return(s,t)=>{const U=u("el-icon"),I=u("el-menu-item"),ne=u("el-menu"),k=u("el-col"),g=u("el-card"),O=u("el-row"),K=u("el-descriptions-item"),ue=u("el-descriptions"),de=u("el-input"),b=u("el-option"),F=u("el-select"),V=u("el-button"),d=u("el-table-column"),R=u("el-tag"),j=u("el-table"),ie=u("el-pagination"),W=u("el-form-item"),re=u("el-form"),ce=u("el-dialog"),A=he("loading");return z(),ve("div",Se,[o("div",Ie,[e(O,{gutter:20},{default:a(()=>[e(k,{span:4},{default:a(()=>[e(ne,{"default-active":n.value,class:"admin-menu",onSelect:te},{default:a(()=>[e(I,{index:"dashboard"},{default:a(()=>[e(U,null,{default:a(()=>[e(D(me))]),_:1}),t[9]||(t[9]=o("span",null,"数据看板",-1))]),_:1}),e(I,{index:"users"},{default:a(()=>[e(U,null,{default:a(()=>[e(D(fe))]),_:1}),t[10]||(t[10]=o("span",null,"用户管理",-1))]),_:1}),e(I,{index:"content"},{default:a(()=>[e(U,null,{default:a(()=>[e(D(ge))]),_:1}),t[11]||(t[11]=o("span",null,"内容管理",-1))]),_:1}),e(I,{index:"logs"},{default:a(()=>[e(U,null,{default:a(()=>[e(D(be))]),_:1}),t[12]||(t[12]=o("span",null,"操作日志",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(k,{span:20},{default:a(()=>[w(o("div",Fe,[t[18]||(t[18]=o("h2",{class:"header-font"},"数据看板",-1)),e(O,{gutter:20,class:"metrics-row"},{default:a(()=>[e(k,{span:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[o("div",Le,[o("div",Me,v(r.value.user_count),1),t[13]||(t[13]=o("div",{class:"metric-label"},"总用户数",-1))])]),_:1})]),_:1}),e(k,{span:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[o("div",$e,[o("div",Ee,v(r.value.active_user_count),1),t[14]||(t[14]=o("div",{class:"metric-label"},"活跃用户",-1))])]),_:1})]),_:1}),e(k,{span:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[o("div",Pe,[o("div",Te,v(r.value.essay_count),1),t[15]||(t[15]=o("div",{class:"metric-label"},"作文提交量",-1))])]),_:1})]),_:1}),e(k,{span:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[o("div",Be,[o("div",Ne,v(r.value.token_usage.total),1),t[16]||(t[16]=o("div",{class:"metric-label"},"Token使用总量",-1))])]),_:1})]),_:1})]),_:1}),e(g,{shadow:"never",class:"token-card"},{default:a(()=>[t[17]||(t[17]=o("h3",{class:"header-font"},"Token使用情况",-1)),e(ue,{column:3,border:""},{default:a(()=>[e(K,{label:"今日使用"},{default:a(()=>[_(v(r.value.token_usage.today),1)]),_:1}),e(K,{label:"本月使用"},{default:a(()=>[_(v(r.value.token_usage.this_month),1)]),_:1}),e(K,{label:"总使用量"},{default:a(()=>[_(v(r.value.token_usage.total),1)]),_:1})]),_:1})]),_:1}),t[19]||(t[19]=o("p",{class:"dashboard-note"},"活跃用户：统计最近 7 天内有过登录的用户。",-1))],512),[[L,n.value==="dashboard"]]),w(o("div",qe,[t[22]||(t[22]=o("h2",{class:"header-font"},"用户管理",-1)),e(g,{shadow:"never"},{default:a(()=>[o("div",Ke,[e(de,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=l=>p.value=l),placeholder:"搜索用户...",style:{width:"300px"},clearable:"",onKeyup:ye(h,["enter"])},{prefix:a(()=>[e(U,null,{default:a(()=>[e(D(we))]),_:1})]),_:1},8,["modelValue"]),e(F,{modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=l=>$.value=l),placeholder:"角色",style:{width:"120px"},clearable:""},{default:a(()=>[e(b,{label:"学生",value:"student"}),e(b,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"]),e(F,{modelValue:E.value,"onUpdate:modelValue":t[2]||(t[2]=l=>E.value=l),placeholder:"状态",style:{width:"120px"},clearable:""},{default:a(()=>[e(b,{label:"正常",value:"active"}),e(b,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"]),e(V,{type:"primary",onClick:h},{default:a(()=>[...t[20]||(t[20]=[_("搜索",-1)])]),_:1})]),w((z(),M(j,{data:m.value,style:{width:"100%","margin-top":"20px"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"nickname",label:"昵称"}),e(d,{prop:"email",label:"邮箱"}),e(d,{prop:"role",label:"角色",width:"100"},{default:a(({row:l})=>[e(R,{type:l.role==="admin"?"danger":"primary"},{default:a(()=>[_(v(l.role==="admin"?"管理员":"学生"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(R,{type:l.status==="active"?"success":"info"},{default:a(()=>[_(v(l.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"操作",width:"200"},{default:a(({row:l})=>[e(V,{type:"primary",text:"",onClick:X=>ae(l)},{default:a(()=>[...t[21]||(t[21]=[_("编辑",-1)])]),_:1},8,["onClick"]),e(V,{type:l.status==="active"?"warning":"success",text:"",onClick:X=>se(l)},{default:a(()=>[_(v(l.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[A,S.value]]),e(ie,{"current-page":P.value,"onUpdate:currentPage":t[3]||(t[3]=l=>P.value=l),"page-size":T.value,"onUpdate:pageSize":t[4]||(t[4]=l=>T.value=l),total:Q.value,layout:"total, prev, pager, next",style:{"margin-top":"20px"},onCurrentChange:h},null,8,["current-page","page-size","total"])]),_:1})],512),[[L,n.value==="users"]]),w(o("div",Re,[t[24]||(t[24]=o("h2",{class:"header-font"},"内容管理",-1)),e(g,{shadow:"never"},{default:a(()=>[w((z(),M(j,{data:G.value,style:{width:"100%"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"target_type",label:"类型",width:"120"}),e(d,{prop:"target_id",label:"目标ID",width:"100"}),e(d,{prop:"reason",label:"原因"}),e(d,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(R,{type:l.status==="resolved"?"success":"warning"},{default:a(()=>[_(v(l.status==="resolved"?"已处理":"待处理"),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"操作",width:"150"},{default:a(({row:l})=>[l.status==="open"?(z(),M(V,{key:0,type:"success",text:"",onClick:X=>oe(l)},{default:a(()=>[...t[23]||(t[23]=[_(" 标记已处理 ",-1)])]),_:1},8,["onClick"])):ke("",!0)]),_:1})]),_:1},8,["data"])),[[A,B.value]])]),_:1})],512),[[L,n.value==="content"]]),w(o("div",je,[t[25]||(t[25]=o("h2",{class:"header-font"},"操作日志",-1)),e(g,{shadow:"never"},{default:a(()=>[w((z(),M(j,{data:H.value,style:{width:"100%"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"action",label:"操作"}),e(d,{prop:"target_type",label:"目标类型",width:"120"}),e(d,{prop:"target_id",label:"目标ID",width:"100"}),e(d,{prop:"ip",label:"IP",width:"150"}),e(d,{prop:"created_at",label:"时间",width:"180"},{default:a(({row:l})=>[_(v(new Date(l.created_at).toLocaleString()),1)]),_:1})]),_:1},8,["data"])),[[A,N.value]])]),_:1})],512),[[L,n.value==="logs"]])]),_:1})]),_:1})]),e(ce,{modelValue:C.value,"onUpdate:modelValue":t[8]||(t[8]=l=>C.value=l),title:"编辑用户",width:"500px"},{footer:a(()=>[e(V,{onClick:t[7]||(t[7]=l=>C.value=!1)},{default:a(()=>[...t[26]||(t[26]=[_("取消",-1)])]),_:1}),e(V,{type:"primary",onClick:le},{default:a(()=>[...t[27]||(t[27]=[_("保存",-1)])]),_:1})]),default:a(()=>[e(re,{model:y.value,"label-width":"100px"},{default:a(()=>[e(W,{label:"角色"},{default:a(()=>[e(F,{modelValue:y.value.role,"onUpdate:modelValue":t[5]||(t[5]=l=>y.value.role=l)},{default:a(()=>[e(b,{label:"学生",value:"student"}),e(b,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),e(W,{label:"状态"},{default:a(()=>[e(F,{modelValue:y.value.status,"onUpdate:modelValue":t[6]||(t[6]=l=>y.value.status=l)},{default:a(()=>[e(b,{label:"正常",value:"active"}),e(b,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ge=Ve(Ae,[["__scopeId","data-v-e1ef9290"]]);export{Ge as default};
//# sourceMappingURL=Dashboard-CldBH8fp.js.map
