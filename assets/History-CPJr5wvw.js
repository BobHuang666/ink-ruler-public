import{d as P,u as j,O as U,l as $,n as X,c as m,a as k,e as o,w as a,r as p,s as z,b as S,P as G,f as c,j as g,g as n,D as w,F as D,q as h,A as J,o as d,E as y,N as K,_ as Q}from"./index-DE8jxKp-.js";import{u as W}from"./essay-D4g_b-yw.js";import{u as Y}from"./essay-Bk8B8jm0.js";const Z={class:"history-page"},tt={class:"container"},et={class:"page-header"},at={class:"op-row"},st={key:0,class:"empty-state"},it=P({__name:"History",setup(nt){const v=J(),l=j(),r=W(),E={id:0,title:"示例：我的暑假生活",word_count:520,status:"done",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_favorited:!1,recordType:"essay"},x=U(()=>{if(!l.isAuthenticated)return[E];const e=r.history.map(i=>({id:i.id,title:i.title,word_count:i.word_count??0,status:i.status,created_at:i.created_at,updated_at:i.updated_at,is_favorited:i.is_favorited,recordType:"essay"})),t=r.drafts.map(i=>({id:i.id,title:i.title,word_count:i.content_text?.length??0,status:"draft",created_at:i.created_at,updated_at:i.updated_at,is_favorited:!1,recordType:"draft"})),_=[...e,...t];return _.sort((i,f)=>new Date(f.updated_at).getTime()-new Date(i.updated_at).getTime()),_}),b=$(null),C=$(null);X(async()=>{l.isAuthenticated&&(await r.fetchHistory(),await r.fetchDrafts())});function A(e){return{pending:"info",processing:"warning",done:"success",failed:"danger",draft:"info"}[e]||"info"}function I(e){return{pending:"待处理",processing:"处理中",done:"已完成",failed:"失败",draft:"草稿"}[e]||e}function H(e){!l.isAuthenticated||e.id===0||(e.recordType==="draft"?v.push({path:"/essay/correction",query:{draftId:String(e.id)}}):v.push(`/essay/${e.id}`))}function M(e){e.recordType==="draft"?v.push({path:"/essay/correction",query:{draftId:String(e.id)}}):v.push(`/essay/${e.id}`)}async function B(e){if(e.recordType!=="draft"){b.value=e.id;try{await r.favoriteEssay(e.id),r.setHistoryItemFavorited(e.id,!0),y.success("收藏成功"),r.fetchHistory().catch(()=>{})}catch(t){y.error(t.message||"收藏失败")}finally{b.value=null}}}async function F(e){if(e.recordType!=="draft"){C.value=e.id;try{await Y(e.id),r.setHistoryItemFavorited(e.id,!1),y.success("已取消收藏"),r.fetchHistory().catch(()=>{})}catch(t){y.error(t.message||"取消收藏失败")}finally{C.value=null}}}async function L(e){try{await K.confirm(e.recordType==="draft"?"确定要删除这份草稿吗？":"确定要删除这条记录吗？","提示",{type:"warning"}),e.recordType==="draft"?(await r.deleteDraft(e.id),y.success("草稿已删除")):(await r.deleteEssay(e.id),y.success("删除成功"))}catch(t){t!=="cancel"&&y.error(t.message||"删除失败")}}return(e,t)=>{const _=p("el-link"),i=p("el-alert"),f=p("el-table-column"),N=p("el-tag"),u=p("el-button"),R=p("el-table"),V=p("el-empty"),O=p("el-card"),q=G("loading");return d(),m("div",Z,[k("div",tt,[o(O,{shadow:"never"},{header:a(()=>[k("div",et,[t[9]||(t[9]=k("h2",{class:"header-font"},"历史记录",-1)),c(l).isAuthenticated?c(l).isMember?S("",!0):(d(),g(i,{key:1,title:"提示",type:"info",closable:!1,"show-icon":""},{default:a(()=>[t[7]||(t[7]=n(" 非会员用户仅保存30天记录，",-1)),o(_,{type:"primary",onClick:t[1]||(t[1]=s=>e.$router.push("/profile"))},{default:a(()=>[...t[6]||(t[6]=[n(" 升级会员 ",-1)])]),_:1}),t[8]||(t[8]=n(" 可永久保存 ",-1))]),_:1})):(d(),g(i,{key:0,title:"登录后可查看您的历史记录",type:"info",closable:!1,"show-icon":""},{default:a(()=>[t[4]||(t[4]=n(" 下方为示例记录，",-1)),o(_,{type:"primary",onClick:t[0]||(t[0]=s=>e.$router.push("/login"))},{default:a(()=>[...t[3]||(t[3]=[n("登录",-1)])]),_:1}),t[5]||(t[5]=n(" 后即可查看与管理您的批改历史 ",-1))]),_:1}))])]),default:a(()=>[z((d(),g(R,{data:x.value,class:"history-table",onRowClick:H},{default:a(()=>[o(f,{prop:"title",label:"标题","min-width":"120"},{default:a(({row:s})=>[n(w(s.title||"无标题"),1)]),_:1}),o(f,{prop:"word_count",label:"字数","min-width":"70"}),o(f,{prop:"status",label:"状态","min-width":"90"},{default:a(({row:s})=>[o(N,{type:A(s.status)},{default:a(()=>[n(w(I(s.status)),1)]),_:2},1032,["type"])]),_:1}),o(f,{prop:"created_at",label:"提交时间","min-width":"150"},{default:a(({row:s})=>[n(w(new Date(s.created_at).toLocaleString()),1)]),_:1}),o(f,{label:"操作","min-width":"220",align:"right"},{default:a(({row:s})=>[k("div",at,[c(l).isAuthenticated&&s.id!==0?(d(),m(D,{key:0},[o(u,{type:"primary",text:"",onClick:h(T=>M(s),["stop"])},{default:a(()=>[...t[10]||(t[10]=[n("查看",-1)])]),_:1},8,["onClick"]),s.recordType==="essay"?(d(),m(D,{key:0},[s.is_favorited?(d(),g(u,{key:1,type:"warning",text:"",loading:C.value===s.id,onClick:h(T=>F(s),["stop"])},{default:a(()=>[...t[12]||(t[12]=[n(" 取消收藏 ",-1)])]),_:1},8,["loading","onClick"])):(d(),g(u,{key:0,type:"success",text:"",loading:b.value===s.id,onClick:h(T=>B(s),["stop"])},{default:a(()=>[...t[11]||(t[11]=[n(" 收藏 ",-1)])]),_:1},8,["loading","onClick"]))],64)):S("",!0),o(u,{type:"danger",text:"",onClick:h(T=>L(s),["stop"])},{default:a(()=>[...t[13]||(t[13]=[n("删除",-1)])]),_:1},8,["onClick"])],64)):(d(),m(D,{key:1},[o(u,{type:"primary",text:"",disabled:""},{default:a(()=>[...t[14]||(t[14]=[n("查看",-1)])]),_:1}),o(u,{type:"success",text:"",disabled:""},{default:a(()=>[...t[15]||(t[15]=[n("收藏",-1)])]),_:1}),o(u,{type:"danger",text:"",disabled:""},{default:a(()=>[...t[16]||(t[16]=[n("删除",-1)])]),_:1})],64))])]),_:1})]),_:1},8,["data"])),[[q,c(l).isAuthenticated&&c(r).loading]]),c(l).isAuthenticated&&x.value.length===0&&!c(r).loading?(d(),m("div",st,[o(V,{description:"暂无历史记录"},{default:a(()=>[o(u,{type:"primary",onClick:t[2]||(t[2]=s=>e.$router.push("/essay/correction"))},{default:a(()=>[...t[17]||(t[17]=[n(" 开始批改 ",-1)])]),_:1})]),_:1})])):S("",!0)]),_:1})])])}}}),lt=Q(it,[["__scopeId","data-v-1cafdf73"]]);export{lt as default};
//# sourceMappingURL=History-CPJr5wvw.js.map
