import{d as P,u as R,l as c,J as T,C as $,n as q,c as t,a as o,e as d,w as u,r as x,F as I,b as n,D as l,j as _,f as v,x as z,a1 as J,g as L,a3 as D,$ as S,A as G,o as a,E as N,_ as H}from"./index-BN8HEDSF.js";import{c as K,d as O,e as Q,u as U,f as W}from"./classic-HeyjI9HZ.js";const X={class:"classic-detail-page"},Y={class:"detail-inner"},Z={key:0,class:"loading-wrap"},ee={class:"main-card"},ae={class:"original content-font"},te={key:0,class:"translation"},se={class:"meta"},le={key:0},oe={key:1},ne={key:2},ie={key:3},ue={key:4},re={class:"actions"},ce={key:0,class:"similar-section"},de={class:"similar-grid"},_e={class:"original content-font"},ve={key:0,class:"translation"},fe={class:"meta"},ge={key:0},ye={key:1},me={key:2,class:"empty"},pe=P({name:"ClassicItemDetail",__name:"ItemDetail",setup(ke){const b=$(),B=G(),A=R(),e=c(null),y=c([]),h=c(!0),m=c(!1),p=c(!1),f=c(!1),k=c(!1),C=T(()=>{const r=b.params.id,s=parseInt(String(r),10);return Number.isNaN(s)?0:s});async function F(){if(C.value){h.value=!0;try{const[r,s]=await Promise.all([K(C.value),O(C.value)]);e.value=r,y.value=s??[]}catch{e.value=null,y.value=[]}finally{h.value=!1}}}async function V(){if(!e.value||m.value)return;const r=k.value?"decrement":"increment";m.value=!0;try{const s=await Q(e.value.id,{action:r});e.value&&(e.value.likes=s.likes),k.value=!k.value}finally{m.value=!1}}async function E(){if(!(!e.value||p.value||!A.isAuthenticated)){p.value=!0;try{f.value?(await U(e.value.id),f.value=!1,N.success("已取消收藏")):(await W(e.value.id),f.value=!0,N.success("已收藏"))}catch(r){N.error(r.message)}finally{p.value=!1}}}function j(){B.push({path:"/login",query:{redirect:b.fullPath}})}return q(F),(r,s)=>{const g=x("el-icon"),w=x("el-button"),M=x("router-link");return a(),t("div",X,[s[2]||(s[2]=o("div",{class:"page-bg"},[o("div",{class:"page-bg-gradient"})],-1)),o("div",Y,[h.value?(a(),t("div",Z,[d(g,{class:"is-loading",size:32},{default:u(()=>[d(v(J))]),_:1})])):e.value?(a(),t(I,{key:1},[o("div",ee,[o("p",ae,l(e.value.original_text),1),e.value.translation?(a(),t("p",te,l(e.value.translation),1)):n("",!0),o("div",se,[e.value.source?(a(),t("span",le,"出处："+l(e.value.source),1)):n("",!0),e.value.author?(a(),t("span",oe,l(e.value.author),1)):n("",!0),e.value.dynasty?(a(),t("span",ne,l(e.value.dynasty),1)):n("",!0),e.value.genre?(a(),t("span",ie,l(e.value.genre),1)):n("",!0),e.value.categories?(a(),t("span",ue,"分类："+l(Array.isArray(e.value.categories)?e.value.categories.join("、"):e.value.categories),1)):n("",!0)]),o("div",re,[d(w,{loading:m.value,onClick:V},{default:u(()=>[k.value?(a(),_(g,{key:0},{default:u(()=>[d(v(D))]),_:1})):(a(),_(g,{key:1},{default:u(()=>[d(v(S))]),_:1})),L(" "+l(e.value.likes)+" 点赞 ",1)]),_:1},8,["loading"]),v(A).isAuthenticated?(a(),_(w,{key:0,loading:p.value,onClick:E},{default:u(()=>[f.value?(a(),_(g,{key:0},{default:u(()=>[d(v(D))]),_:1})):(a(),_(g,{key:1},{default:u(()=>[d(v(S))]),_:1})),L(" "+l(f.value?"已收藏":"收藏"),1)]),_:1},8,["loading"])):(a(),_(w,{key:1,onClick:j},{default:u(()=>[...s[0]||(s[0]=[L("登录后收藏",-1)])]),_:1}))])]),y.value.length?(a(),t("section",ce,[s[1]||(s[1]=o("h2",{class:"section-title"},"相似推荐",-1)),o("div",de,[(a(!0),t(I,null,z(y.value,i=>(a(),_(M,{key:i.id,to:`/classic/item/${i.id}`,class:"similar-card"},{default:u(()=>[o("p",_e,l(i.original_text),1),i.translation?(a(),t("p",ve,l(i.translation),1)):n("",!0),o("div",fe,[i.author?(a(),t("span",ge,l(i.author),1)):n("",!0),i.dynasty?(a(),t("span",ye,l(i.dynasty),1)):n("",!0)])]),_:2},1032,["to"]))),128))])])):n("",!0)],64)):(a(),t("div",me,"条目不存在"))])])}}}),we=H(pe,[["__scopeId","data-v-80d8668d"]]);export{we as default};
//# sourceMappingURL=ItemDetail-BBLq8YZ5.js.map
