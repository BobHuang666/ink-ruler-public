{"version":3,"file":"History-CY8YiaBE.js","sources":["../../src/views/essay/History.vue"],"sourcesContent":["<template>\n  <div class=\"history-page\">\n    <div class=\"container\">\n      <el-card shadow=\"never\">\n        <template #header>\n          <div class=\"page-header\">\n            <h2>历史记录</h2>\n            <el-alert\n              v-if=\"!authStore.isMember\"\n              title=\"提示\"\n              type=\"info\"\n              :closable=\"false\"\n              show-icon\n            >\n              非会员用户仅保存30天记录，<el-link type=\"primary\" @click=\"$router.push('/profile')\">\n                升级会员\n              </el-link>\n              可永久保存\n            </el-alert>\n          </div>\n        </template>\n\n        <el-table\n          v-loading=\"essayStore.loading\"\n          :data=\"essayStore.history\"\n          style=\"width: 100%\"\n          @row-click=\"handleRowClick\"\n        >\n          <el-table-column prop=\"title\" label=\"标题\" width=\"200\">\n            <template #default=\"{ row }\">\n              {{ row.title || '无标题' }}\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"word_count\" label=\"字数\" width=\"100\" />\n          <el-table-column prop=\"status\" label=\"状态\" width=\"120\">\n            <template #default=\"{ row }\">\n              <el-tag :type=\"getStatusType(row.status)\">{{ getStatusText(row.status) }}</el-tag>\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"created_at\" label=\"提交时间\" width=\"180\">\n            <template #default=\"{ row }\">\n              {{ new Date(row.created_at).toLocaleString() }}\n            </template>\n          </el-table-column>\n          <el-table-column label=\"操作\" width=\"200\" fixed=\"right\">\n            <template #default=\"{ row }\">\n              <el-button type=\"primary\" text @click.stop=\"handleView(row)\">查看</el-button>\n              <el-button type=\"success\" text @click.stop=\"handleFavorite(row)\">收藏</el-button>\n              <el-button type=\"danger\" text @click.stop=\"handleDelete(row)\">删除</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n\n        <div v-if=\"essayStore.history.length === 0 && !essayStore.loading\" class=\"empty-state\">\n          <el-empty description=\"暂无历史记录\">\n            <el-button type=\"primary\" @click=\"$router.push('/essay/correction')\">\n              开始批改\n            </el-button>\n          </el-empty>\n        </div>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useAuthStore } from '@/stores/auth'\nimport { useEssayStore } from '@/stores/essay'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport type { Essay } from '@/types/essay'\n\nconst router = useRouter()\nconst authStore = useAuthStore()\nconst essayStore = useEssayStore()\n\nonMounted(async () => {\n  if (!authStore.isAuthenticated) {\n    router.push('/login')\n    return\n  }\n  await essayStore.fetchHistory()\n})\n\nfunction getStatusType(status: string) {\n  const map: Record<string, string> = {\n    pending: 'info',\n    processing: 'warning',\n    done: 'success',\n    failed: 'danger',\n  }\n  return map[status] || 'info'\n}\n\nfunction getStatusText(status: string) {\n  const map: Record<string, string> = {\n    pending: '待处理',\n    processing: '处理中',\n    done: '已完成',\n    failed: '失败',\n  }\n  return map[status] || status\n}\n\nfunction handleRowClick(row: Essay) {\n  router.push(`/essay/${row.id}`)\n}\n\nfunction handleView(row: Essay) {\n  router.push(`/essay/${row.id}`)\n}\n\nasync function handleFavorite(row: Essay) {\n  try {\n    await essayStore.favoriteEssay(row.id)\n    ElMessage.success('收藏成功')\n  } catch (error: unknown) {\n    ElMessage.error((error as Error).message || '收藏失败')\n  }\n}\n\nasync function handleDelete(row: Essay) {\n  try {\n    await ElMessageBox.confirm('确定要删除这条记录吗？', '提示', {\n      type: 'warning',\n    })\n    await essayStore.deleteEssay(row.id)\n    ElMessage.success('删除成功')\n  } catch (error: unknown) {\n    if (error !== 'cancel') {\n      ElMessage.error((error as Error).message || '删除失败')\n    }\n  }\n}\n</script>\n\n<style scoped>\n.history-page {\n  min-height: calc(100vh - 64px - 80px);\n  padding: var(--spacing-lg) 0;\n}\n\n.container {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 var(--spacing-md);\n}\n\n.page-header {\n  display: flex;\n  flex-direction: column;\n  gap: var(--spacing-sm);\n}\n\n.page-header h2 {\n  margin: 0;\n  font-size: var(--font-size-xl);\n  font-weight: 600;\n}\n\n.empty-state {\n  padding: var(--spacing-xl) 0;\n}\n</style>\n"],"names":["router","useRouter","authStore","useAuthStore","essayStore","useEssayStore","onMounted","getStatusType","status","getStatusText","handleRowClick","row","handleView","handleFavorite","ElMessage","error","handleDelete","ElMessageBox","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_card","_hoisted_3","_cache","_unref","_createBlock","_component_el_alert","_component_el_link","$event","$router","_component_el_table","_component_el_table_column","_withCtx","_createTextVNode","_toDisplayString","_component_el_tag","_component_el_button","_withModifiers","_directive_loading","_hoisted_4","_component_el_empty"],"mappings":"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"}