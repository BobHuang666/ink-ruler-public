{"version":3,"file":"ForgotPassword-CSU4m-Tr.js","sources":["../../src/views/auth/ForgotPassword.vue"],"sourcesContent":["<template>\n  <div class=\"forgot-page\">\n    <div class=\"forgot-container\">\n      <el-card class=\"forgot-card\" shadow=\"always\">\n        <template #header>\n          <div class=\"card-header\">\n            <h2 class=\"header-font\">忘记密码</h2>\n            <p class=\"subtitle content-font\">通过邮箱验证码重置密码</p>\n          </div>\n        </template>\n\n        <el-form\n          ref=\"formRef\"\n          :model=\"form\"\n          :rules=\"rules\"\n          label-width=\"0\"\n          @submit.prevent=\"handleSubmit\"\n        >\n          <el-form-item prop=\"email\">\n            <el-input\n              v-model=\"form.email\"\n              placeholder=\"注册邮箱\"\n              size=\"large\"\n              :prefix-icon=\"Message\"\n            />\n          </el-form-item>\n          <p v-if=\"maskedEmail\" class=\"email-hint\">验证码将发送至 {{ maskedEmail }}</p>\n\n          <el-form-item prop=\"email_code\">\n            <div class=\"email-code-row\">\n              <el-input\n                v-model=\"form.email_code\"\n                placeholder=\"邮箱验证码（4位）\"\n                size=\"large\"\n                maxlength=\"4\"\n                class=\"email-code-input\"\n              />\n              <el-button\n                type=\"primary\"\n                size=\"large\"\n                :disabled=\"countdown > 0 || !form.email\"\n                :loading=\"sendingCode\"\n                class=\"send-code-btn\"\n                @click=\"handleSendCode\"\n              >\n                {{ countdown > 0 ? `${countdown}s 后重试` : '获取验证码' }}\n              </el-button>\n            </div>\n          </el-form-item>\n\n          <el-form-item prop=\"new_password\">\n            <el-input\n              v-model=\"form.new_password\"\n              type=\"password\"\n              placeholder=\"新密码（至少6位）\"\n              size=\"large\"\n              :prefix-icon=\"Lock\"\n              show-password\n            />\n          </el-form-item>\n\n          <el-form-item prop=\"confirm_password\">\n            <el-input\n              v-model=\"form.confirm_password\"\n              type=\"password\"\n              placeholder=\"确认新密码\"\n              size=\"large\"\n              :prefix-icon=\"Lock\"\n              show-password\n              @keyup.enter=\"handleSubmit\"\n            />\n          </el-form-item>\n\n          <el-form-item>\n            <el-button\n              type=\"primary\"\n              size=\"large\"\n              :loading=\"loading\"\n              class=\"submit-button\"\n              @click=\"handleSubmit\"\n            >\n              重置密码\n            </el-button>\n          </el-form-item>\n\n          <el-form-item>\n            <el-button size=\"large\" class=\"back-button\" @click=\"router.push('/login')\">\n              返回登录\n            </el-button>\n          </el-form-item>\n        </el-form>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive, onUnmounted, computed } from 'vue'\nimport { useRouter } from 'vue-router'\nimport * as authApi from '@/api/auth'\nimport { maskEmail } from '@/utils/format'\nimport { Message, Lock } from '@element-plus/icons-vue'\nimport { ElMessage, type FormInstance, type FormRules } from 'element-plus'\n\nconst router = useRouter()\nconst formRef = ref<FormInstance>()\nconst loading = ref(false)\nconst sendingCode = ref(false)\nconst countdown = ref(0)\nlet countdownTimer: ReturnType<typeof setInterval> | null = null\n\nconst form = reactive({\n  email: '',\n  email_code: '',\n  new_password: '',\n  confirm_password: '',\n})\n\nconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\nconst maskedEmail = computed(() =>\n  form.email && emailRegex.test(form.email) ? maskEmail(form.email) : ''\n)\n\nfunction validateConfirmPassword(_rule: unknown, value: string, callback: (error?: Error) => void) {\n  if (value !== form.new_password) {\n    callback(new Error('两次输入的密码不一致'))\n  } else {\n    callback()\n  }\n}\n\nconst rules: FormRules = {\n  email: [\n    { required: true, message: '请输入注册邮箱', trigger: 'blur' },\n    { type: 'email', message: '请输入正确的邮箱格式', trigger: 'blur' },\n  ],\n  email_code: [\n    { required: true, message: '请输入邮箱验证码', trigger: 'blur' },\n    { len: 4, message: '验证码为 4 位数字', trigger: 'blur' },\n    { pattern: /^\\d{4}$/, message: '验证码为 4 位数字', trigger: 'blur' },\n  ],\n  new_password: [\n    { required: true, message: '请输入新密码', trigger: 'blur' },\n    { min: 6, message: '密码至少 6 位', trigger: 'blur' },\n  ],\n  confirm_password: [\n    { required: true, message: '请确认新密码', trigger: 'blur' },\n    { validator: validateConfirmPassword, trigger: 'blur' },\n  ],\n}\n\nasync function handleSendCode() {\n  if (!form.email || countdown.value > 0) return\n  const emailRule = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  if (!emailRule.test(form.email)) {\n    ElMessage.warning('请先输入正确邮箱')\n    return\n  }\n  sendingCode.value = true\n  try {\n    await authApi.sendEmailCode(form.email)\n    ElMessage.success(`验证码已发送至 ${maskEmail(form.email)}，请查收`)\n    countdown.value = 60\n    countdownTimer = setInterval(() => {\n      countdown.value--\n      if (countdown.value <= 0 && countdownTimer) {\n        clearInterval(countdownTimer)\n        countdownTimer = null\n      }\n    }, 1000)\n  } catch (err: unknown) {\n    ElMessage.error((err as Error).message || '发送失败')\n  } finally {\n    sendingCode.value = false\n  }\n}\n\nonUnmounted(() => {\n  if (countdownTimer) clearInterval(countdownTimer)\n})\n\nasync function handleSubmit() {\n  if (!formRef.value) return\n  await formRef.value.validate(async (valid) => {\n    if (!valid) return\n    loading.value = true\n    try {\n      await authApi.resetPassword({\n        email: form.email,\n        email_code: form.email_code,\n        new_password: form.new_password,\n      })\n      ElMessage.success('密码已重置，请登录')\n      router.push('/login')\n    } catch (err: unknown) {\n      ElMessage.error((err as Error).message || '重置失败')\n    } finally {\n      loading.value = false\n    }\n  })\n}\n</script>\n\n<style scoped>\n.forgot-page {\n  min-height: calc(100vh - var(--header-height) - 80px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: var(--spacing-lg);\n  background: transparent;\n}\n\n.forgot-container {\n  width: 100%;\n  max-width: 420px;\n}\n\n.forgot-card {\n  border-radius: var(--border-radius-large);\n  box-shadow: var(--card-shadow);\n  border-color: var(--border-color-lighter);\n}\n\n.card-header {\n  text-align: center;\n}\n\n.card-header h2 {\n  font-size: var(--font-size-xxl);\n  font-weight: 600;\n  margin-bottom: var(--spacing-xs);\n  color: var(--color-text-primary);\n}\n\n.subtitle {\n  color: var(--color-text-secondary);\n  font-size: var(--font-size-sm);\n}\n\n.email-code-row {\n  display: flex;\n  gap: var(--spacing-sm);\n  width: 100%;\n}\n.email-code-input {\n  flex: 1;\n  min-width: 0;\n}\n.send-code-btn {\n  flex-shrink: 0;\n  white-space: nowrap;\n}\n\n.email-hint {\n  margin: 0 0 var(--spacing-sm);\n  font-size: var(--font-size-sm);\n  color: var(--color-text-secondary);\n}\n\n.submit-button,\n.back-button {\n  width: 100%;\n}\n</style>\n"],"names":["router","useRouter","formRef","ref","loading","sendingCode","countdown","countdownTimer","form","reactive","emailRegex","maskedEmail","computed","maskEmail","validateConfirmPassword","_rule","value","callback","rules","handleSendCode","ElMessage","authApi.sendEmailCode","err","onUnmounted","handleSubmit","valid","authApi.resetPassword","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_card","_cache","_component_el_form","_component_el_form_item","_component_el_input","$event","_unref","Message","_hoisted_3","_hoisted_4","_component_el_button","_createTextVNode","_toDisplayString","Lock"],"mappings":"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"}