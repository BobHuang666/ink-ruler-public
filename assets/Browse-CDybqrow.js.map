{"version":3,"file":"Browse-CDybqrow.js","sources":["../../src/views/classic/Browse.vue"],"sourcesContent":["<template>\n  <div class=\"classic-browse-page\">\n    <div class=\"page-bg\">\n      <div class=\"page-bg-gradient\" />\n    </div>\n    <div class=\"browse-inner\">\n      <section class=\"header\">\n        <h1 class=\"title title-font\">分类浏览</h1>\n        <p class=\"subtitle content-font\">按分类、作者、朝代、体裁筛选</p>\n      </section>\n      <div class=\"browse-layout\">\n        <aside class=\"filter-sidebar\">\n          <div class=\"filter-card\">\n            <el-form :inline=\"true\" class=\"filter-form\">\n              <el-form-item label=\"分类\">\n                <el-input\n                  v-model=\"filters.categories\"\n                  placeholder=\"如：家国情怀\"\n                  clearable\n                  style=\"width: 140px\"\n                />\n              </el-form-item>\n              <el-form-item label=\"作者\">\n                <el-input\n                  v-model=\"filters.authors\"\n                  placeholder=\"如：杜甫\"\n                  clearable\n                  style=\"width: 120px\"\n                />\n              </el-form-item>\n              <el-form-item label=\"朝代\">\n                <el-select\n                  v-model=\"filters.dynasties\"\n                  placeholder=\"朝代\"\n                  clearable\n                  style=\"width: 120px\"\n                >\n                  <el-option v-for=\"d in dynastyOpts\" :key=\"d\" :label=\"d\" :value=\"d\" />\n                </el-select>\n              </el-form-item>\n              <el-form-item label=\"体裁\">\n                <el-input\n                  v-model=\"filters.genres\"\n                  placeholder=\"如：诗\"\n                  clearable\n                  style=\"width: 100px\"\n                />\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\" @click=\"applyFilters\">筛选</el-button>\n                <el-button @click=\"randomBatch\">随机一批</el-button>\n              </el-form-item>\n            </el-form>\n          </div>\n        </aside>\n        <div ref=\"contentAreaRef\" class=\"content-area\">\n          <div v-if=\"items.length > 0 && totalPages > 1\" class=\"pagination-wrap pagination-top\">\n            <el-pagination\n              v-model:current-page=\"currentPage\"\n              :page-size=\"pageSize\"\n              :total=\"items.length\"\n              layout=\"prev, pager, next\"\n            />\n          </div>\n          <div v-if=\"loading && items.length === 0\" class=\"loading-wrap\">\n            <el-icon class=\"is-loading\" :size=\"32\"><Loading /></el-icon>\n          </div>\n          <div v-else-if=\"items.length === 0 && !loading\" class=\"empty-wrap\">\n            <el-empty description=\"暂无素材，请调整筛选条件或随机一批\">\n              <el-button type=\"primary\" @click=\"randomBatch\">随机一批</el-button>\n            </el-empty>\n          </div>\n          <div v-else class=\"list-wrap\">\n            <router-link\n              v-for=\"item in currentPageItems\"\n              :key=\"item.id\"\n              :to=\"`/classic/item/${item.id}`\"\n              class=\"item-card\"\n            >\n              <p class=\"original content-font\">{{ item.original_text }}</p>\n              <p v-if=\"item.translation\" class=\"translation\">{{ item.translation }}</p>\n              <div class=\"meta\">\n                <span v-if=\"item.author\">{{ item.author }}</span>\n                <span v-if=\"item.dynasty\">{{ item.dynasty }}</span>\n                <span v-if=\"item.genre\">{{ item.genre }}</span>\n              </div>\n            </router-link>\n          </div>\n          <div v-if=\"items.length > 0 && totalPages > 1\" class=\"pagination-wrap\">\n            <el-pagination\n              v-model:current-page=\"currentPage\"\n              :page-size=\"pageSize\"\n              :total=\"items.length\"\n              layout=\"prev, pager, next\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive, computed, onActivated, watch, nextTick } from 'vue'\nimport { Loading } from '@element-plus/icons-vue'\nimport { browse } from '@/api/classic'\nimport type { ClassicItem } from '@/types/classic'\nimport { getNavigationFrom } from '@/router'\n\ndefineOptions({ name: 'ClassicBrowse' })\n\nconst dynastyOpts = [\n  '先秦',\n  '汉',\n  '三国',\n  '晋',\n  '南北朝',\n  '隋',\n  '唐',\n  '五代',\n  '宋',\n  '辽',\n  '金',\n  '元',\n  '明',\n  '清',\n  '近现代',\n]\n\nconst filters = reactive({\n  categories: '',\n  authors: '',\n  dynasties: '',\n  genres: '',\n})\nconst items = ref<ClassicItem[]>([])\nconst loading = ref(false)\nconst pageSize = 20\nconst currentPage = ref(1)\n\nconst totalPages = computed(() => Math.ceil(items.value.length / pageSize) || 1)\nconst currentPageItems = computed(() => {\n  const start = (currentPage.value - 1) * pageSize\n  return items.value.slice(start, start + pageSize)\n})\n\nfunction toArray(s: string): string[] {\n  if (!s?.trim()) return []\n  return [s.trim()]\n}\n\nasync function applyFilters() {\n  loading.value = true\n  try {\n    const list = await browse({\n      categories: toArray(filters.categories),\n      authors: toArray(filters.authors),\n      dynasties: toArray(filters.dynasties),\n      genres: toArray(filters.genres),\n    })\n    items.value = list ?? []\n    currentPage.value = 1\n  } finally {\n    loading.value = false\n  }\n}\n\nasync function randomBatch() {\n  loading.value = true\n  try {\n    const list = await browse({ random: 20 })\n    items.value = list ?? []\n    currentPage.value = 1\n  } finally {\n    loading.value = false\n  }\n}\n\nconst contentAreaRef = ref<HTMLElement | null>(null)\n\nwatch(currentPage, () => {\n  nextTick(() => {\n    contentAreaRef.value?.scrollIntoView({ behavior: 'smooth', block: 'start' })\n  })\n})\n\nonActivated(() => {\n  // 从详情页返回时不刷新，其他情况刷新\n  const from = getNavigationFrom()\n  if (from?.name === 'ClassicItemDetail') return\n  randomBatch()\n})\n</script>\n\n<style scoped>\n.classic-browse-page {\n  position: relative;\n  min-height: calc(100vh - var(--header-height) - 80px);\n}\n.page-bg {\n  position: absolute;\n  inset: 0;\n  z-index: -1;\n}\n.page-bg-gradient {\n  position: absolute;\n  inset: 0;\n  background: var(--page-bg-gradient);\n}\n.browse-inner {\n  max-width: 72rem;\n  margin: 0 auto;\n  padding: 32px 16px;\n}\n.header {\n  text-align: center;\n  margin-bottom: 24px;\n}\n.title {\n  font-size: 2rem;\n  font-weight: 600;\n  margin-bottom: var(--spacing-sm);\n  color: var(--color-text-primary);\n}\n.subtitle {\n  font-size: var(--font-size-lg);\n  color: var(--color-text-regular);\n}\n.browse-layout {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: var(--spacing-lg);\n}\n@media (min-width: 1024px) {\n  .browse-layout {\n    grid-template-columns: 260px 1fr;\n    align-items: start;\n  }\n}\n.filter-sidebar {\n  order: 1;\n}\n.filter-card {\n  background: rgba(255, 255, 255, 0.9);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  border-radius: var(--border-radius-base);\n  box-shadow: var(--box-shadow-base);\n  border: 1px solid var(--border-color-lighter);\n  padding: var(--spacing-lg);\n  position: sticky;\n  top: calc(var(--header-height) + 16px);\n}\n.filter-form {\n  display: flex;\n  flex-direction: column;\n  gap: var(--spacing-md);\n}\n.filter-form :deep(.el-form-item) {\n  margin-bottom: 0;\n}\n.filter-form :deep(.el-form-item__label) {\n  color: var(--color-text-regular);\n  font-weight: 500;\n}\n.filter-form :deep(.el-input__wrapper),\n.filter-form :deep(.el-select .el-select__wrapper) {\n  border-radius: var(--border-radius-small);\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);\n}\n.filter-form :deep(.el-button--primary) {\n  border-radius: var(--border-radius-small);\n}\n.content-area {\n  order: 2;\n  min-width: 0;\n  scroll-margin-top: calc(var(--header-height) + 16px);\n}\n.loading-wrap {\n  text-align: center;\n  padding: 48px;\n}\n.empty-wrap {\n  display: flex;\n  justify-content: center;\n  padding: 48px;\n}\n.list-wrap {\n  display: flex;\n  flex-direction: column;\n  gap: var(--spacing-md);\n}\n.item-card {\n  display: block;\n  padding: var(--spacing-lg);\n  background: var(--card-gradient);\n  border-radius: var(--border-radius-base);\n  border: 1px solid rgba(214, 211, 209, 0.7);\n  text-decoration: none;\n  color: inherit;\n  transition:\n    box-shadow 0.2s,\n    background 0.2s;\n  backdrop-filter: blur(2px);\n}\n.item-card:hover {\n  box-shadow: var(--box-shadow-dark);\n  background: var(--card-gradient-hover);\n}\n.original {\n  font-size: var(--font-size-base);\n  line-height: 1.6;\n  margin-bottom: var(--spacing-xs);\n  color: var(--color-text-primary);\n}\n.translation {\n  font-size: var(--font-size-sm);\n  color: var(--color-text-regular);\n  margin-bottom: var(--spacing-xs);\n}\n.meta {\n  font-size: var(--font-size-xs);\n  color: var(--color-text-secondary);\n}\n.meta span + span::before {\n  content: ' · ';\n}\n.pagination-wrap {\n  display: flex;\n  justify-content: center;\n}\n.pagination-top {\n  margin-bottom: 16px;\n}\n.pagination-wrap:not(.pagination-top) {\n  margin-top: 24px;\n}\n</style>\n"],"names":["pageSize","dynastyOpts","filters","reactive","items","ref","loading","currentPage","totalPages","computed","currentPageItems","start","toArray","s","applyFilters","list","browse","randomBatch","contentAreaRef","watch","nextTick","onActivated","getNavigationFrom","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_createVNode","_component_el_form","_component_el_form_item","_component_el_input","_cache","$event","_component_el_select","_Fragment","_renderList","d","_component_el_option","_component_el_button","_hoisted_6","_component_el_pagination","_hoisted_7","_component_el_icon","_unref","Loading","_hoisted_8","_component_el_empty","_hoisted_9","item","_createBlock","_component_router_link","_hoisted_10","_toDisplayString","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16"],"mappings":"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"}