import{G as P,d as Q,u as W,l as C,m as D,B as X,c as N,a as h,e,w as a,r,j as M,g as u,A as v,f as A,b as Y,E as p,o as g,_ as Z}from"./index-DYibA2ZD.js";async function I(b){await P.patch("/users/me",b);const l=(await P.get("/users/me")).data,f=l.membership;return{id:l.id,email:l.email,phone:l.phone,nickname:l.nickname||"",avatar:l.avatar,role:l.role,status:l.status,created_at:l.created_at??"",updated_at:l.updated_at??"",...f&&{membership:{id:0,user_id:l.id,plan:f.plan,started_at:"",expired_at:f.expired_at,status:f.status,created_at:"",updated_at:""}}}}async function $(){return(await P.get("/memberships/me")).data}async function ee(b){return(await P.post("/memberships/purchase",{plan:b})).data}async function ae(b){return(await P.post("/feedbacks",b)).data}const te={class:"profile-page"},se={class:"container"},oe={class:"avatar-section"},le={class:"email"},re={key:0,class:"membership-info"},ne={class:"membership-actions"},de=Q({__name:"Profile",setup(b){const d=W(),l=C("info"),f=C(),F=C(),_=C(null),o=D({nickname:"",email:"",phone:"",avatar:""}),n=D({oldPassword:"",newPassword:"",confirmPassword:""}),c=D({content:"",contact:""}),L={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"昵称长度在2到20个字符",trigger:"blur"}]},T={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(i,t,U)=>{t!==n.newPassword?U(new Error("两次输入的密码不一致")):U()},trigger:"blur"}]};X(async()=>{d.user&&(o.nickname=d.user.nickname,o.email=d.user.email||"",o.phone=d.user.phone||"",o.avatar=d.user.avatar||""),await j()});async function j(){try{_.value=await $()}catch{}}async function z(){f.value&&await f.value.validate(async i=>{if(i)try{await I({nickname:o.nickname}),await d.fetchUser(),p.success("更新成功")}catch(t){p.error(t.message||"更新失败")}})}async function G(){F.value&&await F.value.validate(async i=>{if(i)try{await I({password_old:n.oldPassword,password_new:n.newPassword}),p.success("密码修改成功"),n.oldPassword="",n.newPassword="",n.confirmPassword=""}catch(t){p.error(t.message||"密码修改失败")}})}async function R(){try{const i=await ee("student");_.value=i,await d.fetchUser(),p.success("会员购买成功")}catch(i){p.error(i.message||"购买失败")}}async function H(){if(!c.content.trim()){p.warning("请输入反馈内容");return}try{await ae({content:c.content.trim(),contact:c.contact.trim()||void 0}),p.success("反馈提交成功，感谢您的建议！"),c.content="",c.contact=""}catch(i){p.error(i.message||"提交失败")}}return(i,t)=>{const U=r("el-avatar"),S=r("el-tag"),y=r("el-card"),q=r("el-col"),w=r("el-input"),m=r("el-form-item"),k=r("el-button"),B=r("el-form"),V=r("el-tab-pane"),x=r("el-descriptions-item"),J=r("el-descriptions"),E=r("el-empty"),K=r("el-tabs"),O=r("el-row");return g(),N("div",te,[h("div",se,[e(O,{gutter:20},{default:a(()=>[e(q,{span:6},{default:a(()=>[e(y,{shadow:"never",class:"profile-card"},{default:a(()=>[h("div",oe,[e(U,{size:100,src:o.avatar},{default:a(()=>[u(v(o.nickname?.[0]),1)]),_:1},8,["src"]),h("h3",null,v(o.nickname),1),h("p",le,v(o.email),1),A(d).isMember?(g(),M(S,{key:0,type:"success"},{default:a(()=>[...t[9]||(t[9]=[u("会员",-1)])]),_:1})):(g(),M(S,{key:1,type:"info"},{default:a(()=>[...t[10]||(t[10]=[u("普通用户",-1)])]),_:1}))])]),_:1})]),_:1}),e(q,{span:18},{default:a(()=>[e(K,{modelValue:l.value,"onUpdate:modelValue":t[8]||(t[8]=s=>l.value=s)},{default:a(()=>[e(V,{label:"个人信息",name:"info"},{default:a(()=>[e(y,{shadow:"never"},{default:a(()=>[e(B,{model:o,rules:L,ref_key:"formRef",ref:f,"label-width":"100px"},{default:a(()=>[e(m,{label:"昵称",prop:"nickname"},{default:a(()=>[e(w,{modelValue:o.nickname,"onUpdate:modelValue":t[0]||(t[0]=s=>o.nickname=s)},null,8,["modelValue"])]),_:1}),e(m,{label:"邮箱"},{default:a(()=>[e(w,{modelValue:o.email,"onUpdate:modelValue":t[1]||(t[1]=s=>o.email=s),disabled:""},null,8,["modelValue"])]),_:1}),e(m,{label:"手机号"},{default:a(()=>[e(w,{modelValue:o.phone,"onUpdate:modelValue":t[2]||(t[2]=s=>o.phone=s),disabled:""},null,8,["modelValue"])]),_:1}),e(m,null,{default:a(()=>[e(k,{type:"primary",onClick:z},{default:a(()=>[...t[11]||(t[11]=[u("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(V,{label:"修改密码",name:"password"},{default:a(()=>[e(y,{shadow:"never"},{default:a(()=>[e(B,{model:n,rules:T,ref_key:"passwordFormRef",ref:F,"label-width":"100px"},{default:a(()=>[e(m,{label:"原密码",prop:"oldPassword"},{default:a(()=>[e(w,{modelValue:n.oldPassword,"onUpdate:modelValue":t[3]||(t[3]=s=>n.oldPassword=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(m,{label:"新密码",prop:"newPassword"},{default:a(()=>[e(w,{modelValue:n.newPassword,"onUpdate:modelValue":t[4]||(t[4]=s=>n.newPassword=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(m,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[e(w,{modelValue:n.confirmPassword,"onUpdate:modelValue":t[5]||(t[5]=s=>n.confirmPassword=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(m,null,{default:a(()=>[e(k,{type:"primary",onClick:G},{default:a(()=>[...t[12]||(t[12]=[u("修改密码",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(V,{label:"会员信息",name:"membership"},{default:a(()=>[e(y,{shadow:"never"},{default:a(()=>[_.value?(g(),N("div",re,[e(J,{column:2,border:""},{default:a(()=>[e(x,{label:"会员计划"},{default:a(()=>[u(v(_.value.plan),1)]),_:1}),e(x,{label:"状态"},{default:a(()=>[e(S,{type:_.value.status==="active"?"success":"info"},{default:a(()=>[u(v(_.value.status==="active"?"有效":"已过期"),1)]),_:1},8,["type"])]),_:1}),e(x,{label:"开始时间"},{default:a(()=>[u(v(new Date(_.value.started_at).toLocaleDateString()),1)]),_:1}),e(x,{label:"到期时间"},{default:a(()=>[u(v(new Date(_.value.expired_at).toLocaleDateString()),1)]),_:1})]),_:1}),h("div",ne,[A(d).isMember?Y("",!0):(g(),M(k,{key:0,type:"primary",onClick:R},{default:a(()=>[...t[13]||(t[13]=[u(" 升级会员 ",-1)])]),_:1}))])])):(g(),M(E,{key:1,description:"您还不是会员"},{default:a(()=>[e(k,{type:"primary",onClick:R},{default:a(()=>[...t[14]||(t[14]=[u("购买会员",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),e(V,{label:"收藏夹",name:"favorites"},{default:a(()=>[e(y,{shadow:"never"},{default:a(()=>[e(E,{description:"暂无收藏"})]),_:1})]),_:1}),e(V,{label:"反馈建议",name:"feedback"},{default:a(()=>[e(y,{shadow:"never"},{default:a(()=>[e(B,{model:c,"label-width":"100px"},{default:a(()=>[e(m,{label:"反馈内容"},{default:a(()=>[e(w,{modelValue:c.content,"onUpdate:modelValue":t[6]||(t[6]=s=>c.content=s),type:"textarea",rows:6,placeholder:"请输入您的反馈或建议..."},null,8,["modelValue"])]),_:1}),e(m,{label:"联系方式"},{default:a(()=>[e(w,{modelValue:c.contact,"onUpdate:modelValue":t[7]||(t[7]=s=>c.contact=s),placeholder:"邮箱或手机号（可选）"},null,8,["modelValue"])]),_:1}),e(m,null,{default:a(()=>[e(k,{type:"primary",onClick:H},{default:a(()=>[...t[15]||(t[15]=[u("提交反馈",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])])}}}),me=Z(de,[["__scopeId","data-v-3046e1ac"]]);export{me as default};
//# sourceMappingURL=Profile-Dmiwxexa.js.map
