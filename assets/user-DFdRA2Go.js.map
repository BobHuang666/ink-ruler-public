{"version":3,"file":"user-DFdRA2Go.js","sources":["../../src/api/user.ts"],"sourcesContent":["import request from '@/utils/request'\nimport type { UserDetail, Membership, CheckinResult } from '@/types/user'\n\n// 更新当前用户\nexport async function updateUser(data: {\n  nickname?: string\n  avatar?: string\n  password_old?: string\n  password_new?: string\n  email_code?: string\n}): Promise<UserDetail> {\n  await request.patch('/users/me', data)\n  const res = await request.get<Record<string, unknown>>('/users/me')\n  const d = res.data\n  const membership = d.membership as\n    | { plan: string; expired_at: string; status: string; quota_remaining?: number | null }\n    | undefined\n  return {\n    id: d.id as number,\n    email: d.email as string,\n    phone: d.phone as string | undefined,\n    nickname: (d.nickname as string) || '',\n    avatar: d.avatar as string | undefined,\n    role: d.role as UserDetail['role'],\n    status: d.status as UserDetail['status'],\n    ink_drops: (d.ink_drops as number) ?? 0,\n    created_at: (d.created_at as string) ?? '',\n    updated_at: (d.updated_at as string) ?? '',\n    ...(membership && {\n      membership: {\n        id: 0,\n        user_id: d.id as number,\n        plan: membership.plan as 'student' | 'teacher',\n        started_at: '',\n        expired_at: membership.expired_at,\n        status: membership.status as 'active' | 'expired' | 'cancelled',\n        quota_remaining: membership.quota_remaining ?? undefined,\n        created_at: '',\n        updated_at: '',\n      },\n    }),\n  }\n}\n\n// 获取当前会员信息\nexport async function getMembership(): Promise<Membership | null> {\n  const res = await request.get<Membership | null>('/memberships/me')\n  return res.data\n}\n\n// 签到\nexport async function checkin(): Promise<CheckinResult> {\n  const res = await request.post<CheckinResult>('/users/me/checkin')\n  return res.data\n}\n\n// 墨滴流水项\nexport interface InkDropsLogItem {\n  id: number\n  user_id: number\n  amount: number\n  kind: string\n  created_at: string\n}\n\n// 墨滴流水分页\nexport async function getInkDropsLog(params: {\n  page?: number\n  size?: number\n}): Promise<{ list: InkDropsLogItem[]; total: number }> {\n  const res = await request.get<{ list: InkDropsLogItem[]; total: number }>(\n    '/users/me/ink-drops-log',\n    { params: { page: params.page ?? 1, size: params.size ?? 20 } }\n  )\n  return res.data\n}\n\n// 墨滴兑换（quota_10 | month | year）\nexport async function exchangeByInk(type: 'quota_10' | 'month' | 'year'): Promise<Membership> {\n  const res = await request.post<Membership>('/memberships/exchange-by-ink', { type })\n  return res.data\n}\n\n// 兑换码预览（返回类型，用于确认弹窗，不消耗）\nexport async function redeemPreview(code: string): Promise<{ kind: string }> {\n  const res = await request.get<{ kind: string }>('/memberships/redeem-preview', {\n    params: { code },\n  })\n  return res.data\n}\n\n// 兑换码兑换会员\nexport async function redeemMembership(code: string): Promise<Membership> {\n  const res = await request.post<Membership>('/memberships/redeem', { code })\n  return res.data\n}\n\n// 向当前用户邮箱发送验证码（用于注销等）\nexport async function sendEmailCodeForMe(): Promise<void> {\n  await request.post('/users/me/send-email-code')\n}\n\n// 注销账号（需密码+邮箱验证码）\nexport async function cancelAccount(password: string, emailCode: string): Promise<void> {\n  await request.post('/users/me/cancel', { password, email_code: emailCode })\n}\n"],"names":["updateUser","data","request","d","membership","getMembership","checkin","getInkDropsLog","params","exchangeByInk","type","redeemPreview","code","redeemMembership","sendEmailCodeForMe","cancelAccount","password","emailCode"],"mappings":"yCAIA,eAAsBA,EAAWC,EAMT,CACtB,MAAMC,EAAQ,MAAM,YAAaD,CAAI,EAErC,MAAME,GADM,MAAMD,EAAQ,IAA6B,WAAW,GACpD,KACRE,EAAaD,EAAE,WAGrB,MAAO,CACL,GAAIA,EAAE,GACN,MAAOA,EAAE,MACT,MAAOA,EAAE,MACT,SAAWA,EAAE,UAAuB,GACpC,OAAQA,EAAE,OACV,KAAMA,EAAE,KACR,OAAQA,EAAE,OACV,UAAYA,EAAE,WAAwB,EACtC,WAAaA,EAAE,YAAyB,GACxC,WAAaA,EAAE,YAAyB,GACxC,GAAIC,GAAc,CAChB,WAAY,CACV,GAAI,EACJ,QAASD,EAAE,GACX,KAAMC,EAAW,KACjB,WAAY,GACZ,WAAYA,EAAW,WACvB,OAAQA,EAAW,OACnB,gBAAiBA,EAAW,iBAAmB,OAC/C,WAAY,GACZ,WAAY,EAAA,CACd,CACF,CAEJ,CAGA,eAAsBC,GAA4C,CAEhE,OADY,MAAMH,EAAQ,IAAuB,iBAAiB,GACvD,IACb,CAGA,eAAsBI,GAAkC,CAEtD,OADY,MAAMJ,EAAQ,KAAoB,mBAAmB,GACtD,IACb,CAYA,eAAsBK,EAAeC,EAGmB,CAKtD,OAJY,MAAMN,EAAQ,IACxB,0BACA,CAAE,OAAQ,CAAE,KAAMM,EAAO,MAAQ,EAAG,KAAMA,EAAO,MAAQ,EAAA,CAAG,CAAE,GAErD,IACb,CAGA,eAAsBC,EAAcC,EAA0D,CAE5F,OADY,MAAMR,EAAQ,KAAiB,+BAAgC,CAAE,KAAAQ,EAAM,GACxE,IACb,CAGA,eAAsBC,EAAcC,EAAyC,CAI3E,OAHY,MAAMV,EAAQ,IAAsB,8BAA+B,CAC7E,OAAQ,CAAE,KAAAU,CAAA,CAAK,CAChB,GACU,IACb,CAGA,eAAsBC,EAAiBD,EAAmC,CAExE,OADY,MAAMV,EAAQ,KAAiB,sBAAuB,CAAE,KAAAU,EAAM,GAC/D,IACb,CAGA,eAAsBE,GAAoC,CACxD,MAAMZ,EAAQ,KAAK,2BAA2B,CAChD,CAGA,eAAsBa,EAAcC,EAAkBC,EAAkC,CACtF,MAAMf,EAAQ,KAAK,mBAAoB,CAAE,SAAAc,EAAU,WAAYC,EAAW,CAC5E"}