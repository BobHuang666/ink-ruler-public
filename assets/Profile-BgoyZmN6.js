import{W as L,d as _a,u as ga,l as u,m as ae,J as W,n as ka,C as wa,Q as Me,K as ya,c as h,a as s,e as a,w as l,r as m,g as o,D as i,j as C,f as X,X as Ce,F as G,x as Se,b as E,y as Ee,s as xe,U as ha,q as ba,E as r,A as Ca,o as c,R as xa,_ as Va}from"./index-D4Y8RUFA.js";import{m as ze}from"./format-CCCypCfS.js";import{u as Pa,j as La}from"./essay-BjsHiLFx.js";import{u as Ua,g as qa}from"./classic-DikB-Hlw.js";async function Te(g){await L.patch("/users/me",g);const k=(await L.get("/users/me")).data,d=k.membership;return{id:k.id,email:k.email,phone:k.phone,nickname:k.nickname||"",avatar:k.avatar,role:k.role,status:k.status,ink_drops:k.ink_drops??0,created_at:k.created_at??"",updated_at:k.updated_at??"",...d&&{membership:{id:0,user_id:k.id,plan:d.plan,started_at:"",expired_at:d.expired_at,status:d.status,quota_remaining:d.quota_remaining??void 0,created_at:"",updated_at:""}}}}async function Ve(){return(await L.get("/memberships/me")).data}async function Da(){return(await L.post("/users/me/checkin")).data}async function Ia(g){return(await L.get("/users/me/ink-drops-log",{params:{page:g.page??1,size:g.size??20}})).data}async function $a(g){return(await L.post("/memberships/exchange-by-ink",{type:g})).data}async function Fa(g){return(await L.post("/memberships/redeem",{code:g})).data}async function Be(){await L.post("/users/me/send-email-code")}async function Ma(g,U){await L.post("/users/me/cancel",{password:g,email_code:U})}async function Sa(g){return(await L.post("/feedbacks",g)).data}const Ea={class:"profile-page"},za={class:"container"},Ta={class:"avatar-section"},Ba={class:"avatar-section__name header-font"},Ra={class:"avatar-section__email"},Aa={class:"avatar-section__role"},Na={class:"avatar-section__meta"},Ka={class:"ink-drops"},Wa={class:"avatar-section__actions"},ja={class:"checkin-dialog"},Ha={class:"checkin-week-tip"},Ja={class:"checkin-ink-block"},Qa={class:"checkin-ink-value"},Xa={class:"checkin-grid"},Ga={class:"checkin-card-day"},Oa={class:"checkin-card-reward"},Ya={key:0,class:"checkin-card-done"},Za={class:"checkin-result-area"},el={class:"checkin-result-reward"},al={key:0,class:"password-email-hint"},ll={class:"password-code-row"},tl={class:"membership-intro"},sl={key:0,class:"membership-info"},nl={key:1,class:"membership-info"},ol={class:"ink-exchange-section"},il={class:"ink-balance"},rl={class:"ink-exchange-cards"},dl={class:"ink-card-title"},ul={class:"ink-card-desc"},cl={class:"ink-card-cost"},ml={class:"ink-cost-num"},pl={key:0,class:"ink-hint"},fl={class:"membership-redeem"},vl={class:"redeem-box"},_l={class:"ink-log-section"},gl={class:"ink-balance"},kl={key:0,class:"table-scroll-wrap"},wl={key:0,class:"table-scroll-wrap"},yl={class:"security-section"},hl={key:0,class:"cancel-email-hint"},bl={class:"cancel-code-row"},O="inkruler@163.com",Pe=20,Cl=_a({__name:"Profile",setup(g){const U=Ca(),k=wa(),d=ga(),j=u("info"),le=u(),te=u(),p=u(null),H=u(""),se=u(!1),ne=u(""),Re=[{type:"quota_10",title:"10 次次卡",desc:"可批改 10 篇作文，不限期使用",cost:900},{type:"month",title:"1 个月会员",desc:"30 天内无限次批改",cost:1500},{type:"year",title:"1 年会员",desc:"一年内无限次批改，更划算",cost:15e3}];async function Le(){try{await window.navigator.clipboard.writeText(O),r.success("已复制到剪贴板")}catch{r.error("复制失败")}}const _=ae({nickname:"",email:"",phone:"",avatar:""}),v=ae({email_code:"",oldPassword:"",newPassword:"",confirmPassword:""}),oe=W(()=>d.user?.email?ze(d.user.email):""),ie=W(()=>d.user?.email?ze(d.user.email):""),Ue=W(()=>!!(p.value?.started_at&&p.value?.expired_at&&!String(p.value.expired_at).startsWith("0001"))),re=u(!1),F=u(0);let z=null;const V=ae({content:"",contact:""}),J=u(!1),de=u(!1),ue=u(!1),M=u(0);let T=null;const w=ae({password:"",email_code:""}),B=u(!1),P=u(null),ce=u(!1),R=u(0),q=u(!1),Ae=[10,10,10,10,10,20,20],me=W(()=>P.value?P.value.week_count:R.value),Ne=W(()=>q.value?Math.max(0,R.value-1):R.value),Ke=W(()=>P.value?.ink_drops??d.user?.ink_drops??0);function We(){B.value=!1,j.value="inkLog",U.replace({path:"/profile",query:{tab:"inkLog"}})}function je(){P.value&&(R.value=P.value.week_count,P.value.already_signed&&(q.value=!0)),P.value=null}const pe=u([]),fe=u(!1),ve=u(1),_e=u(0),He={register_gift:"注册赠送",checkin:"签到",correct:"批改消耗",exchange_quota_10:"兑换10次卡",exchange_month:"兑换月会员",exchange_year:"兑换年会员",admin_grant:"管理员增加"},A=u([]),Y=u(!1),ge=u(null),N=u([]),Z=u(!1),ke=u(null),Je={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"昵称长度在2到20个字符",trigger:"blur"}]},Qe={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(n,e,Q)=>{e!==v.newPassword?Q(new Error("两次输入的密码不一致")):Q()},trigger:"blur"}]};async function Xe(){if(!(F.value>0)){re.value=!0;try{await Be(),r.success(`验证码已发送至 ${oe.value}，请查收`),F.value=60,z=setInterval(()=>{F.value--,F.value<=0&&z&&(clearInterval(z),z=null)},1e3)}catch(n){r.error(n.message||"发送失败")}finally{re.value=!1}}}ka(async()=>{const n=k.query.tab;n&&["membership","inkLog","info","password","favorites","classicFavorites","feedback","security"].includes(n)&&(j.value=n),d.user&&(_.nickname=d.user.nickname,_.email=d.user.email||"",_.phone=d.user.phone||"",_.avatar=d.user.avatar||""),await ea()}),Me(()=>d.user,n=>{n&&(R.value=n.checkin_week_count??0,q.value=n.checkin_today_done??!1)},{immediate:!0}),Me(j,n=>{n==="favorites"&&Ge(),n==="classicFavorites"&&Ye(),n==="inkLog"&&qe()});async function Ge(){Y.value=!0;try{A.value=await La()}catch{A.value=[]}finally{Y.value=!1}}async function Oe(n){ge.value=n.essay_id;try{await Pa(n.essay_id),A.value=A.value.filter(e=>e.essay_id!==n.essay_id),r.success("已取消收藏")}catch(e){r.error(e.message||"取消收藏失败")}finally{ge.value=null}}async function Ye(){Z.value=!0;try{N.value=await qa()}catch{N.value=[]}finally{Z.value=!1}}async function Ze(n){ke.value=n.id;try{await Ua(n.id),N.value=N.value.filter(e=>e.id!==n.id),r.success("已取消收藏")}catch(e){r.error(e.message||"取消收藏失败")}finally{ke.value=null}}async function ea(){try{p.value=await Ve()}catch{}}async function aa(){le.value&&await le.value.validate(async n=>{if(n)try{await Te({nickname:_.nickname}),await d.fetchUser(),r.success("更新成功")}catch(e){r.error(e.message||"更新失败")}})}async function la(){if(te.value){if(!v.email_code.trim()||v.email_code.length!==4){r.warning("请输入4位验证码");return}await te.value.validate(async n=>{if(n)try{await Te({password_old:v.oldPassword,password_new:v.newPassword,email_code:v.email_code}),r.success("密码修改成功"),v.email_code="",v.oldPassword="",v.newPassword="",v.confirmPassword=""}catch(e){r.error(e.message||"密码修改失败")}})}}async function ta(){const n=H.value.trim();if(n){se.value=!0;try{await Fa(n),await d.fetchUser(),p.value=await Ve(),H.value="",r.success("兑换成功")}catch(e){r.error(e.message||"兑换失败")}finally{se.value=!1}}}async function sa(n,e){if((d.user?.ink_drops??0)<e){const S=`墨滴不足，可联系 <span class="app-dialog-email" data-email="${O}">${O}</span> 获取更多服务`,f=xa.alert(S,"提示",{confirmButtonText:"确定",customClass:"app-dialog",dangerouslyUseHTMLString:!0});setTimeout(()=>{document.querySelectorAll(".app-dialog-email").forEach(x=>{x.addEventListener("click",()=>{window.navigator.clipboard.writeText(O).then(()=>r.success("已复制到剪贴板"),()=>r.error("复制失败"))})})},50),await f;return}ne.value=n;try{await $a(n),await d.fetchUser(),p.value=await Ve(),r.success("兑换成功")}catch(S){r.error(S.message||"兑换失败")}finally{ne.value=""}}async function qe(){fe.value=!0;try{const n=await Ia({page:ve.value,size:Pe});_e.value=n.total,pe.value=(n.list||[]).map(e=>({...e,kind_label:He[e.kind]||e.kind}))}catch{pe.value=[]}finally{fe.value=!1}}function na(n){ve.value=n,qe()}async function oa(){ce.value=!0;try{const n=await Da(),e=Number(n?.week_count??0);P.value={...n,week_count:e},R.value=e,q.value=!0,await d.fetchUser(),n.already_signed||r.success(`签到成功，获得 ${n.reward} 墨滴`)}catch(n){r.error(n.message||"签到失败")}finally{ce.value=!1}}async function ia(){if(!V.content.trim()){r.warning("请输入反馈内容");return}try{await Sa({content:V.content.trim(),contact:V.contact.trim()||void 0}),r.success("反馈提交成功，感谢您的建议！"),V.content="",V.contact=""}catch(n){r.error(n.message||"提交失败")}}function ra(){w.password="",w.email_code=""}function da(){w.password="",w.email_code="",J.value=!0}async function ua(){if(!(M.value>0)){ue.value=!0;try{await Be(),r.success(`验证码已发送至 ${ie.value}，请查收`),M.value=60,T=setInterval(()=>{M.value--,M.value<=0&&T&&(clearInterval(T),T=null)},1e3)}catch(n){r.error(n.message||"发送失败")}finally{ue.value=!1}}}ya(()=>{T&&clearInterval(T),z&&clearInterval(z)});async function we(){if(!w.password.trim()){r.warning("请输入当前密码");return}if(!w.email_code.trim()||w.email_code.length!==4){r.warning("请输入4位验证码");return}de.value=!0;try{await Ma(w.password,w.email_code),d.clearLocal(),J.value=!1,r.success("账号已注销"),U.replace("/")}catch(n){r.error(n.message||"注销失败")}finally{de.value=!1}}return(n,e)=>{const Q=m("el-avatar"),S=m("el-tag"),f=m("el-button"),x=m("el-card"),ca=m("el-link"),De=m("el-dialog"),Ie=m("el-col"),b=m("el-input"),y=m("el-form-item"),ee=m("el-form"),I=m("el-tab-pane"),K=m("el-descriptions-item"),$e=m("el-descriptions"),ye=m("el-empty"),D=m("el-table-column"),he=m("el-table"),ma=m("el-pagination"),Fe=m("router-link"),pa=m("el-alert"),fa=m("el-tabs"),va=m("el-row"),be=ha("loading");return c(),h("div",Ea,[s("div",za,[a(va,{gutter:20},{default:l(()=>[a(Ie,{xs:24,sm:6},{default:l(()=>[a(x,{shadow:"never",class:"profile-card"},{default:l(()=>[s("div",Ta,[a(Q,{size:88,src:_.avatar,class:"avatar-section__avatar"},{default:l(()=>[o(i(_.nickname?.[0]),1)]),_:1},8,["src"]),s("h3",Ba,i(_.nickname),1),s("p",Ra,i(_.email),1),s("div",Aa,[X(d).isMember?(c(),C(S,{key:0,type:"success",size:"small"},{default:l(()=>[...e[21]||(e[21]=[o("会员",-1)])]),_:1})):(c(),C(S,{key:1,type:"info",size:"small"},{default:l(()=>[...e[22]||(e[22]=[o("普通用户",-1)])]),_:1}))]),s("div",Na,[s("span",Ka,"墨滴："+i(X(d).user?.ink_drops??0),1)]),s("div",Wa,[a(f,{type:q.value?"default":"primary",plain:q.value,size:"default",class:Ce(["avatar-section__checkin-btn",{"avatar-section__checkin-btn--done":q.value}]),onClick:e[0]||(e[0]=t=>B.value=!0)},{default:l(()=>[o(i(q.value?"已签到":"签到"),1)]),_:1},8,["type","plain","class"])])])]),_:1}),a(De,{modelValue:B.value,"onUpdate:modelValue":e[3]||(e[3]=t=>B.value=t),title:"每日签到",width:"400px",class:"app-dialog checkin-dialog-wrap","align-center":"","destroy-on-close":"",onClose:je},{default:l(()=>[s("div",ja,[s("p",Ha,"本周累计签到 "+i(me.value)+" 天",1),s("div",Ja,[e[24]||(e[24]=s("span",{class:"checkin-ink-icon","aria-hidden":"true"},[s("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M12 2.5c0 0-5 8-5 13a5 5 0 0 0 10 0c0-5-5-13-5-13z",fill:"currentColor"})])],-1)),e[25]||(e[25]=s("span",{class:"checkin-ink-label"},"墨滴：",-1)),s("span",Qa,i(Ke.value),1),a(ca,{type:"primary",class:"checkin-ink-detail",onClick:We},{default:l(()=>[...e[23]||(e[23]=[o("明细 >",-1)])]),_:1})]),P.value===null?(c(),h(G,{key:0},[s("div",Xa,[(c(),h(G,null,Se(Ae,(t,$)=>s("div",{key:$,class:Ce(["checkin-grid-card",{"is-current":$===Ne.value,"is-signed":$<me.value}])},[s("span",Ga,i($+1)+"天",1),e[26]||(e[26]=s("span",{class:"checkin-card-star","aria-hidden":"true"},[s("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M12 2.5c0 0-5 8-5 13a5 5 0 0 0 10 0c0-5-5-13-5-13z",fill:"currentColor"})])],-1)),s("span",Oa,i(t)+" 墨滴",1),e[27]||(e[27]=s("span",{class:"checkin-card-vip"},"VIP+5",-1)),$<me.value?(c(),h("span",Ya,"✓")):E("",!0)],2)),64))]),q.value?(c(),C(f,{key:0,class:"checkin-btn-done checkin-btn-done-inline",onClick:e[1]||(e[1]=t=>B.value=!1)},{default:l(()=>[...e[28]||(e[28]=[o(" 今日已签到 ",-1)])]),_:1})):(c(),C(f,{key:1,class:"checkin-btn-submit",loading:ce.value,onClick:oa},{default:l(()=>[...e[29]||(e[29]=[o(" 立即签到 ",-1)])]),_:1},8,["loading"]))],64)):(c(),h(G,{key:1},[s("div",Za,[e[30]||(e[30]=s("div",{class:"checkin-result-star-wrap"},[s("span",{class:"checkin-result-star","aria-hidden":"true"},[s("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M12 2.5c0 0-5 8-5 13a5 5 0 0 0 10 0c0-5-5-13-5-13z",fill:"currentColor"})])])],-1)),s("p",el,"+"+i(P.value.reward)+" 墨滴",1),e[31]||(e[31]=s("p",{class:"checkin-result-msg"},"恭喜获得今日签到奖励！",-1))]),a(f,{class:"checkin-btn-done",onClick:e[2]||(e[2]=t=>B.value=!1)},{default:l(()=>[...e[32]||(e[32]=[o("今日已签到",-1)])]),_:1})],64))])]),_:1},8,["modelValue"])]),_:1}),a(Ie,{xs:24,sm:18},{default:l(()=>[a(fa,{modelValue:j.value,"onUpdate:modelValue":e[20]||(e[20]=t=>j.value=t),class:"profile-tabs"},{default:l(()=>[a(I,{label:"个人信息",name:"info"},{default:l(()=>[a(x,{shadow:"never"},{default:l(()=>[a(ee,{model:_,rules:Je,ref_key:"formRef",ref:le,class:"profile-form","label-width":"100px"},{default:l(()=>[a(y,{label:"昵称",prop:"nickname"},{default:l(()=>[a(b,{modelValue:_.nickname,"onUpdate:modelValue":e[4]||(e[4]=t=>_.nickname=t)},null,8,["modelValue"])]),_:1}),a(y,{label:"邮箱"},{default:l(()=>[a(b,{modelValue:_.email,"onUpdate:modelValue":e[5]||(e[5]=t=>_.email=t),disabled:""},null,8,["modelValue"])]),_:1}),a(y,{label:"手机号"},{default:l(()=>[a(b,{modelValue:_.phone,"onUpdate:modelValue":e[6]||(e[6]=t=>_.phone=t),disabled:""},null,8,["modelValue"])]),_:1}),a(y,null,{default:l(()=>[a(f,{type:"primary",onClick:aa},{default:l(()=>[...e[33]||(e[33]=[o("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),a(I,{label:"修改密码",name:"password"},{default:l(()=>[a(x,{shadow:"never"},{default:l(()=>[oe.value?(c(),h("p",al," 将向您的邮箱 "+i(oe.value)+" 发送验证码 ",1)):E("",!0),a(ee,{model:v,rules:Qe,ref_key:"passwordFormRef",ref:te,class:"profile-form","label-width":"100px"},{default:l(()=>[a(y,{label:"验证码",required:""},{default:l(()=>[s("div",ll,[a(b,{modelValue:v.email_code,"onUpdate:modelValue":e[7]||(e[7]=t=>v.email_code=t),placeholder:"4位验证码",maxlength:"4",class:"password-code-input"},null,8,["modelValue"]),a(f,{type:"primary",disabled:F.value>0,loading:re.value,onClick:Xe},{default:l(()=>[o(i(F.value>0?`${F.value}s 后重试`:"获取验证码"),1)]),_:1},8,["disabled","loading"])])]),_:1}),a(y,{label:"原密码",prop:"oldPassword"},{default:l(()=>[a(b,{modelValue:v.oldPassword,"onUpdate:modelValue":e[8]||(e[8]=t=>v.oldPassword=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(y,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(b,{modelValue:v.newPassword,"onUpdate:modelValue":e[9]||(e[9]=t=>v.newPassword=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(y,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(b,{modelValue:v.confirmPassword,"onUpdate:modelValue":e[10]||(e[10]=t=>v.confirmPassword=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(y,null,{default:l(()=>[a(f,{type:"primary",onClick:la},{default:l(()=>[...e[34]||(e[34]=[o("修改密码",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),a(I,{label:"会员信息",name:"membership"},{default:l(()=>[a(x,{shadow:"never"},{default:l(()=>[s("div",tl,[s("p",null,[e[35]||(e[35]=o(" 如需获得更多服务，可使用",-1)),e[36]||(e[36]=s("span",{class:"ink-highlight"},"墨滴",-1)),e[37]||(e[37]=o("兑换，或联系 ",-1)),s("span",{class:"contact-email",role:"button",tabindex:"0",onClick:Le,onKeydown:Ee(Le,["enter"])},i(O),32),e[38]||(e[38]=o(" 获取兑换码。 ",-1))])]),Ue.value&&p.value||p.value&&(p.value.quota_remaining??0)>0?(c(),h(G,{key:0},[e[39]||(e[39]=s("h3",{class:"membership-info-title"},"会员信息",-1)),Ue.value&&p.value?(c(),h("div",sl,[a($e,{column:1,border:"",class:"membership-descriptions"},{default:l(()=>[a(K,{label:"会员计划"},{default:l(()=>[o(i(p.value.plan),1)]),_:1}),a(K,{label:"状态"},{default:l(()=>[a(S,{type:p.value.status==="active"?"success":"info"},{default:l(()=>[o(i(p.value.status==="active"?"有效":"已过期"),1)]),_:1},8,["type"])]),_:1}),a(K,{label:"开始时间"},{default:l(()=>[o(i(new Date(p.value.started_at).toLocaleDateString()),1)]),_:1}),a(K,{label:"到期时间"},{default:l(()=>[o(i(new Date(p.value.expired_at).toLocaleDateString()),1)]),_:1}),(p.value.quota_remaining??0)>0?(c(),C(K,{key:0,label:"次数卡剩余"},{default:l(()=>[o(i(p.value.quota_remaining),1)]),_:1})):E("",!0)]),_:1})])):p.value&&(p.value.quota_remaining??0)>0?(c(),h("div",nl,[a($e,{column:1,border:"",class:"membership-descriptions"},{default:l(()=>[a(K,{label:"次数卡剩余"},{default:l(()=>[o(i(p.value.quota_remaining),1)]),_:1})]),_:1})])):E("",!0)],64)):(c(),C(ye,{key:1,description:"您还不是会员",class:"membership-empty"})),s("div",ol,[e[42]||(e[42]=s("h3",{class:"ink-exchange-title"},"墨滴兑换",-1)),s("p",il,"当前墨滴："+i(X(d).user?.ink_drops??0),1),s("div",rl,[(c(),h(G,null,Se(Re,t=>s("div",{key:t.type,class:"ink-exchange-card"},[s("div",dl,i(t.title),1),s("p",ul,i(t.desc),1),s("div",cl,[s("span",ml,i(t.cost),1),e[40]||(e[40]=s("span",{class:"ink-cost-unit"},"墨滴",-1))]),a(f,{type:"primary",size:"default",class:"ink-card-btn",loading:ne.value===t.type,onClick:$=>sa(t.type,t.cost)},{default:l(()=>[...e[41]||(e[41]=[o(" 兑换 ",-1)])]),_:1},8,["loading","onClick"])])),64))]),(X(d).user?.ink_drops??0)<900?(c(),h("p",pl," 墨滴可通过签到获得 ")):E("",!0)]),s("div",fl,[e[44]||(e[44]=s("h3",{class:"membership-redeem-title"},"兑换码",-1)),s("div",vl,[a(b,{modelValue:H.value,"onUpdate:modelValue":e[11]||(e[11]=t=>H.value=t),placeholder:"请输入兑换码",clearable:"",maxlength:"64",class:"redeem-input"},null,8,["modelValue"]),a(f,{type:"primary",loading:se.value,disabled:!H.value.trim(),onClick:ta},{default:l(()=>[...e[43]||(e[43]=[o(" 兑换 ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1}),a(I,{label:"墨滴明细",name:"inkLog"},{default:l(()=>[a(x,{shadow:"never"},{default:l(()=>[s("div",_l,[s("p",gl,"当前墨滴："+i(X(d).user?.ink_drops??0),1),xe((c(),C(he,{data:pe.value,class:"profile-table",style:{width:"100%"}},{default:l(()=>[a(D,{prop:"kind_label",label:"类型","min-width":"100"}),a(D,{prop:"amount",label:"变动","min-width":"80"},{default:l(({row:t})=>[s("span",{class:Ce(t.amount>=0?"ink-plus":"ink-minus")},i(t.amount>=0?"+":"")+i(t.amount),3)]),_:1}),a(D,{prop:"created_at",label:"时间","min-width":"160"},{default:l(({row:t})=>[o(i(new Date(t.created_at).toLocaleString()),1)]),_:1})]),_:1},8,["data"])),[[be,fe.value]]),_e.value>Pe?(c(),C(ma,{key:0,class:"ink-log-pagination",layout:"prev, pager, next","current-page":ve.value,"page-size":Pe,total:_e.value,onCurrentChange:na},null,8,["current-page","total"])):E("",!0)])]),_:1})]),_:1}),a(I,{label:"作文收藏",name:"favorites"},{default:l(()=>[a(x,{shadow:"never"},{default:l(()=>[A.value.length||Y.value?(c(),h("div",kl,[xe((c(),C(he,{data:A.value,class:"profile-table",style:{width:"100%"}},{default:l(()=>[a(D,{prop:"title",label:"标题","min-width":"120"},{default:l(({row:t})=>[a(Fe,{to:`/essay/${t.essay_id}`,class:"table-link"},{default:l(()=>[o(i(t.title||"无标题"),1)]),_:2},1032,["to"])]),_:1}),a(D,{label:"收藏时间","min-width":"150"},{default:l(({row:t})=>[o(i(new Date(t.essay_created_at).toLocaleString()),1)]),_:1}),a(D,{label:"操作","min-width":"100",align:"right"},{default:l(({row:t})=>[a(f,{type:"danger",text:"",loading:ge.value===t.essay_id,onClick:$=>Oe(t)},{default:l(()=>[...e[45]||(e[45]=[o(" 取消收藏 ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[be,Y.value]])])):(c(),C(ye,{key:1,description:"暂无作文收藏"},{default:l(()=>[a(f,{type:"primary",onClick:e[12]||(e[12]=t=>n.$router.push("/essay/history"))},{default:l(()=>[...e[46]||(e[46]=[o("去历史记录",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),a(I,{label:"素材收藏",name:"classicFavorites"},{default:l(()=>[a(x,{shadow:"never"},{default:l(()=>[N.value.length||Z.value?(c(),h("div",wl,[xe((c(),C(he,{data:N.value,class:"profile-table",style:{width:"100%"}},{default:l(()=>[a(D,{label:"内容","min-width":"180"},{default:l(({row:t})=>[a(Fe,{to:`/classic/item/${t.id}`,class:"table-link"},{default:l(()=>[o(i(t.original_text?.slice(0,50))+i((t.original_text?.length??0)>50?"…":""),1)]),_:2},1032,["to"])]),_:1}),a(D,{label:"作者/朝代","min-width":"100"},{default:l(({row:t})=>[o(i(t.author)+" "+i(t.dynasty),1)]),_:1}),a(D,{label:"操作","min-width":"100",align:"right"},{default:l(({row:t})=>[a(f,{type:"danger",text:"",loading:ke.value===t.id,onClick:$=>Ze(t)},{default:l(()=>[...e[47]||(e[47]=[o(" 取消收藏 ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[be,Z.value]])])):(c(),C(ye,{key:1,description:"暂无素材收藏"},{default:l(()=>[a(f,{type:"primary",onClick:e[13]||(e[13]=t=>n.$router.push("/classic"))},{default:l(()=>[...e[48]||(e[48]=[o("去素材中心",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),a(I,{label:"反馈建议",name:"feedback"},{default:l(()=>[a(x,{shadow:"never"},{default:l(()=>[a(ee,{model:V,class:"profile-form","label-width":"100px"},{default:l(()=>[a(y,{label:"反馈内容"},{default:l(()=>[a(b,{modelValue:V.content,"onUpdate:modelValue":e[14]||(e[14]=t=>V.content=t),type:"textarea",rows:6,placeholder:"请输入您的反馈或建议..."},null,8,["modelValue"])]),_:1}),a(y,{label:"联系方式"},{default:l(()=>[a(b,{modelValue:V.contact,"onUpdate:modelValue":e[15]||(e[15]=t=>V.contact=t),placeholder:"邮箱或手机号（可选）"},null,8,["modelValue"])]),_:1}),a(y,null,{default:l(()=>[a(f,{type:"primary",onClick:ia},{default:l(()=>[...e[49]||(e[49]=[o("提交反馈",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),a(I,{label:"账号安全",name:"security"},{default:l(()=>[a(x,{shadow:"never"},{default:l(()=>[s("div",yl,[e[51]||(e[51]=s("h4",null,"注销账号",-1)),e[52]||(e[52]=s("p",{class:"security-desc"},"注销后账号及关联数据将被删除且无法恢复，请谨慎操作。",-1)),a(f,{type:"danger",plain:"",onClick:da},{default:l(()=>[...e[50]||(e[50]=[o("申请注销账号",-1)])]),_:1})])]),_:1}),a(De,{modelValue:J.value,"onUpdate:modelValue":e[19]||(e[19]=t=>J.value=t),title:"注销账号",width:"400px",class:"cancel-account-dialog app-dialog","close-on-click-modal":!1,onClosed:ra},{footer:l(()=>[a(f,{onClick:e[18]||(e[18]=t=>J.value=!1)},{default:l(()=>[...e[54]||(e[54]=[o("取消",-1)])]),_:1}),a(f,{type:"danger",loading:de.value,onClick:we},{default:l(()=>[...e[55]||(e[55]=[o(" 确认注销 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(pa,{class:"tip-alert cancel-dialog-tip",title:"提示",type:"warning",closable:!1,"show-icon":""},{default:l(()=>[...e[53]||(e[53]=[o(" 注销后账号及关联数据将被删除且无法恢复，请谨慎操作。 ",-1)])]),_:1}),ie.value?(c(),h("p",hl," 将向您的邮箱 "+i(ie.value)+" 发送验证码 ",1)):E("",!0),a(ee,{model:w,"label-width":"80px",onSubmit:ba(we,["prevent"])},{default:l(()=>[a(y,{label:"验证码",required:""},{default:l(()=>[s("div",bl,[a(b,{modelValue:w.email_code,"onUpdate:modelValue":e[16]||(e[16]=t=>w.email_code=t),placeholder:"4位验证码",maxlength:"4","show-word-limit":"",class:"cancel-code-input"},null,8,["modelValue"]),a(f,{type:"primary",disabled:M.value>0,loading:ue.value,onClick:ua},{default:l(()=>[o(i(M.value>0?`${M.value}s 后重试`:"获取验证码"),1)]),_:1},8,["disabled","loading"])])]),_:1}),a(y,{label:"当前密码",required:""},{default:l(()=>[a(b,{modelValue:w.password,"onUpdate:modelValue":e[17]||(e[17]=t=>w.password=t),type:"password","show-password":"",placeholder:"请输入当前密码以确认",onKeyup:Ee(we,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])])}}}),ql=Va(Cl,[["__scopeId","data-v-91f8043f"]]);export{ql as default};
//# sourceMappingURL=Profile-BgoyZmN6.js.map
