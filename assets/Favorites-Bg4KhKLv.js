import{d as R,k as n,m as S,C as T,R as j,c as k,a as B,e as s,w as t,r as o,N as m,q as D,$ as z,g as i,t as v,E as g,o as r,_ as A}from"./index-DECpGxzK.js";import{u as G,j as H}from"./essay-Bn_SkkW3.js";import{u as J,g as K}from"./classic-CssVj8Rj.js";const O={class:"favorites-page"},P={class:"container"},Q={key:0,class:"table-scroll-wrap"},W={key:0,class:"table-scroll-wrap"},X=R({__name:"Favorites",setup(Y){const E=T(),_=n("essay"),u=n([]),f=n(!1),b=n(null),d=n([]),y=n(!1),h=n(null);async function N(){f.value=!0;try{u.value=await H()}catch{u.value=[]}finally{f.value=!1}}async function I(l){b.value=l.essay_id;try{await G(l.essay_id),u.value=u.value.filter(e=>e.essay_id!==l.essay_id),g.success("已取消收藏")}catch(e){g.error(e.message||"取消收藏失败")}finally{b.value=null}}async function L(){y.value=!0;try{d.value=await K()}catch{d.value=[]}finally{y.value=!1}}async function U(l){h.value=l.id;try{await J(l.id),d.value=d.value.filter(e=>e.id!==l.id),g.success("已取消收藏")}catch(e){g.error(e.message||"取消收藏失败")}finally{h.value=null}}return S(()=>{const l=E.query.tab;(l==="classic"||l==="essay")&&(_.value=l)}),j(_,l=>{l==="essay"&&N(),l==="classic"&&L()},{immediate:!0}),(l,e)=>{const w=o("router-link"),c=o("el-table-column"),p=o("el-button"),C=o("el-table"),$=o("el-empty"),F=o("el-card"),x=o("el-tab-pane"),q=o("el-tabs"),V=z("loading");return r(),k("div",O,[B("div",P,[e[7]||(e[7]=B("h1",{class:"page-title header-font"},"我的收藏",-1)),s(q,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),class:"favorites-tabs"},{default:t(()=>[s(x,{label:"作文收藏",name:"essay"},{default:t(()=>[s(F,{shadow:"never"},{default:t(()=>[u.value.length||f.value?(r(),k("div",Q,[D((r(),m(C,{data:u.value,class:"profile-table",style:{width:"100%"}},{default:t(()=>[s(c,{prop:"title",label:"标题","min-width":"120"},{default:t(({row:a})=>[s(w,{to:`/essay/${a.essay_id}`,class:"table-link"},{default:t(()=>[i(v(a.title||"无标题"),1)]),_:2},1032,["to"])]),_:1}),s(c,{label:"收藏时间","min-width":"150"},{default:t(({row:a})=>[i(v(new Date(a.essay_created_at).toLocaleString()),1)]),_:1}),s(c,{label:"操作","min-width":"100",align:"right"},{default:t(({row:a})=>[s(p,{type:"danger",text:"",loading:b.value===a.essay_id,onClick:M=>I(a)},{default:t(()=>[...e[3]||(e[3]=[i(" 取消收藏 ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[V,f.value]])])):(r(),m($,{key:1,description:"暂无作文收藏"},{default:t(()=>[s(p,{type:"primary",onClick:e[0]||(e[0]=a=>l.$router.push("/essay/history"))},{default:t(()=>[...e[4]||(e[4]=[i("去历史记录",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),s(x,{label:"素材收藏",name:"classic"},{default:t(()=>[s(F,{shadow:"never"},{default:t(()=>[d.value.length||y.value?(r(),k("div",W,[D((r(),m(C,{data:d.value,class:"profile-table",style:{width:"100%"}},{default:t(()=>[s(c,{label:"内容","min-width":"180"},{default:t(({row:a})=>[s(w,{to:`/classic/item/${a.id}`,class:"table-link"},{default:t(()=>[i(v(a.original_text?.slice(0,50))+v((a.original_text?.length??0)>50?"…":""),1)]),_:2},1032,["to"])]),_:1}),s(c,{label:"作者/朝代","min-width":"100"},{default:t(({row:a})=>[i(v(a.author)+" "+v(a.dynasty),1)]),_:1}),s(c,{label:"操作","min-width":"100",align:"right"},{default:t(({row:a})=>[s(p,{type:"danger",text:"",loading:h.value===a.id,onClick:M=>U(a)},{default:t(()=>[...e[5]||(e[5]=[i(" 取消收藏 ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[V,y.value]])])):(r(),m($,{key:1,description:"暂无素材收藏"},{default:t(()=>[s(p,{type:"primary",onClick:e[1]||(e[1]=a=>l.$router.push("/classic"))},{default:t(()=>[...e[6]||(e[6]=[i("去素材中心",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"])])])}}}),te=A(X,[["__scopeId","data-v-c767ebea"]]);export{te as default};
//# sourceMappingURL=Favorites-Bg4KhKLv.js.map
