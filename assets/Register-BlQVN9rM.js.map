{"version":3,"file":"Register-BlQVN9rM.js","sources":["../../src/views/auth/Register.vue"],"sourcesContent":["<template>\n  <div class=\"register-page\">\n    <div class=\"register-container\">\n      <el-card class=\"register-card\" shadow=\"always\">\n        <template #header>\n          <div class=\"card-header\">\n            <h2 class=\"header-font\">注册</h2>\n            <p class=\"subtitle content-font\">创建你的账号</p>\n          </div>\n        </template>\n\n        <el-form\n          ref=\"formRef\"\n          :model=\"form\"\n          :rules=\"rules\"\n          label-width=\"0\"\n          @submit.prevent=\"handleRegister\"\n        >\n          <el-form-item prop=\"email\">\n            <el-input v-model=\"form.email\" placeholder=\"邮箱\" size=\"large\" :prefix-icon=\"Message\" />\n          </el-form-item>\n\n          <el-form-item prop=\"email_code\">\n            <div class=\"email-code-row\">\n              <el-input\n                v-model=\"form.email_code\"\n                placeholder=\"邮箱验证码（4位）\"\n                size=\"large\"\n                maxlength=\"4\"\n                class=\"email-code-input\"\n              />\n              <el-button\n                type=\"primary\"\n                size=\"large\"\n                :disabled=\"countdown > 0 || !form.email\"\n                :loading=\"sendingCode\"\n                class=\"send-code-btn\"\n                @click=\"handleSendCode\"\n              >\n                {{ countdown > 0 ? `${countdown}s 后重试` : '获取验证码' }}\n              </el-button>\n            </div>\n          </el-form-item>\n\n          <el-form-item prop=\"phone\">\n            <el-input\n              v-model=\"form.phone\"\n              placeholder=\"手机号（可选）\"\n              size=\"large\"\n              :prefix-icon=\"Phone\"\n            />\n          </el-form-item>\n\n          <el-form-item prop=\"nickname\">\n            <el-input v-model=\"form.nickname\" placeholder=\"昵称\" size=\"large\" :prefix-icon=\"User\" />\n          </el-form-item>\n\n          <el-form-item prop=\"password\">\n            <el-input\n              v-model=\"form.password\"\n              type=\"password\"\n              placeholder=\"密码（至少6位）\"\n              size=\"large\"\n              :prefix-icon=\"Lock\"\n              show-password\n            />\n          </el-form-item>\n\n          <el-form-item prop=\"confirmPassword\">\n            <el-input\n              v-model=\"form.confirmPassword\"\n              type=\"password\"\n              placeholder=\"确认密码\"\n              size=\"large\"\n              :prefix-icon=\"Lock\"\n              show-password\n              @keyup.enter=\"handleRegister\"\n            />\n          </el-form-item>\n\n          <el-form-item prop=\"agreement\" class=\"agreement-item\">\n            <el-checkbox v-model=\"form.agreement\">\n              我已阅读并同意\n              <el-link type=\"primary\" :underline=\"false\">《服务条款》</el-link>\n              和\n              <el-link type=\"primary\" :underline=\"false\">《隐私政策》</el-link>\n            </el-checkbox>\n          </el-form-item>\n\n          <el-form-item>\n            <el-button\n              type=\"primary\"\n              size=\"large\"\n              :loading=\"loading\"\n              class=\"register-button\"\n              @click=\"handleRegister\"\n            >\n              注册\n            </el-button>\n          </el-form-item>\n\n          <el-divider>或</el-divider>\n\n          <el-form-item>\n            <el-button size=\"large\" class=\"login-button\" @click=\"$router.push('/login')\">\n              已有账号？登录\n            </el-button>\n          </el-form-item>\n        </el-form>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive, onUnmounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useAuthStore } from '@/stores/auth'\nimport * as authApi from '@/api/auth'\nimport { Message, Phone, User, Lock } from '@element-plus/icons-vue'\nimport { ElMessage, type FormInstance, type FormRules } from 'element-plus'\n\nconst router = useRouter()\nconst authStore = useAuthStore()\n\nconst formRef = ref<FormInstance>()\nconst loading = ref(false)\nconst sendingCode = ref(false)\nconst countdown = ref(0)\nlet countdownTimer: ReturnType<typeof setInterval> | null = null\n\nconst form = reactive({\n  email: '',\n  email_code: '',\n  phone: '',\n  nickname: '',\n  password: '',\n  confirmPassword: '',\n  agreement: false,\n})\n\nasync function handleSendCode() {\n  if (!form.email || countdown.value > 0) return\n  const emailRule = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  if (!emailRule.test(form.email)) {\n    ElMessage.warning('请先输入正确邮箱')\n    return\n  }\n  sendingCode.value = true\n  try {\n    await authApi.sendEmailCode(form.email)\n    ElMessage.success('验证码已发送，请查收邮箱')\n    countdown.value = 60\n    countdownTimer = setInterval(() => {\n      countdown.value--\n      if (countdown.value <= 0 && countdownTimer) {\n        clearInterval(countdownTimer)\n        countdownTimer = null\n      }\n    }, 1000)\n  } catch (err: unknown) {\n    ElMessage.error((err as Error).message || '发送失败')\n  } finally {\n    sendingCode.value = false\n  }\n}\n\nonUnmounted(() => {\n  if (countdownTimer) clearInterval(countdownTimer)\n})\n\nconst validateConfirmPassword = (\n  _rule: unknown,\n  value: string,\n  callback: (error?: Error) => void\n) => {\n  if (value !== form.password) {\n    callback(new Error('两次输入的密码不一致'))\n  } else {\n    callback()\n  }\n}\n\nconst validateAgreement = (_rule: unknown, value: boolean, callback: (error?: Error) => void) => {\n  if (!value) {\n    callback(new Error('请先同意服务条款'))\n  } else {\n    callback()\n  }\n}\n\n// 中国大陆 11 位手机号：1 开头，第二位 3-9；不填则不校验\nconst validatePhone = (_rule: unknown, value: string, callback: (error?: Error) => void) => {\n  if (!value || !value.trim()) {\n    callback()\n    return\n  }\n  if (!/^1[3-9]\\d{9}$/.test(value.trim())) {\n    callback(new Error('请输入正确的手机号格式'))\n  } else {\n    callback()\n  }\n}\n\nconst rules: FormRules = {\n  email: [\n    { required: true, message: '请输入邮箱', trigger: 'blur' },\n    { type: 'email', message: '请输入正确的邮箱格式', trigger: 'blur' },\n  ],\n  email_code: [\n    { required: true, message: '请输入邮箱验证码', trigger: 'blur' },\n    { len: 4, message: '验证码为 4 位数字', trigger: 'blur' },\n    { pattern: /^\\d{4}$/, message: '验证码为 4 位数字', trigger: 'blur' },\n  ],\n  phone: [{ validator: validatePhone, trigger: 'blur' }],\n  nickname: [\n    { required: true, message: '请输入昵称', trigger: 'blur' },\n    { min: 2, max: 20, message: '昵称长度在2到20个字符', trigger: 'blur' },\n  ],\n  password: [\n    { required: true, message: '请输入密码', trigger: 'blur' },\n    { min: 6, message: '密码长度不能少于6位', trigger: 'blur' },\n  ],\n  confirmPassword: [\n    { required: true, message: '请确认密码', trigger: 'blur' },\n    { validator: validateConfirmPassword, trigger: 'blur' },\n  ],\n  agreement: [{ validator: validateAgreement, trigger: 'change' }],\n}\n\nasync function handleRegister() {\n  if (!formRef.value) return\n\n  await formRef.value.validate(async (valid) => {\n    if (valid) {\n      loading.value = true\n      try {\n        await authStore.register({\n          email: form.email,\n          email_code: form.email_code,\n          phone: form.phone || undefined,\n          password: form.password,\n          nickname: form.nickname,\n        })\n        ElMessage.success('注册成功，请登录')\n        router.push('/login')\n      } catch (error: unknown) {\n        ElMessage.error((error as Error).message || '注册失败')\n      } finally {\n        loading.value = false\n      }\n    }\n  })\n}\n</script>\n\n<style scoped>\n.register-page {\n  min-height: calc(100vh - var(--header-height) - 80px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: var(--spacing-lg);\n  background: transparent;\n}\n\n.register-container {\n  width: 100%;\n  max-width: 420px;\n}\n\n.register-card {\n  border-radius: var(--border-radius-large);\n  box-shadow: var(--card-shadow);\n  border-color: var(--border-color-lighter);\n}\n\n.card-header {\n  text-align: center;\n}\n\n.card-header h2 {\n  font-size: var(--font-size-xxl);\n  font-weight: 600;\n  margin-bottom: var(--spacing-xs);\n  color: var(--color-text-primary);\n}\n\n.subtitle {\n  color: var(--color-text-secondary);\n  font-size: var(--font-size-sm);\n}\n\n.email-code-row {\n  display: flex;\n  gap: var(--spacing-sm);\n  width: 100%;\n}\n.email-code-input {\n  flex: 1;\n  min-width: 0;\n}\n.send-code-btn {\n  flex-shrink: 0;\n  white-space: nowrap;\n}\n\n.register-button {\n  width: 100%;\n}\n\n.login-button {\n  width: 100%;\n}\n\n/* 协议项：文案可换行，与错误提示留出间隙 */\n.register-card :deep(.agreement-item .el-form-item__content) {\n  min-width: 0;\n  flex-wrap: wrap;\n  margin-bottom: 0;\n  padding-bottom: 4px;\n}\n.register-card :deep(.agreement-item .el-checkbox) {\n  align-items: flex-start;\n}\n.register-card :deep(.agreement-item .el-checkbox__label) {\n  white-space: normal;\n  word-break: break-word;\n  line-height: 1.5;\n}\n/* 错误提示改为文档流，与文案留足间距（单行/两行都不遮挡） */\n.register-card :deep(.agreement-item .el-form-item__error) {\n  position: static;\n  margin-top: 10px;\n  margin-bottom: 0;\n  padding-top: 0;\n}\n</style>\n"],"names":["router","useRouter","authStore","useAuthStore","formRef","ref","loading","sendingCode","countdown","countdownTimer","form","reactive","handleSendCode","ElMessage","authApi.sendEmailCode","err","onUnmounted","rules","_rule","value","callback","handleRegister","valid","error","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_card","_cache","_component_el_form","_component_el_form_item","_component_el_input","$event","_unref","Message","_hoisted_3","_component_el_button","_createTextVNode","_toDisplayString","Phone","User","Lock","_component_el_checkbox","_component_el_link","_component_el_divider","$router"],"mappings":"8TA0HA,MAAMA,EAASC,EAAA,EACTC,EAAYC,EAAA,EAEZC,EAAUC,EAAA,EACVC,EAAUD,EAAI,EAAK,EACnBE,EAAcF,EAAI,EAAK,EACvBG,EAAYH,EAAI,CAAC,EACvB,IAAII,EAAwD,KAE5D,MAAMC,EAAOC,EAAS,CACpB,MAAO,GACP,WAAY,GACZ,MAAO,GACP,SAAU,GACV,SAAU,GACV,gBAAiB,GACjB,UAAW,EAAA,CACZ,EAED,eAAeC,GAAiB,CAC9B,GAAI,CAACF,EAAK,OAASF,EAAU,MAAQ,EAAG,OAExC,GAAI,CADc,6BACH,KAAKE,EAAK,KAAK,EAAG,CAC/BG,EAAU,QAAQ,UAAU,EAC5B,MACF,CACAN,EAAY,MAAQ,GACpB,GAAI,CACF,MAAMO,EAAsBJ,EAAK,KAAK,EACtCG,EAAU,QAAQ,cAAc,EAChCL,EAAU,MAAQ,GAClBC,EAAiB,YAAY,IAAM,CACjCD,EAAU,QACNA,EAAU,OAAS,GAAKC,IAC1B,cAAcA,CAAc,EAC5BA,EAAiB,KAErB,EAAG,GAAI,CACT,OAASM,EAAc,CACrBF,EAAU,MAAOE,EAAc,SAAW,MAAM,CAClD,QAAA,CACER,EAAY,MAAQ,EACtB,CACF,CAEAS,EAAY,IAAM,CACZP,iBAA8BA,CAAc,CAClD,CAAC,EAmCD,MAAMQ,EAAmB,CACvB,MAAO,CACL,CAAE,SAAU,GAAM,QAAS,QAAS,QAAS,MAAA,EAC7C,CAAE,KAAM,QAAS,QAAS,aAAc,QAAS,MAAA,CAAO,EAE1D,WAAY,CACV,CAAE,SAAU,GAAM,QAAS,WAAY,QAAS,MAAA,EAChD,CAAE,IAAK,EAAG,QAAS,aAAc,QAAS,MAAA,EAC1C,CAAE,QAAS,UAAW,QAAS,aAAc,QAAS,MAAA,CAAO,EAE/D,MAAO,CAAC,CAAE,UAtBU,CAACC,EAAgBC,EAAeC,IAAsC,CAC1F,GAAI,CAACD,GAAS,CAACA,EAAM,OAAQ,CAC3BC,EAAA,EACA,MACF,CACK,gBAAgB,KAAKD,EAAM,KAAA,CAAM,EAGpCC,EAAA,EAFAA,EAAS,IAAI,MAAM,aAAa,CAAC,CAIrC,EAYsC,QAAS,OAAQ,EACrD,SAAU,CACR,CAAE,SAAU,GAAM,QAAS,QAAS,QAAS,MAAA,EAC7C,CAAE,IAAK,EAAG,IAAK,GAAI,QAAS,eAAgB,QAAS,MAAA,CAAO,EAE9D,SAAU,CACR,CAAE,SAAU,GAAM,QAAS,QAAS,QAAS,MAAA,EAC7C,CAAE,IAAK,EAAG,QAAS,aAAc,QAAS,MAAA,CAAO,EAEnD,gBAAiB,CACf,CAAE,SAAU,GAAM,QAAS,QAAS,QAAS,MAAA,EAC7C,CAAE,UAtD0B,CAC9BF,EACAC,EACAC,IACG,CACCD,IAAUT,EAAK,SACjBU,EAAS,IAAI,MAAM,YAAY,CAAC,EAEhCA,EAAA,CAEJ,EA4C0C,QAAS,MAAA,CAAO,EAExD,UAAW,CAAC,CAAE,UA5CU,CAACF,EAAgBC,EAAgBC,IAAsC,CAC1FD,EAGHC,EAAA,EAFAA,EAAS,IAAI,MAAM,UAAU,CAAC,CAIlC,EAsC8C,QAAS,SAAU,CAAA,EAGjE,eAAeC,GAAiB,CACzBjB,EAAQ,OAEb,MAAMA,EAAQ,MAAM,SAAS,MAAOkB,GAAU,CAC5C,GAAIA,EAAO,CACThB,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAMJ,EAAU,SAAS,CACvB,MAAOQ,EAAK,MACZ,WAAYA,EAAK,WACjB,MAAOA,EAAK,OAAS,OACrB,SAAUA,EAAK,SACf,SAAUA,EAAK,QAAA,CAChB,EACDG,EAAU,QAAQ,UAAU,EAC5Bb,EAAO,KAAK,QAAQ,CACtB,OAASuB,EAAgB,CACvBV,EAAU,MAAOU,EAAgB,SAAW,MAAM,CACpD,QAAA,CACEjB,EAAQ,MAAQ,EAClB,CACF,CACF,CAAC,CACH,4JA5PE,OAAAkB,EAAA,EAAAC,EA8GM,MA9GNC,EA8GM,CA7GJC,EA4GM,MA5GNC,EA4GM,CA3GJC,EA0GUC,EAAA,CA1GD,MAAM,gBAAgB,OAAO,QAAA,GACzB,SACT,IAGM,CAAA,GAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAHNJ,EAGM,MAAA,CAHD,MAAM,eAAa,CACtBA,EAA+B,KAAA,CAA3B,MAAM,aAAA,EAAc,IAAE,EAC1BA,EAA2C,IAAA,CAAxC,MAAM,uBAAA,EAAwB,QAAM,CAAA,oBAI3C,IAiGU,CAjGVE,EAiGUG,EAAA,SAhGJ,UAAJ,IAAI5B,EACH,MAAOM,EACP,MAAAO,EACD,cAAY,IACX,WAAgBI,EAAc,CAAA,SAAA,CAAA,CAAA,aAE/B,IAEe,CAFfQ,EAEeI,EAAA,CAFD,KAAK,SAAO,WACxB,IAAsF,CAAtFJ,EAAsFK,EAAA,CAAnE,WAAAxB,EAAK,MAAL,sBAAAqB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAI,GAAAzB,EAAK,MAAKyB,GAAE,YAAY,KAAK,KAAK,QAAS,cAAaC,EAAAC,CAAA,CAAA,+CAG7ER,EAoBeI,EAAA,CApBD,KAAK,cAAY,WAC7B,IAkBM,CAlBNN,EAkBM,MAlBNW,EAkBM,CAjBJT,EAMEK,EAAA,CALS,WAAAxB,EAAK,WAAL,sBAAAqB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAI,GAAAzB,EAAK,WAAUyB,GACxB,YAAY,YACZ,KAAK,QACL,UAAU,IACV,MAAM,kBAAA,yBAERN,EASYU,EAAA,CARV,KAAK,UACL,KAAK,QACJ,SAAU/B,EAAA,MAAS,GAAA,CAASE,EAAK,MACjC,QAASH,EAAA,MACV,MAAM,gBACL,QAAOK,CAAA,aAER,IAAmD,CAAhD4B,EAAAC,EAAAjC,EAAA,WAAmBA,EAAA,KAAS,QAAA,OAAA,EAAA,CAAA,CAAA,4CAKrCqB,EAOeI,EAAA,CAPD,KAAK,SAAO,WACxB,IAKE,CALFJ,EAKEK,EAAA,CAJS,WAAAxB,EAAK,MAAL,sBAAAqB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAI,GAAAzB,EAAK,MAAKyB,GACnB,YAAY,UACZ,KAAK,QACJ,cAAaC,EAAAM,CAAA,CAAA,+CAIlBb,EAEeI,EAAA,CAFD,KAAK,YAAU,WAC3B,IAAsF,CAAtFJ,EAAsFK,EAAA,CAAnE,WAAAxB,EAAK,SAAL,sBAAAqB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAI,GAAAzB,EAAK,SAAQyB,GAAE,YAAY,KAAK,KAAK,QAAS,cAAaC,EAAAO,CAAA,CAAA,+CAGhFd,EASeI,EAAA,CATD,KAAK,YAAU,WAC3B,IAOE,CAPFJ,EAOEK,EAAA,CANS,WAAAxB,EAAK,SAAL,sBAAAqB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAI,GAAAzB,EAAK,SAAQyB,GACtB,KAAK,WACL,YAAY,WACZ,KAAK,QACJ,cAAaC,EAAAQ,CAAA,EACd,gBAAA,EAAA,+CAIJf,EAUeI,EAAA,CAVD,KAAK,mBAAiB,WAClC,IAQE,CARFJ,EAQEK,EAAA,CAPS,WAAAxB,EAAK,gBAAL,sBAAAqB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAI,GAAAzB,EAAK,gBAAeyB,GAC7B,KAAK,WACL,YAAY,OACZ,KAAK,QACJ,cAAaC,EAAAQ,CAAA,EACd,gBAAA,GACC,UAAavB,EAAc,CAAA,OAAA,CAAA,CAAA,+CAIhCQ,EAOeI,EAAA,CAPD,KAAK,YAAY,MAAM,gBAAA,aACnC,IAKc,CALdJ,EAKcgB,EAAA,CALQ,WAAAnC,EAAK,UAAL,sBAAAqB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAI,GAAAzB,EAAK,UAASyB,EAAA,aAAE,IAEpC,iBAFoC,YAEpC,EAAA,GAAAN,EAA2DiB,EAAA,CAAlD,KAAK,UAAW,UAAW,EAAA,aAAO,IAAM,CAAA,GAAAf,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAAN,SAAM,EAAA,CAAA,2BAAU,MAE3D,EAAA,GAAAF,EAA2DiB,EAAA,CAAlD,KAAK,UAAW,UAAW,EAAA,aAAO,IAAM,CAAA,GAAAf,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,GAAN,SAAM,EAAA,CAAA,4CAIrDF,EAUeI,EAAA,KAAA,WATb,IAQY,CARZJ,EAQYU,EAAA,CAPV,KAAK,UACL,KAAK,QACJ,QAASjC,EAAA,MACV,MAAM,kBACL,QAAOe,CAAA,aACT,IAED,CAAA,GAAAU,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,GAFC,OAED,EAAA,CAAA,iCAGFF,EAA0BkB,EAAA,KAAA,WAAd,IAAC,CAAA,GAAAhB,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,GAAD,IAAC,EAAA,CAAA,WAEbF,EAIeI,EAAA,KAAA,WAHb,IAEY,CAFZJ,EAEYU,EAAA,CAFD,KAAK,QAAQ,MAAM,eAAgB,QAAKR,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAI,GAAEa,EAAAA,QAAQ,KAAI,QAAA,EAAA,aAAY,IAE7E,CAAA,GAAAjB,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,GAF6E,YAE7E,EAAA,CAAA"}