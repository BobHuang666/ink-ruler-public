{"version":3,"file":"essay-D4g_b-yw.js","sources":["../../src/stores/essay.ts"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref } from 'vue'\nimport type { Essay, EssayDetail, Correction, Draft } from '@/types/essay'\nimport * as essayApi from '@/api/essay'\n\nexport const useEssayStore = defineStore('essay', () => {\n  const currentEssay = ref<EssayDetail | null>(null)\n  const currentCorrection = ref<Correction | null>(null)\n  const history = ref<Essay[]>([])\n  const drafts = ref<Draft[]>([])\n  const loading = ref(false)\n\n  async function submitEssay(data: {\n    title?: string\n    prompt?: string\n    content_text?: string\n    file?: File\n    source_type: 'text' | 'docx' | 'image' | 'pdf'\n  }) {\n    loading.value = true\n    try {\n      const response = await essayApi.submitEssay(data)\n      const essay = await essayApi.getEssay(response.essay_id)\n      currentEssay.value = essay\n      return essay\n    } finally {\n      loading.value = false\n    }\n  }\n\n  async function fetchEssay(id: number) {\n    loading.value = true\n    try {\n      const essay = await essayApi.getEssay(id)\n      currentEssay.value = essay\n      if (essay.status === 'done') {\n        const correction = await essayApi.getCorrection(id)\n        currentCorrection.value = correction\n      } else if (essay.correction) {\n        currentCorrection.value = essay.correction\n      }\n      return essay\n    } finally {\n      loading.value = false\n    }\n  }\n\n  async function fetchCorrection(id: number) {\n    loading.value = true\n    try {\n      const correction = await essayApi.getCorrection(id)\n      currentCorrection.value = correction\n      return correction\n    } finally {\n      loading.value = false\n    }\n  }\n\n  async function fetchHistory(params?: { page?: number; size?: number; status?: string }) {\n    loading.value = true\n    try {\n      const response = await essayApi.getEssayHistory(params || {})\n      history.value = response.items\n      return response\n    } finally {\n      loading.value = false\n    }\n  }\n\n  async function deleteEssay(id: number) {\n    await essayApi.deleteEssay(id)\n    await fetchHistory()\n  }\n\n  async function favoriteEssay(id: number) {\n    await essayApi.favoriteEssay(id)\n  }\n\n  /** 乐观更新：当前作文收藏状态（批改页用） */\n  function setCurrentEssayFavorited(value: boolean) {\n    if (currentEssay.value) {\n      currentEssay.value = { ...currentEssay.value, is_favorited: value }\n    }\n  }\n\n  /** 乐观更新：历史列表中某条的收藏状态（历史页用） */\n  function setHistoryItemFavorited(essayId: number, value: boolean) {\n    history.value = history.value.map((e) => (e.id === essayId ? { ...e, is_favorited: value } : e))\n  }\n\n  async function fetchDrafts() {\n    loading.value = true\n    try {\n      const draftList = await essayApi.getDrafts()\n      drafts.value = draftList\n      return draftList\n    } finally {\n      loading.value = false\n    }\n  }\n\n  async function createDraft(data: { title?: string; content_text: string }) {\n    const draft = await essayApi.createDraft(data)\n    await fetchDrafts()\n    return draft\n  }\n\n  async function deleteDraft(id: number) {\n    await essayApi.deleteDraft(id)\n    await fetchDrafts()\n  }\n\n  function clearCurrent() {\n    currentEssay.value = null\n    currentCorrection.value = null\n  }\n\n  return {\n    currentEssay,\n    currentCorrection,\n    history,\n    drafts,\n    loading,\n    submitEssay,\n    fetchEssay,\n    fetchCorrection,\n    fetchHistory,\n    deleteEssay,\n    favoriteEssay,\n    setCurrentEssayFavorited,\n    setHistoryItemFavorited,\n    fetchDrafts,\n    createDraft,\n    deleteDraft,\n    clearCurrent,\n  }\n})\n"],"names":["useEssayStore","defineStore","currentEssay","ref","currentCorrection","history","drafts","loading","submitEssay","data","response","essayApi.submitEssay","essay","essayApi.getEssay","fetchEssay","id","correction","essayApi.getCorrection","fetchCorrection","fetchHistory","params","essayApi.getEssayHistory","deleteEssay","essayApi.deleteEssay","favoriteEssay","essayApi.favoriteEssay","setCurrentEssayFavorited","value","setHistoryItemFavorited","essayId","e","fetchDrafts","draftList","essayApi.getDrafts","createDraft","draft","essayApi.createDraft","deleteDraft","essayApi.deleteDraft","clearCurrent"],"mappings":"+IAKO,MAAMA,EAAgBC,EAAY,QAAS,IAAM,CACtD,MAAMC,EAAeC,EAAwB,IAAI,EAC3CC,EAAoBD,EAAuB,IAAI,EAC/CE,EAAUF,EAAa,EAAE,EACzBG,EAASH,EAAa,EAAE,EACxBI,EAAUJ,EAAI,EAAK,EAEzB,eAAeK,EAAYC,EAMxB,CACDF,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAMG,EAAW,MAAMC,EAAqBF,CAAI,EAC1CG,EAAQ,MAAMC,EAAkBH,EAAS,QAAQ,EACvD,OAAAR,EAAa,MAAQU,EACdA,CACT,QAAA,CACEL,EAAQ,MAAQ,EAClB,CACF,CAEA,eAAeO,EAAWC,EAAY,CACpCR,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAMK,EAAQ,MAAMC,EAAkBE,CAAE,EAExC,GADAb,EAAa,MAAQU,EACjBA,EAAM,SAAW,OAAQ,CAC3B,MAAMI,EAAa,MAAMC,EAAuBF,CAAE,EAClDX,EAAkB,MAAQY,CAC5B,MAAWJ,EAAM,aACfR,EAAkB,MAAQQ,EAAM,YAElC,OAAOA,CACT,QAAA,CACEL,EAAQ,MAAQ,EAClB,CACF,CAEA,eAAeW,EAAgBH,EAAY,CACzCR,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAMS,EAAa,MAAMC,EAAuBF,CAAE,EAClD,OAAAX,EAAkB,MAAQY,EACnBA,CACT,QAAA,CACET,EAAQ,MAAQ,EAClB,CACF,CAEA,eAAeY,EAAaC,EAA4D,CACtFb,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAMG,EAAW,MAAMW,EAAyBD,GAAU,CAAA,CAAE,EAC5D,OAAAf,EAAQ,MAAQK,EAAS,MAClBA,CACT,QAAA,CACEH,EAAQ,MAAQ,EAClB,CACF,CAEA,eAAee,EAAYP,EAAY,CACrC,MAAMQ,EAAqBR,CAAE,EAC7B,MAAMI,EAAA,CACR,CAEA,eAAeK,EAAcT,EAAY,CACvC,MAAMU,EAAuBV,CAAE,CACjC,CAGA,SAASW,EAAyBC,EAAgB,CAC5CzB,EAAa,QACfA,EAAa,MAAQ,CAAE,GAAGA,EAAa,MAAO,aAAcyB,CAAA,EAEhE,CAGA,SAASC,EAAwBC,EAAiBF,EAAgB,CAChEtB,EAAQ,MAAQA,EAAQ,MAAM,IAAKyB,GAAOA,EAAE,KAAOD,EAAU,CAAE,GAAGC,EAAG,aAAcH,CAAA,EAAUG,CAAE,CACjG,CAEA,eAAeC,GAAc,CAC3BxB,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAMyB,EAAY,MAAMC,EAAS,EACjC,OAAA3B,EAAO,MAAQ0B,EACRA,CACT,QAAA,CACEzB,EAAQ,MAAQ,EAClB,CACF,CAEA,eAAe2B,EAAYzB,EAAgD,CACzE,MAAM0B,EAAQ,MAAMC,EAAqB3B,CAAI,EAC7C,aAAMsB,EAAA,EACCI,CACT,CAEA,eAAeE,EAAYtB,EAAY,CACrC,MAAMuB,EAAqBvB,CAAE,EAC7B,MAAMgB,EAAA,CACR,CAEA,SAASQ,GAAe,CACtBrC,EAAa,MAAQ,KACrBE,EAAkB,MAAQ,IAC5B,CAEA,MAAO,CACL,aAAAF,EACA,kBAAAE,EACA,QAAAC,EACA,OAAAC,EACA,QAAAC,EAAA,YACAC,EACA,WAAAM,EACA,gBAAAI,EACA,aAAAC,EAAA,YACAG,EAAA,cACAE,EACA,yBAAAE,EACA,wBAAAE,EACA,YAAAG,EAAA,YACAG,EAAA,YACAG,EACA,aAAAE,CAAA,CAEJ,CAAC"}