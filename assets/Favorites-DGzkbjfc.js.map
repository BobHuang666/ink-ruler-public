{"version":3,"file":"Favorites-DGzkbjfc.js","sources":["../../src/views/user/Favorites.vue"],"sourcesContent":["<template>\n  <div class=\"favorites-page\">\n    <div class=\"container\">\n      <h1 class=\"page-title header-font\">我的收藏</h1>\n      <el-tabs v-model=\"activeTab\" class=\"favorites-tabs\">\n        <el-tab-pane label=\"作文收藏\" name=\"essay\">\n          <el-card shadow=\"never\">\n            <div v-if=\"favorites.length || favoritesLoading\" class=\"table-scroll-wrap\">\n              <el-table\n                v-loading=\"favoritesLoading\"\n                :data=\"favorites\"\n                class=\"profile-table\"\n                style=\"width: 100%\"\n              >\n                <el-table-column prop=\"title\" label=\"标题\" min-width=\"120\">\n                  <template #default=\"{ row }\">\n                    <router-link :to=\"`/essay/${row.essay_id}`\" class=\"table-link\">\n                      {{ row.title || '无标题' }}\n                    </router-link>\n                  </template>\n                </el-table-column>\n                <el-table-column label=\"收藏时间\" min-width=\"150\">\n                  <template #default=\"{ row }\">\n                    {{ new Date(row.essay_created_at).toLocaleString() }}\n                  </template>\n                </el-table-column>\n                <el-table-column label=\"操作\" min-width=\"100\" align=\"right\">\n                  <template #default=\"{ row }\">\n                    <el-button\n                      type=\"danger\"\n                      text\n                      :loading=\"unfavoriteId === row.essay_id\"\n                      @click=\"handleUnfavorite(row)\"\n                    >\n                      取消收藏\n                    </el-button>\n                  </template>\n                </el-table-column>\n              </el-table>\n            </div>\n            <el-empty v-else description=\"暂无作文收藏\">\n              <el-button type=\"primary\" @click=\"$router.push('/essay/history')\"\n                >去历史记录</el-button\n              >\n            </el-empty>\n          </el-card>\n        </el-tab-pane>\n\n        <el-tab-pane label=\"素材收藏\" name=\"classic\">\n          <el-card shadow=\"never\">\n            <div\n              v-if=\"classicFavorites.length || classicFavoritesLoading\"\n              class=\"table-scroll-wrap\"\n            >\n              <el-table\n                v-loading=\"classicFavoritesLoading\"\n                :data=\"classicFavorites\"\n                class=\"profile-table\"\n                style=\"width: 100%\"\n              >\n                <el-table-column label=\"内容\" min-width=\"180\">\n                  <template #default=\"{ row }\">\n                    <router-link :to=\"`/classic/item/${row.id}`\" class=\"table-link\">\n                      {{ row.original_text?.slice(0, 50)\n                      }}{{ (row.original_text?.length ?? 0) > 50 ? '…' : '' }}\n                    </router-link>\n                  </template>\n                </el-table-column>\n                <el-table-column label=\"作者/朝代\" min-width=\"100\">\n                  <template #default=\"{ row }\"> {{ row.author }} {{ row.dynasty }} </template>\n                </el-table-column>\n                <el-table-column label=\"操作\" min-width=\"100\" align=\"right\">\n                  <template #default=\"{ row }\">\n                    <el-button\n                      type=\"danger\"\n                      text\n                      :loading=\"unfavoriteClassicId === row.id\"\n                      @click=\"handleUnfavoriteClassic(row)\"\n                    >\n                      取消收藏\n                    </el-button>\n                  </template>\n                </el-table-column>\n              </el-table>\n            </div>\n            <el-empty v-else description=\"暂无素材收藏\">\n              <el-button type=\"primary\" @click=\"$router.push('/classic')\">去素材中心</el-button>\n            </el-empty>\n          </el-card>\n        </el-tab-pane>\n      </el-tabs>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, watch } from 'vue'\nimport { useRoute } from 'vue-router'\nimport * as essayApi from '@/api/essay'\nimport * as classicApi from '@/api/classic'\nimport { ElMessage } from 'element-plus'\nimport type { FavoriteItem } from '@/types/essay'\nimport type { ClassicItem } from '@/types/classic'\n\nconst route = useRoute()\n\nconst activeTab = ref<'essay' | 'classic'>('essay')\nconst favorites = ref<FavoriteItem[]>([])\nconst favoritesLoading = ref(false)\nconst unfavoriteId = ref<number | null>(null)\nconst classicFavorites = ref<ClassicItem[]>([])\nconst classicFavoritesLoading = ref(false)\nconst unfavoriteClassicId = ref<number | null>(null)\n\nasync function fetchFavorites() {\n  favoritesLoading.value = true\n  try {\n    favorites.value = await essayApi.getFavorites()\n  } catch {\n    favorites.value = []\n  } finally {\n    favoritesLoading.value = false\n  }\n}\n\nasync function handleUnfavorite(item: FavoriteItem) {\n  unfavoriteId.value = item.essay_id\n  try {\n    await essayApi.unfavoriteEssay(item.essay_id)\n    favorites.value = favorites.value.filter((f) => f.essay_id !== item.essay_id)\n    ElMessage.success('已取消收藏')\n  } catch (error: unknown) {\n    ElMessage.error((error as Error).message || '取消收藏失败')\n  } finally {\n    unfavoriteId.value = null\n  }\n}\n\nasync function fetchClassicFavorites() {\n  classicFavoritesLoading.value = true\n  try {\n    classicFavorites.value = await classicApi.getClassicFavorites()\n  } catch {\n    classicFavorites.value = []\n  } finally {\n    classicFavoritesLoading.value = false\n  }\n}\n\nasync function handleUnfavoriteClassic(c: ClassicItem) {\n  unfavoriteClassicId.value = c.id\n  try {\n    await classicApi.unfavorite(c.id)\n    classicFavorites.value = classicFavorites.value.filter((x) => x.id !== c.id)\n    ElMessage.success('已取消收藏')\n  } catch (error: unknown) {\n    ElMessage.error((error as Error).message || '取消收藏失败')\n  } finally {\n    unfavoriteClassicId.value = null\n  }\n}\n\nonMounted(() => {\n  const tab = route.query.tab as string\n  if (tab === 'classic' || tab === 'essay') activeTab.value = tab\n})\n\nwatch(\n  activeTab,\n  (tab) => {\n    if (tab === 'essay') fetchFavorites()\n    if (tab === 'classic') fetchClassicFavorites()\n  },\n  { immediate: true }\n)\n</script>\n\n<style scoped>\n.favorites-page {\n  min-height: calc(100vh - var(--header-height) - 80px);\n  padding: var(--spacing-lg) 0;\n  background: transparent;\n}\n\n.container {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 var(--spacing-md);\n}\n\n.page-title {\n  margin: 0 0 var(--spacing-lg);\n  font-size: 1.5rem;\n  font-weight: 600;\n}\n\n.favorites-tabs :deep(.el-tabs__header) {\n  margin-bottom: var(--spacing-md);\n}\n\n.table-scroll-wrap {\n  overflow-x: auto;\n  min-height: 120px;\n}\n.profile-table {\n  min-width: 400px;\n}\n.table-link {\n  color: var(--color-primary);\n  text-decoration: none;\n}\n.table-link:hover {\n  text-decoration: underline;\n}\n</style>\n"],"names":["route","useRoute","activeTab","ref","favorites","favoritesLoading","unfavoriteId","classicFavorites","classicFavoritesLoading","unfavoriteClassicId","fetchFavorites","essayApi.getFavorites","handleUnfavorite","item","essayApi.unfavoriteEssay","f","ElMessage","error","fetchClassicFavorites","classicApi.getClassicFavorites","handleUnfavoriteClassic","c","classicApi.unfavorite","x","onMounted","tab","watch","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_cache","_createVNode","_component_el_tabs","$event","_component_el_tab_pane","_component_el_card","_hoisted_3","_createBlock","_component_el_table","_component_el_table_column","_withCtx","row","_component_router_link","_createTextVNode","_toDisplayString","_component_el_button","_component_el_empty","$router","_hoisted_4"],"mappings":"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"}