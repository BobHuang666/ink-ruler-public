import{G as i,H as h,l}from"./index-DYibA2ZD.js";function p(t){return{id:t.id,user_id:t.user_id,title:t.title,prompt:t.prompt,source_type:t.source_type||"text",content_text:t.content_text||"",word_count:t.word_count??0,paragraphs:t.paragraphs??0,status:t.status||"pending",created_at:t.created_at??"",updated_at:t.updated_at??""}}const m={word_count:0,paragraph_count:0,typo_count:0};function $(t){const e=t.stats,n=typeof e=="string"?JSON.parse(e||"{}"):e;return{id:t.id,essay_id:t.essay_id,summary:t.summary??"",stats:n?.word_count!=null?n:m,diff_html:t.diff_html??"",raw_json:(typeof t.raw_json=="string"?JSON.parse(t.raw_json||"{}"):t.raw_json)??{},model_name:t.model_name??"",token_usage:(typeof t.token_usage=="string"?JSON.parse(t.token_usage||"{}"):t.token_usage)??{},created_at:t.created_at??"",updated_at:t.updated_at??""}}async function S(t){let e=t.content_text??"";t.file&&(e=await j(t.file));const n=await i.post("/essays",{title:t.title,prompt:t.prompt,content_text:e,source_type:t.source_type||"text"});return{essay_id:n.data.essay_id,status:n.data.status}}function j(t){return new Promise((e,n)=>{const a=new FileReader;a.onload=s=>e(s.target?.result||""),a.onerror=()=>n(new Error("文件读取失败")),a.readAsText(t)})}async function d(t){const e=await i.get(`/essays/${t}`),a={...p(e.data.essay)};if(e.data.correction_summary){const s=e.data.correction_summary;let c=m;try{const u=typeof s.stats=="string"?JSON.parse(s.stats):s.stats;u&&typeof u.word_count=="number"&&(c=u)}catch{}a.correction={id:0,essay_id:t,summary:s.summary,stats:c,diff_html:"",raw_json:{},model_name:"",token_usage:{},created_at:"",updated_at:""}}return a}async function C(t){const e=await i.get(`/essays/${t}/correction`);return $(e.data)}async function b(t){const e=t.page??1,n=t.size??10,a=await i.get("/essays",{params:{page:e,size:n,status:t.status}});return{items:(a.data.list??[]).map(p),total:a.data.total??0,page:e,size:n}}async function k(t){await i.delete(`/essays/${t}`)}async function D(t,e="essay"){await i.post(`/essays/${t}/favorite`,{target_type:e})}async function O(t){const e=await i.post("/drafts",t),a=(await i.get(`/drafts/${e.data.draft_id}`)).data;return{id:a.id,user_id:a.user_id,title:a.title,content_text:a.content_text??"",created_at:a.created_at??"",updated_at:a.updated_at??""}}async function z(t){return((await i.get("/drafts",{params:{page:1,size:500}})).data.list??[]).map(c=>({id:c.id,user_id:c.user_id,title:c.title,content_text:c.content_text??"",created_at:c.created_at??"",updated_at:c.updated_at??""}))}const F=h("essay",()=>{const t=l(null),e=l(null),n=l([]),a=l([]),s=l(!1);async function c(r){s.value=!0;try{const o=await S(r),_=await d(o.essay_id);return t.value=_,_}finally{s.value=!1}}async function u(r){s.value=!0;try{const o=await d(r);return t.value=o,o.correction&&(e.value=o.correction),o}finally{s.value=!1}}async function w(r){s.value=!0;try{const o=await C(r);return e.value=o,o}finally{s.value=!1}}async function y(r){s.value=!0;try{const o=await b(r||{});return n.value=o.items,o}finally{s.value=!1}}async function g(r){await k(r),await y()}async function v(r){await D(r)}async function f(){s.value=!0;try{const r=await z();return a.value=r,r}finally{s.value=!1}}async function E(r){const o=await O(r);return await f(),o}function x(){t.value=null,e.value=null}return{currentEssay:t,currentCorrection:e,history:n,drafts:a,loading:s,submitEssay:c,fetchEssay:u,fetchCorrection:w,fetchHistory:y,deleteEssay:g,favoriteEssay:v,fetchDrafts:f,createDraft:E,clearCurrent:x}});export{F as u};
//# sourceMappingURL=essay-D67lxHTF.js.map
