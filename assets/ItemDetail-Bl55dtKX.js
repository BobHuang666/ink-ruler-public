import{d as P,u as R,l as c,O as T,C as q,M as z,n as O,c as t,a as o,e as d,w as u,r as C,F as S,b as n,D as l,j as _,f as v,x as X,Y,g as L,Z as B,X as D,A as Z,o as a,E as N,_ as $}from"./index-DuIC7plb.js";import{c as G,d as H,e as J,u as K,f as Q}from"./classic-l3kYh4Uo.js";const U={class:"classic-detail-page"},W={class:"detail-inner"},ee={key:0,class:"loading-wrap"},ae={class:"main-card"},te={class:"original content-font"},se={key:0,class:"translation"},le={class:"meta"},oe={key:0},ne={key:1},ie={key:2},ue={key:3},re={key:4},ce={class:"actions"},de={key:0,class:"similar-section"},_e={class:"similar-grid"},ve={class:"original content-font"},fe={key:0,class:"translation"},ge={class:"meta"},ye={key:0},me={key:1},pe={key:2,class:"empty"},ke=P({__name:"ItemDetail",setup(he){const b=q(),F=Z(),A=R(),e=c(null),y=c([]),w=c(!0),m=c(!1),p=c(!1),f=c(!1),k=c(!1),h=T(()=>{const r=b.params.id,s=parseInt(String(r),10);return Number.isNaN(s)?0:s});async function I(){if(h.value){w.value=!0;try{const[r,s]=await Promise.all([G(h.value),H(h.value)]);e.value=r,y.value=s??[]}catch{e.value=null,y.value=[]}finally{w.value=!1}}}async function V(){if(!e.value||m.value)return;const r=k.value?"decrement":"increment";m.value=!0;try{const s=await J(e.value.id,{action:r});e.value&&(e.value.likes=s.likes),k.value=!k.value}finally{m.value=!1}}async function E(){if(!(!e.value||p.value||!A.isAuthenticated)){p.value=!0;try{f.value?(await K(e.value.id),f.value=!1,N.success("已取消收藏")):(await Q(e.value.id),f.value=!0,N.success("已收藏"))}catch(r){N.error(r.message)}finally{p.value=!1}}}function M(){F.push({path:"/login",query:{redirect:b.fullPath}})}return z(h,I),O(I),(r,s)=>{const g=C("el-icon"),x=C("el-button"),j=C("router-link");return a(),t("div",U,[s[2]||(s[2]=o("div",{class:"page-bg"},[o("div",{class:"page-bg-gradient"})],-1)),o("div",W,[w.value?(a(),t("div",ee,[d(g,{class:"is-loading",size:32},{default:u(()=>[d(v(Y))]),_:1})])):e.value?(a(),t(S,{key:1},[o("div",ae,[o("p",te,l(e.value.original_text),1),e.value.translation?(a(),t("p",se,l(e.value.translation),1)):n("",!0),o("div",le,[e.value.source?(a(),t("span",oe,"出处："+l(e.value.source),1)):n("",!0),e.value.author?(a(),t("span",ne,l(e.value.author),1)):n("",!0),e.value.dynasty?(a(),t("span",ie,l(e.value.dynasty),1)):n("",!0),e.value.genre?(a(),t("span",ue,l(e.value.genre),1)):n("",!0),e.value.categories?(a(),t("span",re,"分类："+l(Array.isArray(e.value.categories)?e.value.categories.join("、"):e.value.categories),1)):n("",!0)]),o("div",ce,[d(x,{loading:m.value,onClick:V},{default:u(()=>[k.value?(a(),_(g,{key:0},{default:u(()=>[d(v(B))]),_:1})):(a(),_(g,{key:1},{default:u(()=>[d(v(D))]),_:1})),L(" "+l(e.value.likes)+" 点赞 ",1)]),_:1},8,["loading"]),v(A).isAuthenticated?(a(),_(x,{key:0,loading:p.value,onClick:E},{default:u(()=>[f.value?(a(),_(g,{key:0},{default:u(()=>[d(v(B))]),_:1})):(a(),_(g,{key:1},{default:u(()=>[d(v(D))]),_:1})),L(" "+l(f.value?"已收藏":"收藏"),1)]),_:1},8,["loading"])):(a(),_(x,{key:1,onClick:M},{default:u(()=>[...s[0]||(s[0]=[L("登录后收藏",-1)])]),_:1}))])]),y.value.length?(a(),t("section",de,[s[1]||(s[1]=o("h2",{class:"section-title"},"相似推荐",-1)),o("div",_e,[(a(!0),t(S,null,X(y.value,i=>(a(),_(j,{key:i.id,to:`/classic/item/${i.id}`,class:"similar-card"},{default:u(()=>[o("p",ve,l(i.original_text),1),i.translation?(a(),t("p",fe,l(i.translation),1)):n("",!0),o("div",ge,[i.author?(a(),t("span",ye,l(i.author),1)):n("",!0),i.dynasty?(a(),t("span",me,l(i.dynasty),1)):n("",!0)])]),_:2},1032,["to"]))),128))])])):n("",!0)],64)):(a(),t("div",pe,"条目不存在"))])])}}}),Ce=$(ke,[["__scopeId","data-v-49333f4d"]]);export{Ce as default};
//# sourceMappingURL=ItemDetail-Bl55dtKX.js.map
