{"version":3,"file":"Search-BX9naspG.js","sources":["../../src/views/classic/Search.vue"],"sourcesContent":["<template>\n  <div class=\"classic-search-page\">\n    <div class=\"search-inner\">\n      <div class=\"search-bar\">\n        <el-input\n          v-model=\"inputQ\"\n          placeholder=\"输入关键词搜索\"\n          size=\"large\"\n          clearable\n          class=\"input\"\n          @keyup.enter=\"doSearch\"\n        >\n          <template #append>\n            <el-button type=\"primary\" @click=\"doSearch\">搜索</el-button>\n          </template>\n        </el-input>\n      </div>\n      <div class=\"search-content\">\n        <div v-if=\"searched\" class=\"result-header\">\n          <span>“{{ displayQuery }}” 共 {{ total }} 条</span>\n        </div>\n        <div v-if=\"loading\" class=\"loading-wrap\">\n          <el-icon class=\"is-loading\" :size=\"32\"><Loading /></el-icon>\n        </div>\n        <div v-else-if=\"searched && results.length === 0\" class=\"empty\">暂无结果</div>\n        <template v-else>\n          <div v-if=\"results.length > 0 && totalPages > 1\" class=\"pagination-wrap pagination-top\">\n            <el-pagination\n              v-model:current-page=\"currentPage\"\n              :page-size=\"pageSize\"\n              :total=\"total\"\n              layout=\"prev, pager, next\"\n              small\n              background\n            />\n          </div>\n          <div class=\"list-wrap\">\n            <router-link\n              v-for=\"item in currentPageItems\"\n              :key=\"item.id\"\n              :to=\"`/classic/item/${item.id}`\"\n              class=\"item-card\"\n            >\n              <div class=\"card-inner\">\n                <h3 class=\"card-original\">{{ item.original_text }}</h3>\n                <div v-if=\"showTranslation && item.translation\" class=\"card-trans-wrap\">\n                  <p class=\"card-trans\"><b>翻译：</b>{{ item.translation }}</p>\n                </div>\n                <div class=\"card-footer\">\n                  <span class=\"card-meta\">\n                    <template v-if=\"showDynasty && item.dynasty\">［{{ item.dynasty }}］</template>\n                    <template v-if=\"showAuthor && item.author\">{{ item.author }}</template>\n                    <template v-if=\"showAuthor && item.author && item.source\"> · </template>\n                    <template v-if=\"item.source\">{{ item.source }}</template>\n                    <span v-if=\"item.genre\" class=\"card-genre\">{{ item.genre }}</span>\n                  </span>\n                  <div class=\"card-right\">\n                    <span class=\"card-likes\">\n                      <span class=\"icon-heart\"></span>\n                      {{ item.likes ?? 0 }}\n                    </span>\n                    <template v-for=\"cat in itemCategories(item)\" :key=\"cat\">\n                      <span :class=\"['category-tag', getCategoryTagClass(cat)]\">{{ cat }}</span>\n                    </template>\n                  </div>\n                </div>\n              </div>\n            </router-link>\n          </div>\n          <div v-if=\"results.length > 0 && totalPages > 1\" class=\"pagination-wrap\">\n            <el-pagination\n              v-model:current-page=\"currentPage\"\n              :page-size=\"pageSize\"\n              :total=\"total\"\n              layout=\"prev, pager, next\"\n              small\n              background\n            />\n          </div>\n        </template>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, watch, onActivated, nextTick } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { Loading } from '@element-plus/icons-vue'\nimport { search } from '@/api/classic'\nimport type { ClassicItem } from '@/types/classic'\nimport { getNavigationFrom } from '@/router'\n\ndefineOptions({ name: 'ClassicSearch' })\n\nconst route = useRoute()\nconst inputQ = ref('')\nconst displayQuery = ref('')\nconst results = ref<ClassicItem[]>([])\nconst loading = ref(false)\nconst searched = ref(false)\nconst showTranslation = ref(true)\nconst showAuthor = ref(true)\nconst showDynasty = ref(true)\nconst pageSize = 20\nconst currentPage = ref(1)\n\nconst routeQuery = computed(() => (route.query.q as string) ?? '')\n\nconst total = computed(() => results.value.length)\nconst totalPages = computed(() => Math.ceil(total.value / pageSize) || 1)\nconst currentPageItems = computed(() => {\n  const start = (currentPage.value - 1) * pageSize\n  return results.value.slice(start, start + pageSize)\n})\n\nconst categoryTagMap: Record<string, string> = {\n  格物修身: 'cat-purple',\n  济世情怀: 'cat-indigo',\n  道德情操: 'cat-sky',\n  人与自然: 'cat-cyan',\n  哲理思辨: 'cat-emerald',\n  文化传承: 'cat-lime',\n  理想信念: 'cat-amber',\n  成长成才: 'cat-orange',\n  家国情怀: 'cat-red',\n}\nfunction itemCategories(item: ClassicItem): string[] {\n  const raw = item.categories\n  if (!raw) return []\n  const arr = Array.isArray(raw)\n    ? raw\n    : String(raw)\n        .split(',')\n        .map((s: string) => s.trim())\n  return arr.slice(0, 2)\n}\nfunction getCategoryTagClass(category: string): string {\n  return categoryTagMap[category.trim()] ?? 'cat-gray'\n}\n\nasync function doSearch() {\n  const q = inputQ.value?.trim()\n  if (!q) return\n  displayQuery.value = q\n  loading.value = true\n  searched.value = true\n  try {\n    const list = await search(q, 'keyword')\n    results.value = list ?? []\n    currentPage.value = 1\n  } finally {\n    loading.value = false\n  }\n}\n\nfunction loadFromRoute() {\n  const q = routeQuery.value\n  if (q) {\n    inputQ.value = q\n    doSearch()\n  }\n}\n\nwatch(() => route.query.q, loadFromRoute)\nwatch(currentPage, () => {\n  nextTick(() => {\n    window.scrollTo({ top: 0, behavior: 'smooth' })\n  })\n})\n\nonActivated(() => {\n  // 从详情页返回时不刷新，其他情况根据路由参数加载\n  const from = getNavigationFrom()\n  if (from?.name === 'ClassicItemDetail') return\n  loadFromRoute()\n})\n</script>\n\n<style scoped>\n.classic-search-page {\n  position: relative;\n  min-height: calc(100vh - var(--header-height) - 80px);\n}\n.search-inner {\n  max-width: 56rem;\n  margin: 0 auto;\n  padding: 32px 24px 40px;\n  background: rgba(255, 255, 255, 0.75);\n  border-radius: 16px;\n  box-shadow: var(--card-shadow);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n}\n.search-bar {\n  width: 100%;\n  margin: 0 auto 24px;\n  padding: 6px;\n  border-radius: 16px;\n  background: linear-gradient(\n    135deg,\n    rgba(251, 135, 158, 0.25) 0%,\n    rgba(255, 255, 255, 0.4) 50%,\n    rgba(144, 202, 249, 0.25) 100%\n  );\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  box-shadow: 0 4px 24px rgba(120, 113, 108, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.25);\n}\n.search-bar :deep(.el-input-group) {\n  display: flex;\n  align-items: stretch;\n}\n\n.search-bar :deep(.el-input__wrapper) {\n  background: transparent;\n  border-radius: 10px;\n  box-shadow: none;\n  border: none;\n}\n\n.search-bar :deep(.el-input-group__append) {\n  background: transparent !important;\n  border: none !important;\n  border-left: none !important;\n  box-shadow: none !important;\n  padding: 0 0 0 8px;\n  display: flex;\n  align-items: center;\n  min-width: 0;\n}\n\n.search-bar :deep(.el-input-group__append .el-button) {\n  border-radius: 8px;\n  margin: 0;\n  margin-right: 8px;\n  flex-shrink: 0;\n  height: 90%;\n  background: rgba(255, 255, 255, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.4);\n  color: var(--color-text-primary);\n}\n\n.search-bar :deep(.el-input-group__append .el-button:hover) {\n  background: rgba(255, 255, 255, 0.7);\n  border-color: rgba(255, 255, 255, 0.5);\n  color: var(--color-text-primary);\n}\n\n.input {\n  width: 100%;\n}\n.result-header {\n  margin-bottom: 16px;\n  color: var(--color-text-regular);\n  font-size: var(--font-size-sm);\n}\n.loading-wrap,\n.empty {\n  text-align: center;\n  padding: 48px;\n  color: var(--color-text-secondary);\n}\n.list-wrap {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n.item-card {\n  display: block;\n  padding: 16px;\n  border-radius: 8px;\n  background: linear-gradient(\n    to bottom right,\n    rgba(255, 251, 235, 0.8),\n    rgba(255, 255, 255, 0.8),\n    rgba(239, 246, 255, 0.8)\n  );\n  backdrop-filter: blur(2px);\n  border: 1px solid rgba(231, 229, 228, 0.7);\n  text-decoration: none;\n  color: inherit;\n  transition: all 0.3s ease-in-out;\n}\n.item-card:hover {\n  background: linear-gradient(\n    to bottom right,\n    rgba(254, 243, 199, 0.9),\n    rgba(255, 255, 255, 0.9),\n    rgba(219, 234, 254, 0.9)\n  );\n  box-shadow:\n    0 4px 6px -1px rgba(0, 0, 0, 0.1),\n    0 2px 4px -2px rgba(0, 0, 0, 0.1);\n}\n.card-inner {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.card-original {\n  font-size: 16px;\n  font-weight: 600;\n  line-height: 1.625;\n  color: #292524;\n  margin: 0;\n  font-family: 'SiYuanSongTi', 'Source Han Serif CN', 'SimSun', serif;\n}\n.card-trans-wrap {\n  font-size: 12px;\n  color: #57534e;\n  font-family: 'FZKT', 'KaiTi', 'STKaiti', serif;\n  margin: 0;\n}\n.card-trans {\n  margin: 0;\n  font-size: 12px;\n  color: #57534e;\n  font-family: 'FZKT', 'KaiTi', 'STKaiti', serif;\n}\n.card-footer {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n.card-meta {\n  font-size: 12px;\n  color: #78716c;\n  white-space: nowrap;\n  font-family: 'FZKT', 'KaiTi', 'STKaiti', serif;\n}\n.card-genre {\n  margin-left: 12px;\n  color: #a8a29e;\n  font-family: 'FZKT', 'KaiTi', 'STKaiti', serif;\n}\n.card-right {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 8px;\n  justify-content: flex-end;\n}\n@media (max-width: 640px) {\n  .card-footer {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n  .card-right {\n    width: 100%;\n    justify-content: flex-start;\n  }\n}\n.card-likes {\n  display: inline-flex;\n  align-items: center;\n  font-size: 12px;\n  color: #78716c;\n  font-family: 'SiYuanSongTi', 'Source Han Serif CN', 'SimSun', serif;\n}\n.icon-heart {\n  display: inline-block;\n  width: 14px;\n  height: 14px;\n  margin-right: 4px;\n  background: currentColor;\n  mask: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z'/%3E%3C/svg%3E\")\n    center/contain no-repeat;\n  -webkit-mask: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z'/%3E%3C/svg%3E\")\n    center/contain no-repeat;\n}\n.category-tag {\n  display: inline-flex;\n  align-items: center;\n  padding: 2px 6px;\n  border-radius: 6px;\n  font-size: 12px;\n  font-weight: 500;\n  font-family: 'FZKT', 'KaiTi', 'STKaiti', serif;\n}\n.cat-purple {\n  background: #faf5ff;\n  color: #6b21a8;\n}\n.cat-indigo {\n  background: #eef2ff;\n  color: #3730a3;\n}\n.cat-sky {\n  background: #f0f9ff;\n  color: #075985;\n}\n.cat-cyan {\n  background: #ecfeff;\n  color: #155e75;\n}\n.cat-emerald {\n  background: #ecfdf5;\n  color: #065f46;\n}\n.cat-lime {\n  background: #f7fee7;\n  color: #365314;\n}\n.cat-amber {\n  background: #fffbeb;\n  color: #92400e;\n}\n.cat-orange {\n  background: #fff7ed;\n  color: #9a3412;\n}\n.cat-red {\n  background: #fef2f2;\n  color: #991b1b;\n}\n.cat-gray {\n  background: #f9fafb;\n  color: #1f2937;\n}\n.search-content {\n  min-width: 0;\n}\n.pagination-wrap {\n  display: flex;\n  justify-content: center;\n  margin: 20px 0;\n}\n.pagination-top {\n  margin-bottom: 20px;\n  opacity: 0.9;\n}\n</style>\n"],"names":["pageSize","route","useRoute","inputQ","ref","displayQuery","results","loading","searched","showTranslation","showAuthor","showDynasty","currentPage","routeQuery","computed","total","totalPages","currentPageItems","start","categoryTagMap","itemCategories","item","raw","s","getCategoryTagClass","category","doSearch","q","list","search","loadFromRoute","watch","nextTick","onActivated","getNavigationFrom","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_el_input","$event","_component_el_button","_cache","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_6","_component_el_icon","_unref","Loading","_hoisted_7","_Fragment","_hoisted_8","_component_el_pagination","_hoisted_9","_renderList","_createBlock","_component_router_link","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_createTextVNode","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","cat","_normalizeClass","_hoisted_19"],"mappings":"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"}